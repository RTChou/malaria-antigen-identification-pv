% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  11pt,
  oneside]{book}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[left=1in,right=1in,top=1.5in,bottom=1.5in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
% section formatting
\usepackage{fancyhdr}
\renewcommand{\chaptername}{Section}
\usepackage{titlesec}
\titleformat{\chapter}[display]   
{\normalfont\huge\bfseries}{\chaptertitlename\ \thechapter}{20pt}{\Huge}   
\titlespacing*{\chapter}{0pt}{-50pt}{40pt}
\usepackage{fvextra}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}

% tables
\usepackage{booktabs}
\usepackage{longtable}
\usepackage[bf, singlelinecheck=off, justification=centering]{caption}

% increase color options
\usepackage{color}
\usepackage{color, colortbl}
\usepackage[dvipsnames, x11names]{xcolor}
\definecolor{carminered}{rgb}{1.0, 0.0, 0.22}

% links 
\usepackage[colorlinks=true, urlcolor=blue, linkcolor=Violet, citecolor=BrickRed, pdfborder={0 0 0}]{hyperref}
\urlstyle{tt}

\usepackage[scale=.7]{sourcecodepro}

\renewcommand{\textfraction}{0.05}
\renewcommand{\topfraction}{0.8}
\renewcommand{\bottomfraction}{0.8}
\renewcommand{\floatpagefraction}{0.75}

\renewenvironment{quote}{\begin{VF}}{\end{VF}}
\let\oldhref\href
\renewcommand{\href}[2]{#2\footnote{\url{#1}}}

\makeatletter
\newenvironment{kframe}{%
\medskip{}
\setlength{\fboxsep}{.8em}
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\makeatletter
\@ifundefined{Shaded}{
}{\renewenvironment{Shaded}{\begin{kframe}}{\end{kframe}}}
\makeatother

\newenvironment{rmdblock}[1]
  {
  \begin{itemize}
  \renewcommand{\labelitemi}{
    \raisebox{-.7\height}[0pt][0pt]{
      {\setkeys{Gin}{width=3em,keepaspectratio}\includegraphics{images/#1}}
    }
  }
  \setlength{\fboxsep}{1em}
  \begin{kframe}
  \item
  }
  {
  \end{kframe}
  \end{itemize}
  }
\newenvironment{rmdnote}
  {\begin{rmdblock}{note}}
  {\end{rmdblock}}
\newenvironment{rmdcaution}
  {\begin{rmdblock}{caution}}
  {\end{rmdblock}}
\newenvironment{rmdimportant}
  {\begin{rmdblock}{important}}
  {\end{rmdblock}}
\newenvironment{rmdtip}
  {\begin{rmdblock}{tip}}
  {\end{rmdblock}}
\newenvironment{rmdwarning}
  {\begin{rmdblock}{warning}}
  {\end{rmdblock}}

\usepackage{makeidx}
\makeindex

\usepackage{amsthm}
\makeatletter
\def\thm@space@setup{%
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}
\makeatother

\frontmatter
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Malaria vaccine antigen identification for Plasmodium vivax},
  pdfauthor={Renee Ti Chou},
  colorlinks=true,
  linkcolor={Maroon},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}

\title{Malaria vaccine antigen identification for \emph{Plasmodium vivax}}
\author{Renee Ti Chou}
\date{2023-06-06}

\begin{document}
\maketitle

{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{2}
\tableofcontents
}
\mainmatter

\hypertarget{preface}{%
\chapter*{Preface}\label{preface}}
\addcontentsline{toc}{chapter}{Preface}

Our research objective is to identify potential vaccine antigen candidates targeting the parasite \emph{P. vivax}, the second most prevalent cause of malaria. To improve the performance of the autologous model for \emph{P. vivax}, which has a constrained size of proteome and a small set of labeled antigens, we leverage heterologous data from \emph{P. falciparum}. We utilized multiple models trained on various combinations of heterologous and autologous data using the positive-unlabeled random forest (PURF) algorithm. The research notebook contains both data and code generated in the study titled ``\emph{Plasmodium vivax antigen candidate prediction improves with the addition of Plasmodium falciparum data.}'' Further, the notebook provides guidance on extracting protein variables and assembling machine learning input from the database, along with code for conducting experimental analyses and creating plots.

The notebook is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License.

\hypertarget{01_data_engineering}{%
\chapter{Data engineering}\label{01_data_engineering}}

\hypertarget{purf-package-installization}{%
\section{\texorpdfstring{\texttt{purf} package installization}{purf package installization}}\label{purf-package-installization}}

See instructions on the \href{https://github.com/rtchou/purf}{GitHub webpage}.

\hypertarget{retrieving-p.-vivax-protein-variables}{%
\section{\texorpdfstring{Retrieving \emph{P. vivax} protein variables}{Retrieving P. vivax protein variables}}\label{retrieving-p.-vivax-protein-variables}}

\textbf{In Bash: }

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{echo} \StringTok{"create database pfpv\_reverse\_vaccinology"} \KeywordTok{|} \ExtensionTok{mariadb} \AttributeTok{{-}u} \OperatorTok{\textless{}}\NormalTok{dbuser}\OperatorTok{\textgreater{}}\NormalTok{ {-}p}
\ExtensionTok{mariadb} \AttributeTok{{-}u} \OperatorTok{\textless{}}\NormalTok{dbuser}\OperatorTok{\textgreater{}}\NormalTok{ {-}p pfpv\_reverse\_vaccinology }\OperatorTok{\textless{}}\NormalTok{ ./other\_data/pfpv\_reverse\_vaccinology.sql}
\end{Highlighting}
\end{Shaded}

Overall database schema:

\begin{center}\includegraphics[width=1\linewidth]{./figures/database_schema} \end{center}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(RMariaDB)}
\FunctionTok{library}\NormalTok{(DBI)}
\FunctionTok{library}\NormalTok{(rlist)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{output\_path }\OtherTok{\textless{}{-}} \StringTok{"./other\_data/pv\_assembled\_data.csv"}
\NormalTok{db }\OtherTok{\textless{}{-}} \FunctionTok{dbConnect}\NormalTok{(RMariaDB}\SpecialCharTok{::}\FunctionTok{MariaDB}\NormalTok{(), }\AttributeTok{user =} \StringTok{"root"}\NormalTok{, }\AttributeTok{password =} \StringTok{""}\NormalTok{, }\AttributeTok{dbname =} \StringTok{"pfpv\_reverse\_vaccinology"}\NormalTok{)}

\NormalTok{get\_data }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(table\_name, db) \{}
\NormalTok{  sql }\OtherTok{\textless{}{-}} \FunctionTok{sqlInterpolate}\NormalTok{(db, }\StringTok{"SELECT * FROM ?table"}\NormalTok{, }\AttributeTok{table =} \FunctionTok{dbQuoteIdentifier}\NormalTok{(db, table\_name))}
  \FunctionTok{return}\NormalTok{(}\FunctionTok{subset}\NormalTok{(}\FunctionTok{dbGetQuery}\NormalTok{(db, sql), }\AttributeTok{select =} \SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(id)))}
\NormalTok{\}}

\CommentTok{\# protein ID and transcript ID map table}
\NormalTok{id\_map }\OtherTok{\textless{}{-}} \FunctionTok{dbGetQuery}\NormalTok{(db, }\StringTok{\textquotesingle{}SELECT dbxref\_1.accession AS accession, dbxref\_1.dbxref\_id AS protein\_id FROM dbxref AS dbxref\_1}
\StringTok{                         LEFT OUTER JOIN feature AS feature\_1 ON dbxref\_1.dbxref\_id = feature\_1.dbxref\_id}
\StringTok{                         LEFT OUTER JOIN cvterm ON feature\_1.type\_id = cvterm.cvterm\_id}
\StringTok{                         LEFT OUTER JOIN feature\_relationship ON feature\_1.feature\_id = feature\_relationship.subject\_id}
\StringTok{                         LEFT OUTER JOIN feature AS feature\_2 ON feature\_relationship.object\_id = feature\_2.feature\_id}
\StringTok{                         LEFT OUTER JOIN dbxref AS dbxref\_2 ON feature\_2.dbxref\_id = dbxref\_2.dbxref\_id}
\StringTok{                         LEFT OUTER JOIN organism ON feature\_1.organism\_id = organism.organism\_id}
\StringTok{                         WHERE feature\_1.is\_obsolete = 0 AND cvterm.name = "polypeptide" AND organism.species="vivax\_P01"\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{immunological-data-sets}{%
\subsection{Immunological data sets}\label{immunological-data-sets}}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 1 immunological data} \end{center}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}

\CommentTok{\# predivac\_processed result for T{-}cell epitopes}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"predivac\_processed"}\NormalTok{, db))}

\CommentTok{\# bepipred\_2\_0 result for B{-}cell epitopes}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"bepipred\_2\_0\_processed"}\NormalTok{, db))}

\CommentTok{\# bepipred\_1\_0 result for B{-}cell epitopes}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"bepipred\_1\_0\_processed"}\NormalTok{, db))}

\CommentTok{\# abcpred result for B{-}cell epitopes}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"abcpred\_processed"}\NormalTok{, db))}

\CommentTok{\# ctlpred result for cytotoxic T{-}cell epitopes}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"ctlpred\_processed"}\NormalTok{, db))}

\CommentTok{\# il\_10pred result for interleukine{-}10 inducing epitopes}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"il\_10pred\_processed"}\NormalTok{, db))}

\CommentTok{\# ifnepitope result for IFN{-}gamma inducing epitopes}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"ifnepitope\_processed"}\NormalTok{, db))}

\CommentTok{\# tappred for high binding affinity epitopes toward the TAP transporter}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"tappred\_processed"}\NormalTok{, db))}

\CommentTok{\# mhc\_i for MHC class I epitopes}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"mhc\_i"}\NormalTok{, db))}

\CommentTok{\# mhc\_ii for MHC class II epitopes}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"mhc\_ii"}\NormalTok{, db))}

\CommentTok{\# antigenicity}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"antigenicity"}\NormalTok{, db))}

\CommentTok{\# immunogenicity}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"immunogenicity"}\NormalTok{, db))}

\CommentTok{\# merge immunological data sets}
\NormalTok{immunological\_ds }\OtherTok{\textless{}{-}}\NormalTok{ id\_map[}\StringTok{"protein\_id"}\NormalTok{]}
\ControlFlowTok{for}\NormalTok{ (ds }\ControlFlowTok{in}\NormalTok{ immu) \{}
\NormalTok{  immunological\_ds }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ immunological\_ds, }\AttributeTok{y =}\NormalTok{ ds, }\AttributeTok{by =} \StringTok{"protein\_id"}\NormalTok{, }\AttributeTok{all.x =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{proteomic-data-sets}{%
\subsection{Proteomic data sets}\label{proteomic-data-sets}}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 1 proteomic data} \end{center}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}

\CommentTok{\# cello result for subcellualr localization}
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(pro, }\FunctionTok{subset}\NormalTok{(}\FunctionTok{get\_data}\NormalTok{(}\StringTok{"cello"}\NormalTok{, db), }\AttributeTok{select =} \SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(location\_id)))}

\CommentTok{\# maap result for malaria adhesin/adhesin{-}like proteins}
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(pro, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"maap"}\NormalTok{, db))}

\CommentTok{\# peptides result for physicochemical properties}
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(pro, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"r\_peptides"}\NormalTok{, db))}

\CommentTok{\# protr result for physicochemical properties}
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(pro, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"protr"}\NormalTok{, db))}

\CommentTok{\# hydrophilicity}
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(pro, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"hydrophilicity"}\NormalTok{, db))}

\CommentTok{\# predgpi result for gpi anchors prediction}
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(pro, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"predgpi"}\NormalTok{, db))}

\CommentTok{\# signalp result for signal cleavage prediction}
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(pro, }\FunctionTok{subset}\NormalTok{(}\FunctionTok{get\_data}\NormalTok{(}\StringTok{"signalp"}\NormalTok{, db), }\AttributeTok{select =} \SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(is\_secprotein, cleavage\_site, cs\_probability)))}

\CommentTok{\# abpred results for amino acid compositions and other variables}
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(pro, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"abpred"}\NormalTok{, db))}

\CommentTok{\# glycoep results for N{-}linked and O{-}linked glycosylation}
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(pro, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"glycoep\_processed"}\NormalTok{, db))}

\CommentTok{\# blastp result for similarity to human proteins}
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(pro, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"blastp"}\NormalTok{, db))}

\CommentTok{\# merge proteomic data sets}
\NormalTok{proteomic\_ds }\OtherTok{\textless{}{-}}\NormalTok{ id\_map[}\StringTok{"protein\_id"}\NormalTok{]}
\ControlFlowTok{for}\NormalTok{ (ds }\ControlFlowTok{in}\NormalTok{ pro) \{}
\NormalTok{  proteomic\_ds }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ proteomic\_ds, }\AttributeTok{y =}\NormalTok{ ds, }\AttributeTok{by =} \StringTok{"protein\_id"}\NormalTok{, }\AttributeTok{all.x =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{structural-data-sets}{%
\subsection{Structural data sets}\label{structural-data-sets}}

\begin{center}\includegraphics[width=0.25\linewidth]{./figures/Supplementary Fig 1 structural data} \end{center}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{struc }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}

\CommentTok{\# tmhmm result for transmembrane helices prediction}
\NormalTok{struc }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(struc, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"tmhmm\_processed"}\NormalTok{, db))}

\CommentTok{\# seg result for sequence complexity}
\NormalTok{struc }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(struc, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"seg"}\NormalTok{, db))}

\CommentTok{\# seg + tmhmm result}
\NormalTok{struc }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(struc, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"seg\_processed"}\NormalTok{, db))}

\CommentTok{\# b\_cell\_epitope\_methods for structural predictions}
\NormalTok{struc }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(struc, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"beta\_turn"}\NormalTok{, db))}
\NormalTok{struc }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(struc, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"surface\_accessibility"}\NormalTok{, db))}
\NormalTok{struc }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(struc, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"flexibility"}\NormalTok{, db))}

\CommentTok{\# merge structural analysis data sets}
\NormalTok{structural\_ds }\OtherTok{\textless{}{-}}\NormalTok{ id\_map[}\StringTok{"protein\_id"}\NormalTok{]}
\ControlFlowTok{for}\NormalTok{ (ds }\ControlFlowTok{in}\NormalTok{ struc) \{}
\NormalTok{  structural\_ds }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ structural\_ds, }\AttributeTok{y =}\NormalTok{ ds, }\AttributeTok{by =} \StringTok{"protein\_id"}\NormalTok{, }\AttributeTok{all.x =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{genomic-data-sets}{%
\subsection{Genomic data sets}\label{genomic-data-sets}}

\begin{center}\includegraphics[width=0.4\linewidth]{./figures/Supplementary Fig 1 genomic data} \end{center}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{geno }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}

\CommentTok{\# snp result}
\NormalTok{geno }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(geno, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"snp"}\NormalTok{, db))}

\CommentTok{\# merge structural analysis data sets}
\NormalTok{genomic\_ds }\OtherTok{\textless{}{-}}\NormalTok{ id\_map[}\StringTok{"protein\_id"}\NormalTok{]}
\ControlFlowTok{for}\NormalTok{ (ds }\ControlFlowTok{in}\NormalTok{ geno) \{}
\NormalTok{  genomic\_ds }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ genomic\_ds, }\AttributeTok{y =}\NormalTok{ ds, }\AttributeTok{by =} \StringTok{"protein\_id"}\NormalTok{, }\AttributeTok{all.x =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{final-assembly}{%
\subsection{Final assembly}\label{final-assembly}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# prepare predictor variables}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ immunological\_ds, }\AttributeTok{y =}\NormalTok{ proteomic\_ds, }\AttributeTok{by =} \StringTok{"protein\_id"}\NormalTok{, }\AttributeTok{all =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ data, }\AttributeTok{y =}\NormalTok{ structural\_ds, }\AttributeTok{by =} \StringTok{"protein\_id"}\NormalTok{, }\AttributeTok{all =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ data, }\AttributeTok{y =}\NormalTok{ genomic\_ds, }\AttributeTok{by =} \StringTok{"protein\_id"}\NormalTok{, }\AttributeTok{all =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ id\_map, }\AttributeTok{y =}\NormalTok{ data, }\AttributeTok{by =} \StringTok{"protein\_id"}\NormalTok{, }\AttributeTok{all.x =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{accession }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{accession}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(data, }\AttributeTok{select =} \SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(protein\_id, accession))}
\FunctionTok{rownames}\NormalTok{(data) }\OtherTok{\textless{}{-}}\NormalTok{ accession}

\CommentTok{\# write to output}
\FunctionTok{write.csv}\NormalTok{(data, output\_path)}

\CommentTok{\# close database connection}
\FunctionTok{dbDisconnect}\NormalTok{(db)}
\end{Highlighting}
\end{Shaded}

\hypertarget{generating-ml-input}{%
\section{Generating ML input}\label{generating-ml-input}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{response\_var }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pv\_antigen\_labels.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{predictor\_vars }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pv\_assembled\_data.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{ml\_input }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ response\_var, }\AttributeTok{y =}\NormalTok{ predictor\_vars, }\AttributeTok{by =} \StringTok{"row.names"}\NormalTok{, }\AttributeTok{all =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{row\_names }\OtherTok{\textless{}{-}}\NormalTok{ ml\_input}\SpecialCharTok{$}\NormalTok{Row.names}
\NormalTok{ml\_input }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(ml\_input, }\AttributeTok{select =} \SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(Row.names))}
\FunctionTok{rownames}\NormalTok{(ml\_input) }\OtherTok{\textless{}{-}}\NormalTok{ row\_names}

\CommentTok{\# write to output}
\FunctionTok{write.csv}\NormalTok{(ml\_input, }\StringTok{"./data/supplementary\_data\_2\_pv\_ml\_input.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sessionInfo}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## R version 4.2.3 (2023-03-15)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur ... 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] rlist_0.4.6.2  DBI_1.1.3      RMariaDB_1.2.2
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.10       rstudioapi_0.14   knitr_1.42        magrittr_2.0.3   
##  [5] hms_1.1.3         bit_4.0.5         R.cache_0.16.0    rlang_1.1.1      
##  [9] fastmap_1.1.1     styler_1.9.1      tools_4.2.3       data.table_1.14.8
## [13] xfun_0.39         R.oo_1.25.0       cli_3.6.1         htmltools_0.5.5  
## [17] yaml_2.3.7        bit64_4.0.5       digest_0.6.31     lifecycle_1.0.3  
## [21] bookdown_0.34     purrr_1.0.1       vctrs_0.6.2       R.utils_2.12.2   
## [25] codetools_0.2-19  glue_1.6.2        evaluate_0.21     rmarkdown_2.21   
## [29] compiler_4.2.3    R.methodsS3_1.8.2 pkgconfig_2.0.3
\end{verbatim}

\hypertarget{02_model_training}{%
\chapter{Model training}\label{02_model_training}}

\hypertarget{hyper-parameter-tuning-for-purf}{%
\section{Hyper-parameter tuning for PURF}\label{hyper-parameter-tuning-for-purf}}

\hypertarget{analysis}{%
\subsection{Analysis}\label{analysis}}

\textbf{In Python: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(reticulate)}
\FunctionTok{use\_condaenv}\NormalTok{(}\StringTok{"/Users/renee/Library/r{-}miniconda/envs/purf/bin/python"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}
\ImportTok{from}\NormalTok{ sklearn.utils }\ImportTok{import}\NormalTok{ shuffle}
\ImportTok{import}\NormalTok{ numpy }\ImportTok{as}\NormalTok{ np}
\ImportTok{import}\NormalTok{ pickle}
\ImportTok{from}\NormalTok{ sklearn.impute }\ImportTok{import}\NormalTok{ SimpleImputer}
\ImportTok{from}\NormalTok{ purf.pu\_ensemble }\ImportTok{import}\NormalTok{ PURandomForestClassifier}
\ImportTok{from}\NormalTok{ sklearn.preprocessing }\ImportTok{import}\NormalTok{ MinMaxScaler}
\ImportTok{from}\NormalTok{ scipy.spatial }\ImportTok{import}\NormalTok{ distance}
\ImportTok{from}\NormalTok{ joblib }\ImportTok{import}\NormalTok{ Parallel, delayed}
\ImportTok{from}\NormalTok{ sklearn.ensemble.\_forest }\ImportTok{import}\NormalTok{ \_generate\_unsampled\_indices}
\ImportTok{import}\NormalTok{ os}
\ImportTok{import}\NormalTok{ re}
\ImportTok{import}\NormalTok{ session\_info}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# private function for train\_purf()}
\KeywordTok{def}\NormalTok{ \_get\_ref\_antigen\_stats(idx, tree, X, y, ref\_indices, max\_samples}\OperatorTok{=}\VariableTok{None}\NormalTok{):}
    \ControlFlowTok{if}\NormalTok{ max\_samples }\KeywordTok{is} \VariableTok{None}\NormalTok{:}
\NormalTok{        max\_samples }\OperatorTok{=}\NormalTok{ y.shape[}\DecValTok{0}\NormalTok{]}
\NormalTok{    oob\_indices }\OperatorTok{=}\NormalTok{ \_generate\_unsampled\_indices(tree.random\_state, y.shape[}\DecValTok{0}\NormalTok{], max\_samples)}
\NormalTok{    ref\_oob }\OperatorTok{=}\NormalTok{ [i }\KeywordTok{in}\NormalTok{ oob\_indices }\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in}\NormalTok{ ref\_indices]}
\NormalTok{    ref\_pred }\OperatorTok{=} \BuiltInTok{list}\NormalTok{()}
\NormalTok{    pred }\OperatorTok{=}\NormalTok{ tree.predict\_proba(X[ref\_indices,:], check\_input}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\NormalTok{    ref\_pred }\OperatorTok{=}\NormalTok{ pred[:,}\DecValTok{1}\NormalTok{]}
    \ControlFlowTok{return}\NormalTok{ ref\_oob, ref\_pred}
  
\KeywordTok{def}\NormalTok{ train\_purf(features, outcome, pos\_level}\OperatorTok{=}\FloatTok{0.5}\NormalTok{, purf}\OperatorTok{=}\VariableTok{None}\NormalTok{, tree\_filtering}\OperatorTok{=}\VariableTok{False}\NormalTok{, ref\_antigens}\OperatorTok{=}\VariableTok{None}\NormalTok{, n\_jobs}\OperatorTok{=}\DecValTok{1}\NormalTok{):}
\NormalTok{    features, outcome }\OperatorTok{=}\NormalTok{ shuffle(features, outcome, random\_state}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
    \CommentTok{\# Imputation}
\NormalTok{    imputer }\OperatorTok{=}\NormalTok{ SimpleImputer(strategy}\OperatorTok{=}\StringTok{\textquotesingle{}median\textquotesingle{}}\NormalTok{)}
\NormalTok{    X }\OperatorTok{=}\NormalTok{ imputer.fit\_transform(features)}
\NormalTok{    X }\OperatorTok{=}\NormalTok{ pd.DataFrame(X, index}\OperatorTok{=}\NormalTok{features.index, columns}\OperatorTok{=}\NormalTok{features.columns)}
\NormalTok{    y }\OperatorTok{=}\NormalTok{ outcome}
\NormalTok{    features }\OperatorTok{=}\NormalTok{ X}
    \BuiltInTok{print}\NormalTok{(}\StringTok{\textquotesingle{}There are }\SpecialCharTok{\%d}\StringTok{ positives out of }\SpecialCharTok{\%d}\StringTok{ samples before feature space weighting.\textquotesingle{}} \OperatorTok{\%}\NormalTok{ (}\BuiltInTok{sum}\NormalTok{(y), }\BuiltInTok{len}\NormalTok{(y)))}
    \CommentTok{\# Feature space weighting}
\NormalTok{    lab\_pos }\OperatorTok{=}\NormalTok{ X.loc[y}\OperatorTok{==}\DecValTok{1}\NormalTok{,:]}
\NormalTok{    median }\OperatorTok{=}\NormalTok{ np.median(lab\_pos, axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
    \CommentTok{\# Feature space weighting}
\NormalTok{    lab\_pos }\OperatorTok{=}\NormalTok{ X.loc[y}\OperatorTok{==}\DecValTok{1}\NormalTok{,:]}
\NormalTok{    median }\OperatorTok{=}\NormalTok{ np.median(lab\_pos, axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{    scaler }\OperatorTok{=}\NormalTok{ MinMaxScaler(feature\_range}\OperatorTok{=}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{10}\NormalTok{))}
\NormalTok{    dist }\OperatorTok{=} \BuiltInTok{list}\NormalTok{()}
    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(lab\_pos.shape[}\DecValTok{0}\NormalTok{]):}
\NormalTok{        dist.append(distance.euclidean(lab\_pos.iloc[i, :], median))}
\NormalTok{    dist }\OperatorTok{=}\NormalTok{ np.asarray(dist).reshape(}\OperatorTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{    counts }\OperatorTok{=}\NormalTok{ np.}\BuiltInTok{round}\NormalTok{(scaler.fit\_transform(dist))}
\NormalTok{    counts }\OperatorTok{=}\NormalTok{ np.array(counts, dtype}\OperatorTok{=}\NormalTok{np.int64)[:, }\DecValTok{0}\NormalTok{]}
\NormalTok{    X\_temp }\OperatorTok{=}\NormalTok{ X.iloc[y}\OperatorTok{==}\DecValTok{1}\NormalTok{, :]}
\NormalTok{    X }\OperatorTok{=}\NormalTok{ X.iloc[y}\OperatorTok{==}\DecValTok{0}\NormalTok{, :]}
\NormalTok{    y }\OperatorTok{=}\NormalTok{ np.asarray([}\DecValTok{0}\NormalTok{] }\OperatorTok{*}\NormalTok{ X.shape[}\DecValTok{0}\NormalTok{] }\OperatorTok{+}\NormalTok{ [}\DecValTok{1}\NormalTok{] }\OperatorTok{*}\NormalTok{ (}\BuiltInTok{sum}\NormalTok{(counts)))}
\NormalTok{    appended\_data }\OperatorTok{=}\NormalTok{ [X]}
    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(counts)):}
\NormalTok{        appended\_data.append(pd.concat([X\_temp.iloc[[i]]] }\OperatorTok{*}\NormalTok{ counts[i]))}
\NormalTok{    X }\OperatorTok{=}\NormalTok{ pd.concat(appended\_data)}
    \BuiltInTok{print}\NormalTok{(}\StringTok{\textquotesingle{}There are }\SpecialCharTok{\%d}\StringTok{ positives out of }\SpecialCharTok{\%d}\StringTok{ samples after feature space weighting.\textquotesingle{}} \OperatorTok{\%}\NormalTok{ (}\BuiltInTok{sum}\NormalTok{(y), }\BuiltInTok{len}\NormalTok{(y)))}
\NormalTok{    res }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{: X.index, }\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{ : y\})}
    \ControlFlowTok{if}\NormalTok{ tree\_filtering }\KeywordTok{is} \VariableTok{True}\NormalTok{:}
        \CommentTok{\# get ref antigen indices}
\NormalTok{        ref\_index\_dict }\OperatorTok{=}\NormalTok{ \{ref:}\BuiltInTok{list}\NormalTok{() }\ControlFlowTok{for}\NormalTok{ ref }\KeywordTok{in} \BuiltInTok{list}\NormalTok{(ref\_antigens.values())\}}
        \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(res.shape[}\DecValTok{0}\NormalTok{]):}
            \ControlFlowTok{if}\NormalTok{ res[}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{][i] }\KeywordTok{in} \BuiltInTok{list}\NormalTok{(ref\_antigens.values()):}
\NormalTok{                ref\_index\_dict[res[}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{][i]].append(res.index[i])}
\NormalTok{        ref\_indices }\OperatorTok{=} \BuiltInTok{sum}\NormalTok{(ref\_index\_dict.values(), [])}
        \CommentTok{\# get OOB stats and predictions}
\NormalTok{        X }\OperatorTok{=}\NormalTok{ X.astype(}\StringTok{\textquotesingle{}float32\textquotesingle{}}\NormalTok{)}
\NormalTok{        trees }\OperatorTok{=}\NormalTok{ purf.estimators\_}
\NormalTok{        idx\_list }\OperatorTok{=}\NormalTok{ [i }\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(trees))]}
\NormalTok{        stats\_res }\OperatorTok{=}\NormalTok{ Parallel(n\_jobs}\OperatorTok{=}\NormalTok{n\_jobs)(}
\NormalTok{                    delayed(\_get\_ref\_antigen\_stats)(idx, trees[idx], np.array(X), y, ref\_indices) }\ControlFlowTok{for}\NormalTok{ idx }\KeywordTok{in}\NormalTok{ idx\_list)}
        \CommentTok{\# ref\_oob data structure:}
        \CommentTok{\# rows represent individual trees}
        \CommentTok{\# column represent reference antigens}
        \CommentTok{\# cells indicate whether the reference antigen is in the OOB samples of the tree}
\NormalTok{        ref\_oob }\OperatorTok{=}\NormalTok{ np.array([ref\_oob }\ControlFlowTok{for}\NormalTok{ ref\_oob, ref\_pred }\KeywordTok{in}\NormalTok{ stats\_res])}
        \CommentTok{\# ref\_pred data structure:}
        \CommentTok{\# rows represent individual trees}
        \CommentTok{\# column represent reference antigens}
        \CommentTok{\# cells indicate the prediction of the reference antigen by the tree}
\NormalTok{        ref\_pred }\OperatorTok{=}\NormalTok{ np.array([ref\_pred }\ControlFlowTok{for}\NormalTok{ ref\_oob, ref\_pred }\KeywordTok{in}\NormalTok{ stats\_res])}
        \CommentTok{\# analyze duplicated reference antigens as a group}
\NormalTok{        cumsum\_num\_ref }\OperatorTok{=}\NormalTok{ np.cumsum(np.array([}\BuiltInTok{len}\NormalTok{(v) }\ControlFlowTok{for}\NormalTok{ k,v }\KeywordTok{in}\NormalTok{ ref\_index\_dict.items()]))}
\NormalTok{        ref\_oob\_all }\OperatorTok{=}\NormalTok{ np.array([ref\_oob[:, }\DecValTok{0}\NormalTok{:cumsum\_num\_ref[i]].}\BuiltInTok{any}\NormalTok{(axis}\OperatorTok{=}\DecValTok{1}\NormalTok{) }\ControlFlowTok{if}\NormalTok{ i }\OperatorTok{==} \DecValTok{0} \ControlFlowTok{else} \OperatorTok{\textbackslash{}}
\NormalTok{                                ref\_oob[:, cumsum\_num\_ref[i }\OperatorTok{{-}} \DecValTok{1}\NormalTok{]:cumsum\_num\_ref[i]].}\BuiltInTok{any}\NormalTok{(axis}\OperatorTok{=}\DecValTok{1}\NormalTok{) }\OperatorTok{\textbackslash{}}
                                \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(ref\_antigens))]).T}
\NormalTok{        ref\_pred\_all }\OperatorTok{=}\NormalTok{ np.array([ref\_pred[:, }\DecValTok{0}\NormalTok{:cumsum\_num\_ref[i]].}\BuiltInTok{any}\NormalTok{(axis}\OperatorTok{=}\DecValTok{1}\NormalTok{) }\ControlFlowTok{if}\NormalTok{ i }\OperatorTok{==} \DecValTok{0} \ControlFlowTok{else} \OperatorTok{\textbackslash{}}
\NormalTok{                                 ref\_pred[:, cumsum\_num\_ref[i }\OperatorTok{{-}} \DecValTok{1}\NormalTok{]:cumsum\_num\_ref[i]].}\BuiltInTok{sum}\NormalTok{(axis}\OperatorTok{=}\DecValTok{1}\NormalTok{) }\OperatorTok{\textbackslash{}}
                                 \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(ref\_antigens))]).T}
        \CommentTok{\# calculate number of reference antigens as OOB samples for each tree}
\NormalTok{        oob\_total }\OperatorTok{=}\NormalTok{ ref\_oob\_all.}\BuiltInTok{sum}\NormalTok{(axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
        \CommentTok{\# assign score of 1 to trees that correctly predict all OOB reference antigens; otherwise, assign 0 score }
\NormalTok{        weights }\OperatorTok{=}\NormalTok{ np.zeros(}\BuiltInTok{len}\NormalTok{(trees))}
        \CommentTok{\# iterate through the trees and calculate the stats}
        \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(trees)):}
\NormalTok{            oob\_list }\OperatorTok{=} \BuiltInTok{list}\NormalTok{(ref\_oob\_all[i,:])}
\NormalTok{            pred\_list }\OperatorTok{=} \BuiltInTok{list}\NormalTok{(ref\_pred\_all[i,:])}
            \ControlFlowTok{if}\NormalTok{ oob\_total[i] }\OperatorTok{==} \DecValTok{0}\NormalTok{:}
\NormalTok{                weights[i] }\OperatorTok{=} \DecValTok{0}
            \ControlFlowTok{else}\NormalTok{:}
                \ControlFlowTok{if} \BuiltInTok{sum}\NormalTok{(np.array(pred\_list)[oob\_list] }\OperatorTok{!=} \DecValTok{0}\NormalTok{) }\OperatorTok{==}\NormalTok{ oob\_total[i]:}
\NormalTok{                    weights[i] }\OperatorTok{=} \DecValTok{1}
    \ControlFlowTok{if}\NormalTok{ tree\_filtering }\KeywordTok{is} \VariableTok{False}\NormalTok{:}
        \CommentTok{\# Training PURF}
\NormalTok{        purf }\OperatorTok{=}\NormalTok{ PURandomForestClassifier(}
\NormalTok{            n\_estimators }\OperatorTok{=} \DecValTok{100000}\NormalTok{,}
\NormalTok{            oob\_score }\OperatorTok{=} \VariableTok{True}\NormalTok{,}
\NormalTok{            n\_jobs }\OperatorTok{=} \DecValTok{64}\NormalTok{,}
\NormalTok{            random\_state }\OperatorTok{=} \DecValTok{42}\NormalTok{,}
\NormalTok{            pos\_level }\OperatorTok{=}\NormalTok{ pos\_level}
\NormalTok{        )}
\NormalTok{        purf.fit(X, y)}
    \ControlFlowTok{else}\NormalTok{:}
\NormalTok{        purf.\_set\_oob\_score\_with\_weights(np.array(X), y.reshape(}\OperatorTok{{-}}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{), weights}\OperatorTok{=}\NormalTok{weights)}
    \CommentTok{\# Storing results}
\NormalTok{    res[}\StringTok{\textquotesingle{}OOB score\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ purf.oob\_decision\_function\_[:,}\DecValTok{1}\NormalTok{]}
\NormalTok{    res }\OperatorTok{=}\NormalTok{ features.merge(res.groupby(}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{).mean(), left\_index}\OperatorTok{=}\VariableTok{True}\NormalTok{, right\_on}\OperatorTok{=}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{)}
\NormalTok{    res }\OperatorTok{=}\NormalTok{ res[[}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}OOB score\textquotesingle{}}\NormalTok{]]}
    \ControlFlowTok{if}\NormalTok{ tree\_filtering }\KeywordTok{is} \VariableTok{False}\NormalTok{:}
        \ControlFlowTok{return}\NormalTok{ (purf, res)}
    \ControlFlowTok{else}\NormalTok{:}
        \ControlFlowTok{return}\NormalTok{ (\{}\StringTok{\textquotesingle{}model\textquotesingle{}}\NormalTok{: purf, }\StringTok{\textquotesingle{}weights\textquotesingle{}}\NormalTok{: weights\}, res)}
\end{Highlighting}
\end{Shaded}

\hypertarget{pv-data-set}{%
\subsubsection{Pv data set}\label{pv-data-set}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ref\_antigens }\OperatorTok{=}\NormalTok{ \{}\StringTok{\textquotesingle{}CSP\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PVP01\_0835600.1{-}p1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}DBP\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PVP01\_0623800.1{-}p1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}MSP1\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PVP01\_0728900.1{-}p1\textquotesingle{}}\NormalTok{\}}
\NormalTok{data }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./other\_data/pv\_ml\_input.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{features }\OperatorTok{=}\NormalTok{ data.iloc[:, }\DecValTok{1}\NormalTok{:]}
\NormalTok{outcome }\OperatorTok{=}\NormalTok{ np.array(data.antigen\_label)}

\ControlFlowTok{for}\NormalTok{ pos\_level }\KeywordTok{in}\NormalTok{ [}\FloatTok{0.5}\NormalTok{, }\FloatTok{0.4}\NormalTok{, }\FloatTok{0.6}\NormalTok{, }\FloatTok{0.3}\NormalTok{, }\FloatTok{0.7}\NormalTok{, }\FloatTok{0.2}\NormalTok{, }\FloatTok{0.8}\NormalTok{, }\FloatTok{0.1}\NormalTok{, }\FloatTok{0.9}\NormalTok{]:}
\NormalTok{    (purf, res) }\OperatorTok{=}\NormalTok{ train\_purf(features, outcome, pos\_level}\OperatorTok{=}\NormalTok{pos\_level, tree\_filtering}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\NormalTok{    (purf\_filtered, res\_filtered) }\OperatorTok{=}\NormalTok{ train\_purf(features, outcome, pos\_level}\OperatorTok{=}\NormalTok{pos\_level, purf}\OperatorTok{=}\NormalTok{purf, tree\_filtering}\OperatorTok{=}\VariableTok{True}\NormalTok{, ref\_antigens}\OperatorTok{=}\NormalTok{ref\_antigens)}
\NormalTok{    res[}\StringTok{\textquotesingle{}OOB score filtered\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ res\_filtered[}\StringTok{\textquotesingle{}OOB score\textquotesingle{}}\NormalTok{]}
\NormalTok{    res.to\_csv(}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pv\_pos\_level/}\SpecialCharTok{\%.1f}\StringTok{\_res.tsv\textquotesingle{}} \OperatorTok{\%}\NormalTok{ pos\_level)}
    \ControlFlowTok{with} \BuiltInTok{open}\NormalTok{(}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pv\_pos\_level/}\SpecialCharTok{\%.1f}\StringTok{\_purf\_tree\_filtering.pkl\textquotesingle{}} \OperatorTok{\%}\NormalTok{ pos\_level, }\StringTok{\textquotesingle{}wb\textquotesingle{}}\NormalTok{) }\ImportTok{as}\NormalTok{ out:}
\NormalTok{        pickle.dump(purf\_filtered, out, pickle.HIGHEST\_PROTOCOL)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{dir} \OperatorTok{=} \StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pv\_pos\_level/\textquotesingle{}}
\NormalTok{files }\OperatorTok{=}\NormalTok{ os.listdir(}\BuiltInTok{dir}\NormalTok{)}
\NormalTok{tmp }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\BuiltInTok{dir} \OperatorTok{+} \StringTok{\textquotesingle{}0.1\_res.tsv\textquotesingle{}}\NormalTok{, sep}\OperatorTok{=}\StringTok{\textquotesingle{}}\CharTok{\textbackslash{}t}\StringTok{\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)[}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{]}

\NormalTok{data\_frames }\OperatorTok{=}\NormalTok{ [pd.read\_csv(}\BuiltInTok{dir} \OperatorTok{+} \StringTok{\textquotesingle{}}\SpecialCharTok{\%.1f}\StringTok{\_res.tsv\textquotesingle{}} \OperatorTok{\%}\NormalTok{ pos\_level, sep}\OperatorTok{=}\StringTok{\textquotesingle{}}\CharTok{\textbackslash{}t}\StringTok{\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)[}\StringTok{\textquotesingle{}OOB score filtered\textquotesingle{}}\NormalTok{] }\ControlFlowTok{for}\NormalTok{ pos\_level }\KeywordTok{in}\NormalTok{ np.arange(}\FloatTok{0.1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{0.1}\NormalTok{)]}
\NormalTok{merged\_df }\OperatorTok{=}\NormalTok{ pd.concat([tmp] }\OperatorTok{+}\NormalTok{ data\_frames, join}\OperatorTok{=}\StringTok{\textquotesingle{}outer\textquotesingle{}}\NormalTok{, axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{colnames }\OperatorTok{=}\NormalTok{ [}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{] }\OperatorTok{+}\NormalTok{ [}\StringTok{\textquotesingle{}}\SpecialCharTok{\%.1f}\StringTok{\textquotesingle{}} \OperatorTok{\%}\NormalTok{ pos\_level }\ControlFlowTok{for}\NormalTok{ pos\_level }\KeywordTok{in}\NormalTok{ np.arange(}\FloatTok{0.1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{0.1}\NormalTok{)]}
\NormalTok{merged\_df.columns }\OperatorTok{=}\NormalTok{ colnames}
\NormalTok{merged\_df.to\_csv(}\StringTok{\textquotesingle{}./other\_data/pv\_pos\_level\_parameter\_tuning.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{pv-pf-combined-data-set}{%
\subsubsection{Pv + Pf combined data set}\label{pv-pf-combined-data-set}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ref\_antigens }\OperatorTok{=}\NormalTok{ \{}\StringTok{\textquotesingle{}CSP (Pf)\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PF3D7\_0304600.1{-}p1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}RH5 (Pf)\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PF3D7\_0424100.1{-}p1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}MSP5 (Pf)\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PF3D7\_0206900.1{-}p1\textquotesingle{}}\NormalTok{,}
                \StringTok{\textquotesingle{}P230 (Pf)\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PF3D7\_0209000.1{-}p1\textquotesingle{}}\NormalTok{,}
                \StringTok{\textquotesingle{}CSP (Pv)\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PVP01\_0835600.1{-}p1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}DBP (Pv)\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PVP01\_0623800.1{-}p1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}MSP1 (Pv)\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PVP01\_0728900.1{-}p1\textquotesingle{}}\NormalTok{\}}
\NormalTok{data }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./data/supplementary\_data\_4\_pfpv\_ml\_input.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{features }\OperatorTok{=}\NormalTok{ data.iloc[:, }\DecValTok{1}\NormalTok{:]}
\NormalTok{outcome }\OperatorTok{=}\NormalTok{ np.array(data.antigen\_label)}

\ControlFlowTok{for}\NormalTok{ pos\_level }\KeywordTok{in}\NormalTok{ [}\FloatTok{0.5}\NormalTok{, }\FloatTok{0.4}\NormalTok{, }\FloatTok{0.6}\NormalTok{, }\FloatTok{0.3}\NormalTok{, }\FloatTok{0.7}\NormalTok{, }\FloatTok{0.2}\NormalTok{, }\FloatTok{0.8}\NormalTok{, }\FloatTok{0.1}\NormalTok{, }\FloatTok{0.9}\NormalTok{]:}
\NormalTok{    (purf, res) }\OperatorTok{=}\NormalTok{ train\_purf(features, outcome, pos\_level}\OperatorTok{=}\NormalTok{pos\_level, tree\_filtering}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\NormalTok{    (purf\_filtered, res\_filtered) }\OperatorTok{=}\NormalTok{ train\_purf(features, outcome, pos\_level}\OperatorTok{=}\NormalTok{pos\_level, purf}\OperatorTok{=}\NormalTok{purf, tree\_filtering}\OperatorTok{=}\VariableTok{True}\NormalTok{, ref\_antigens}\OperatorTok{=}\NormalTok{ref\_antigens)}
\NormalTok{    res[}\StringTok{\textquotesingle{}OOB score filtered\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ res\_filtered[}\StringTok{\textquotesingle{}OOB score\textquotesingle{}}\NormalTok{]}
\NormalTok{    res.to\_csv(}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pfpv\_pos\_level/}\SpecialCharTok{\%.1f}\StringTok{\_res.tsv\textquotesingle{}} \OperatorTok{\%}\NormalTok{ pos\_level)}
    \ControlFlowTok{with} \BuiltInTok{open}\NormalTok{(}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pfpv\_pos\_level/}\SpecialCharTok{\%.1f}\StringTok{\_purf\_tree\_filtering.pkl\textquotesingle{}} \OperatorTok{\%}\NormalTok{ pos\_level, }\StringTok{\textquotesingle{}wb\textquotesingle{}}\NormalTok{) }\ImportTok{as}\NormalTok{ out:}
\NormalTok{        pickle.dump(purf\_filtered, out, pickle.HIGHEST\_PROTOCOL)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{dir} \OperatorTok{=} \StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pfpv\_pos\_level/\textquotesingle{}}
\NormalTok{files }\OperatorTok{=}\NormalTok{ os.listdir(}\BuiltInTok{dir}\NormalTok{)}
\NormalTok{tmp }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\BuiltInTok{dir} \OperatorTok{+} \StringTok{\textquotesingle{}0.1\_res.tsv\textquotesingle{}}\NormalTok{, sep}\OperatorTok{=}\StringTok{\textquotesingle{}}\CharTok{\textbackslash{}t}\StringTok{\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)[}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{]}

\NormalTok{data\_frames }\OperatorTok{=}\NormalTok{ [pd.read\_csv(}\BuiltInTok{dir} \OperatorTok{+} \StringTok{\textquotesingle{}}\SpecialCharTok{\%.1f}\StringTok{\_res.tsv\textquotesingle{}} \OperatorTok{\%}\NormalTok{ pos\_level, sep}\OperatorTok{=}\StringTok{\textquotesingle{}}\CharTok{\textbackslash{}t}\StringTok{\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)[}\StringTok{\textquotesingle{}OOB score filtered\textquotesingle{}}\NormalTok{] }\ControlFlowTok{for}\NormalTok{ pos\_level }\KeywordTok{in}\NormalTok{ np.arange(}\FloatTok{0.1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{0.1}\NormalTok{)]}
\NormalTok{merged\_df }\OperatorTok{=}\NormalTok{ pd.concat([tmp] }\OperatorTok{+}\NormalTok{ data\_frames, join}\OperatorTok{=}\StringTok{\textquotesingle{}outer\textquotesingle{}}\NormalTok{, axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{colnames }\OperatorTok{=}\NormalTok{ [}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{] }\OperatorTok{+}\NormalTok{ [}\StringTok{\textquotesingle{}}\SpecialCharTok{\%.1f}\StringTok{\textquotesingle{}} \OperatorTok{\%}\NormalTok{ pos\_level }\ControlFlowTok{for}\NormalTok{ pos\_level }\KeywordTok{in}\NormalTok{ np.arange(}\FloatTok{0.1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{0.1}\NormalTok{)]}
\NormalTok{merged\_df.columns }\OperatorTok{=}\NormalTok{ colnames}
\NormalTok{merged\_df.to\_csv(}\StringTok{\textquotesingle{}./other\_data/pfpv\_pos\_level\_parameter\_tuning.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{plotting}{%
\subsection{Plotting}\label{plotting}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(mixR)}
\FunctionTok{library}\NormalTok{(pracma)}
\FunctionTok{library}\NormalTok{(rlist)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(cowplot)}
\FunctionTok{library}\NormalTok{(grid)}
\FunctionTok{library}\NormalTok{(gridExtra)}
\end{Highlighting}
\end{Shaded}

\hypertarget{pv-data-set-1}{%
\subsubsection{Pv data set}\label{pv-data-set-1}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pv\_pos\_level\_parameter\_tuning.csv"}\NormalTok{, }\AttributeTok{header =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\CommentTok{\# Extract data with only unlabeled proteins}
\NormalTok{data\_unl }\OtherTok{\textless{}{-}}\NormalTok{ data[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, ]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plot\_list }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
\NormalTok{plot\_list2 }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{seq}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\FloatTok{0.9}\NormalTok{, }\FloatTok{0.1}\NormalTok{)) \{}
\NormalTok{  fit }\OtherTok{\textless{}{-}} \FunctionTok{mixfit}\NormalTok{(data\_unl[[}\FunctionTok{as.character}\NormalTok{(i)]], }\AttributeTok{ncomp =} \DecValTok{2}\NormalTok{)}

  \CommentTok{\# Calculate receiver operating characteristic (ROC) curve}
  \CommentTok{\# for putative positive and negative samples}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.5}\NormalTok{, }\FloatTok{1.5}\NormalTok{, }\AttributeTok{by =} \FloatTok{0.01}\NormalTok{)}
\NormalTok{  neg\_cum }\OtherTok{\textless{}{-}} \FunctionTok{pnorm}\NormalTok{(x, }\AttributeTok{mean =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{mu[}\DecValTok{1}\NormalTok{], }\AttributeTok{sd =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{sd[}\DecValTok{1}\NormalTok{])}
\NormalTok{  pos\_cum }\OtherTok{\textless{}{-}} \FunctionTok{pnorm}\NormalTok{(x, }\AttributeTok{mean =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{mu[}\DecValTok{2}\NormalTok{], }\AttributeTok{sd =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{sd[}\DecValTok{2}\NormalTok{])}
\NormalTok{  fpr }\OtherTok{\textless{}{-}}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ neg\_cum) }\SpecialCharTok{/}\NormalTok{ ((}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ neg\_cum) }\SpecialCharTok{+}\NormalTok{ neg\_cum) }\CommentTok{\# false positive / (false positive + true negative)}
\NormalTok{  tpr }\OtherTok{\textless{}{-}}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ pos\_cum) }\SpecialCharTok{/}\NormalTok{ ((}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ pos\_cum) }\SpecialCharTok{+}\NormalTok{ pos\_cum) }\CommentTok{\# true positive / (true positive + false negative)}

\NormalTok{  p }\OtherTok{\textless{}{-}} \FunctionTok{plot}\NormalTok{(fit, }\AttributeTok{title =} \FunctionTok{paste0}\NormalTok{(}
    \StringTok{"Positive level = "}\NormalTok{, i,}
    \StringTok{" (AUROC = "}\NormalTok{, }\FunctionTok{round}\NormalTok{(}\FunctionTok{trapz}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{fpr, tpr), }\DecValTok{2}\NormalTok{), }\StringTok{")"}
\NormalTok{  )) }\SpecialCharTok{+}
    \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#0080FF"}\NormalTok{, }\StringTok{"\#FF007F"}\NormalTok{), }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Putative negative"}\NormalTok{, }\StringTok{"Putative positive"}\NormalTok{)) }\SpecialCharTok{+}
    \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{    \{}
      \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \FloatTok{0.1}\NormalTok{) \{}
        \FunctionTok{theme}\NormalTok{(}
          \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.title =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.7}\NormalTok{, }\FloatTok{0.85}\NormalTok{),}
          \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{()}
\NormalTok{        )}
\NormalTok{      \} }\ControlFlowTok{else}\NormalTok{ \{}
        \FunctionTok{theme}\NormalTok{(}
          \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.title =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{        )}
\NormalTok{      \}}
\NormalTok{    \} }\SpecialCharTok{+}
    \FunctionTok{xlim}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.8}\NormalTok{, }\FloatTok{1.5}\NormalTok{)}

  \CommentTok{\# Calculate percent rank for labeled positives}
\NormalTok{  data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data[}\FunctionTok{c}\NormalTok{(}\StringTok{"antigen\_label"}\NormalTok{, }\FunctionTok{as.character}\NormalTok{(i))]}
  \FunctionTok{colnames}\NormalTok{(data\_) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"antigen\_label"}\NormalTok{, }\StringTok{"OOB score"}\NormalTok{)}
\NormalTok{  data\_}\SpecialCharTok{$}\NormalTok{percent\_rank }\OtherTok{\textless{}{-}} \FunctionTok{rank}\NormalTok{(data\_[[}\StringTok{"OOB score"}\NormalTok{]]) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data)}
\NormalTok{  data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data\_[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ]}
\NormalTok{  data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data\_[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{data\_}\SpecialCharTok{$}\NormalTok{percent\_rank), ]}
\NormalTok{  data\_}\SpecialCharTok{$}\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(data\_) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data\_)}
  \FunctionTok{cat}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"EPR: "}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data\_), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{))}

\NormalTok{  p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =} \StringTok{\textasciigrave{}}\AttributeTok{percent\_rank}\StringTok{\textasciigrave{}}\NormalTok{)) }\SpecialCharTok{+}
    \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey50"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{linewidth =} \FloatTok{0.1}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey30"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =} \StringTok{\textasciigrave{}}\AttributeTok{OOB score}\StringTok{\textasciigrave{}}\NormalTok{), }\AttributeTok{size =} \FloatTok{2.2}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey30"}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.1}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{scale\_fill\_gradient2}\NormalTok{(}\AttributeTok{low =} \StringTok{"\#0080FF"}\NormalTok{, }\AttributeTok{mid =} \StringTok{"white"}\NormalTok{, }\AttributeTok{high =} \StringTok{"\#FF007F"}\NormalTok{, }\AttributeTok{midpoint =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\SpecialCharTok{+}
    \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{    \{}
      \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \FloatTok{0.1}\NormalTok{) \{}
        \FunctionTok{theme}\NormalTok{(}
          \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.title =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{angle =} \DecValTok{0}\NormalTok{),}
          \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.5}\NormalTok{, }\FloatTok{0.15}\NormalTok{),}
          \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{legend.title.align =} \SpecialCharTok{{-}}\DecValTok{130}
\NormalTok{        )}
\NormalTok{      \} }\ControlFlowTok{else}\NormalTok{ \{}
        \FunctionTok{theme}\NormalTok{(}
          \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.title =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{        )}
\NormalTok{      \}}
\NormalTok{    \} }\SpecialCharTok{+}
\NormalTok{    \{}
      \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \FloatTok{0.1}\NormalTok{) \{}
        \FunctionTok{guides}\NormalTok{(}\AttributeTok{fill =} \FunctionTok{guide\_colourbar}\NormalTok{(}\AttributeTok{title.position =} \StringTok{"top"}\NormalTok{, }\AttributeTok{direction =} \StringTok{"horizontal"}\NormalTok{))}
\NormalTok{      \}}
\NormalTok{    \} }\SpecialCharTok{+}
\NormalTok{    \{}
      \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \FloatTok{0.1}\NormalTok{) \{}
        \FunctionTok{labs}\NormalTok{(}\AttributeTok{fill =} \StringTok{"Score (proportion of votes)"}\NormalTok{)}
\NormalTok{      \}}
\NormalTok{    \} }\SpecialCharTok{+}
    \FunctionTok{ggtitle}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}
      \StringTok{"Positive level = "}\NormalTok{, i,}
      \StringTok{" (AUC = "}\NormalTok{, }\FunctionTok{round}\NormalTok{(}\FunctionTok{trapz}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, data\_}\SpecialCharTok{$}\NormalTok{x, }\DecValTok{1}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, data\_}\SpecialCharTok{$}\NormalTok{percent\_rank, }\DecValTok{0}\NormalTok{)), }\DecValTok{2}\NormalTok{), }\StringTok{")"}
\NormalTok{    )) }\SpecialCharTok{+}
    \FunctionTok{ylim}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{  plot\_list }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(plot\_list, p)}
\NormalTok{  plot\_list2 }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(plot\_list2, p2)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{bimodal-distribution-plot}{%
\subsubsection{Bimodal distribution plot}\label{bimodal-distribution-plot}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x\_grob }\OtherTok{\textless{}{-}} \FunctionTok{textGrob}\NormalTok{(}\StringTok{"Score (proportion of votes)"}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontsize =} \DecValTok{15}\NormalTok{))}
\NormalTok{y\_grob }\OtherTok{\textless{}{-}} \FunctionTok{textGrob}\NormalTok{(}\StringTok{"Density"}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontsize =} \DecValTok{15}\NormalTok{), }\AttributeTok{rot =} \DecValTok{90}\NormalTok{)}
\FunctionTok{grid.arrange}\NormalTok{(}\FunctionTok{arrangeGrob}\NormalTok{(}\FunctionTok{plot\_grid}\NormalTok{(}\AttributeTok{plotlist =}\NormalTok{ plot\_list, }\AttributeTok{ncol =} \DecValTok{3}\NormalTok{), }\AttributeTok{left =}\NormalTok{ y\_grob, }\AttributeTok{bottom =}\NormalTok{ x\_grob))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 1} \end{center}

\hypertarget{known-antigen-ranking}{%
\subsubsection{Known antigen ranking}\label{known-antigen-ranking}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x\_grob2 }\OtherTok{\textless{}{-}} \FunctionTok{textGrob}\NormalTok{(}\StringTok{"Ranked known antigens (scaled)"}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontsize =} \DecValTok{15}\NormalTok{))}
\NormalTok{y\_grob2 }\OtherTok{\textless{}{-}} \FunctionTok{textGrob}\NormalTok{(}\StringTok{"Percent rank"}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontsize =} \DecValTok{15}\NormalTok{), }\AttributeTok{rot =} \DecValTok{90}\NormalTok{)}
\FunctionTok{grid.arrange}\NormalTok{(}\FunctionTok{arrangeGrob}\NormalTok{(}\FunctionTok{plot\_grid}\NormalTok{(}\AttributeTok{plotlist =}\NormalTok{ plot\_list2, }\AttributeTok{ncol =} \DecValTok{3}\NormalTok{), }\AttributeTok{left =}\NormalTok{ y\_grob2, }\AttributeTok{bottom =}\NormalTok{ x\_grob2))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 2} \end{center}

\hypertarget{pv-pf-combined-data-set-1}{%
\subsubsection{Pv + Pf combined data set}\label{pv-pf-combined-data-set-1}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pfpv\_pos\_level\_parameter\_tuning.csv"}\NormalTok{, }\AttributeTok{header =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\CommentTok{\# Extract data with only unlabeled proteins}
\NormalTok{data\_unl }\OtherTok{\textless{}{-}}\NormalTok{ data[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, ]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plot\_list3 }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
\NormalTok{plot\_list4 }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{seq}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\FloatTok{0.9}\NormalTok{, }\FloatTok{0.1}\NormalTok{)) \{}
\NormalTok{  fit }\OtherTok{\textless{}{-}} \FunctionTok{mixfit}\NormalTok{(data\_unl[[}\FunctionTok{as.character}\NormalTok{(i)]], }\AttributeTok{ncomp =} \DecValTok{2}\NormalTok{)}

  \CommentTok{\# Calculate receiver operating characteristic (ROC) curve}
  \CommentTok{\# for putative positive and negative samples}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.5}\NormalTok{, }\FloatTok{1.5}\NormalTok{, }\AttributeTok{by =} \FloatTok{0.01}\NormalTok{)}
\NormalTok{  neg\_cum }\OtherTok{\textless{}{-}} \FunctionTok{pnorm}\NormalTok{(x, }\AttributeTok{mean =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{mu[}\DecValTok{1}\NormalTok{], }\AttributeTok{sd =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{sd[}\DecValTok{1}\NormalTok{])}
\NormalTok{  pos\_cum }\OtherTok{\textless{}{-}} \FunctionTok{pnorm}\NormalTok{(x, }\AttributeTok{mean =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{mu[}\DecValTok{2}\NormalTok{], }\AttributeTok{sd =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{sd[}\DecValTok{2}\NormalTok{])}
\NormalTok{  fpr }\OtherTok{\textless{}{-}}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ neg\_cum) }\SpecialCharTok{/}\NormalTok{ ((}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ neg\_cum) }\SpecialCharTok{+}\NormalTok{ neg\_cum) }\CommentTok{\# false positive / (false positive + true negative)}
\NormalTok{  tpr }\OtherTok{\textless{}{-}}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ pos\_cum) }\SpecialCharTok{/}\NormalTok{ ((}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ pos\_cum) }\SpecialCharTok{+}\NormalTok{ pos\_cum) }\CommentTok{\# true positive / (true positive + false negative)}

\NormalTok{  p }\OtherTok{\textless{}{-}} \FunctionTok{plot}\NormalTok{(fit, }\AttributeTok{title =} \FunctionTok{paste0}\NormalTok{(}
    \StringTok{"Positive level = "}\NormalTok{, i,}
    \StringTok{" (AUROC = "}\NormalTok{, }\FunctionTok{round}\NormalTok{(}\FunctionTok{trapz}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{fpr, tpr), }\DecValTok{3}\NormalTok{), }\StringTok{")"}
\NormalTok{  )) }\SpecialCharTok{+}
    \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#0080FF"}\NormalTok{, }\StringTok{"\#FF007F"}\NormalTok{), }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Putative negative"}\NormalTok{, }\StringTok{"Putative positive"}\NormalTok{)) }\SpecialCharTok{+}
    \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{    \{}
      \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \FloatTok{0.1}\NormalTok{) \{}
        \FunctionTok{theme}\NormalTok{(}
          \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.title =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.7}\NormalTok{, }\FloatTok{0.85}\NormalTok{),}
          \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{()}
\NormalTok{        )}
\NormalTok{      \} }\ControlFlowTok{else}\NormalTok{ \{}
        \FunctionTok{theme}\NormalTok{(}
          \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.title =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{        )}
\NormalTok{      \}}
\NormalTok{    \} }\SpecialCharTok{+}
    \FunctionTok{xlim}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.8}\NormalTok{, }\FloatTok{1.5}\NormalTok{)}

  \CommentTok{\# Calculate percent rank for labeled positives}
\NormalTok{  data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data[}\FunctionTok{c}\NormalTok{(}\StringTok{"antigen\_label"}\NormalTok{, }\FunctionTok{as.character}\NormalTok{(i))]}
  \FunctionTok{colnames}\NormalTok{(data\_) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"antigen\_label"}\NormalTok{, }\StringTok{"OOB score"}\NormalTok{)}
\NormalTok{  data\_}\SpecialCharTok{$}\NormalTok{percent\_rank }\OtherTok{\textless{}{-}} \FunctionTok{rank}\NormalTok{(data\_[[}\StringTok{"OOB score"}\NormalTok{]]) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data)}
\NormalTok{  data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data\_[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ]}
\NormalTok{  data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data\_[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{data\_}\SpecialCharTok{$}\NormalTok{percent\_rank), ]}
\NormalTok{  data\_}\SpecialCharTok{$}\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(data\_) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data\_)}
  \FunctionTok{cat}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"EPR: "}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data\_), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{))}

\NormalTok{  p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =} \StringTok{\textasciigrave{}}\AttributeTok{percent\_rank}\StringTok{\textasciigrave{}}\NormalTok{)) }\SpecialCharTok{+}
    \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey50"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{linewidth =} \FloatTok{0.1}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey30"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =} \StringTok{\textasciigrave{}}\AttributeTok{OOB score}\StringTok{\textasciigrave{}}\NormalTok{), }\AttributeTok{size =} \FloatTok{1.2}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey30"}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.1}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{scale\_fill\_gradient2}\NormalTok{(}\AttributeTok{low =} \StringTok{"\#0080FF"}\NormalTok{, }\AttributeTok{mid =} \StringTok{"white"}\NormalTok{, }\AttributeTok{high =} \StringTok{"\#FF007F"}\NormalTok{, }\AttributeTok{midpoint =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\SpecialCharTok{+}
    \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{    \{}
      \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \FloatTok{0.1}\NormalTok{) \{}
        \FunctionTok{theme}\NormalTok{(}
          \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.title =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{angle =} \DecValTok{0}\NormalTok{),}
          \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.5}\NormalTok{, }\FloatTok{0.15}\NormalTok{),}
          \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{legend.title.align =} \SpecialCharTok{{-}}\DecValTok{130}
\NormalTok{        )}
\NormalTok{      \} }\ControlFlowTok{else}\NormalTok{ \{}
        \FunctionTok{theme}\NormalTok{(}
          \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.title =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{        )}
\NormalTok{      \}}
\NormalTok{    \} }\SpecialCharTok{+}
\NormalTok{    \{}
      \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \FloatTok{0.1}\NormalTok{) \{}
        \FunctionTok{guides}\NormalTok{(}\AttributeTok{fill =} \FunctionTok{guide\_colourbar}\NormalTok{(}\AttributeTok{title.position =} \StringTok{"top"}\NormalTok{, }\AttributeTok{direction =} \StringTok{"horizontal"}\NormalTok{))}
\NormalTok{      \}}
\NormalTok{    \} }\SpecialCharTok{+}
\NormalTok{    \{}
      \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \FloatTok{0.1}\NormalTok{) \{}
        \FunctionTok{labs}\NormalTok{(}\AttributeTok{fill =} \StringTok{"Score (proportion of votes)"}\NormalTok{)}
\NormalTok{      \}}
\NormalTok{    \} }\SpecialCharTok{+}
    \FunctionTok{ggtitle}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}
      \StringTok{"Positive level = "}\NormalTok{, i,}
      \StringTok{" (AUC = "}\NormalTok{, }\FunctionTok{round}\NormalTok{(}\FunctionTok{trapz}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, data\_}\SpecialCharTok{$}\NormalTok{x, }\DecValTok{1}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, data\_}\SpecialCharTok{$}\NormalTok{percent\_rank, }\DecValTok{0}\NormalTok{)), }\DecValTok{2}\NormalTok{), }\StringTok{")"}
\NormalTok{    )) }\SpecialCharTok{+}
    \FunctionTok{ylim}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{  plot\_list3 }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(plot\_list3, p)}
\NormalTok{  plot\_list4 }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(plot\_list4, p2)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{bimodal-distribution-plot-1}{%
\subsubsection{Bimodal distribution plot}\label{bimodal-distribution-plot-1}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x\_grob }\OtherTok{\textless{}{-}} \FunctionTok{textGrob}\NormalTok{(}\StringTok{"Score (proportion of votes)"}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontsize =} \DecValTok{15}\NormalTok{))}
\NormalTok{y\_grob }\OtherTok{\textless{}{-}} \FunctionTok{textGrob}\NormalTok{(}\StringTok{"Density"}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontsize =} \DecValTok{15}\NormalTok{), }\AttributeTok{rot =} \DecValTok{90}\NormalTok{)}
\FunctionTok{grid.arrange}\NormalTok{(}\FunctionTok{arrangeGrob}\NormalTok{(}\FunctionTok{plot\_grid}\NormalTok{(}\AttributeTok{plotlist =}\NormalTok{ plot\_list3, }\AttributeTok{ncol =} \DecValTok{3}\NormalTok{), }\AttributeTok{left =}\NormalTok{ y\_grob, }\AttributeTok{bottom =}\NormalTok{ x\_grob))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 3} \end{center}

\hypertarget{known-antigen-ranking-1}{%
\subsubsection{Known antigen ranking}\label{known-antigen-ranking-1}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x\_grob2 }\OtherTok{\textless{}{-}} \FunctionTok{textGrob}\NormalTok{(}\StringTok{"Ranked known antigens (scaled)"}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontsize =} \DecValTok{15}\NormalTok{))}
\NormalTok{y\_grob2 }\OtherTok{\textless{}{-}} \FunctionTok{textGrob}\NormalTok{(}\StringTok{"Percent rank"}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontsize =} \DecValTok{15}\NormalTok{), }\AttributeTok{rot =} \DecValTok{90}\NormalTok{)}
\FunctionTok{grid.arrange}\NormalTok{(}\FunctionTok{arrangeGrob}\NormalTok{(}\FunctionTok{plot\_grid}\NormalTok{(}\AttributeTok{plotlist =}\NormalTok{ plot\_list4, }\AttributeTok{ncol =} \DecValTok{3}\NormalTok{), }\AttributeTok{left =}\NormalTok{ y\_grob2, }\AttributeTok{bottom =}\NormalTok{ x\_grob2))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 4} \end{center}

\hypertarget{results-for-positive-level-0.5}{%
\subsection{Results for positive level = 0.5}\label{results-for-positive-level-0.5}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plot\_list[[}\DecValTok{5}\NormalTok{]]}\SpecialCharTok{$}\NormalTok{labels}\SpecialCharTok{$}\NormalTok{title }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{plot\_list2[[}\DecValTok{5}\NormalTok{]]}\SpecialCharTok{$}\NormalTok{labels}\SpecialCharTok{$}\NormalTok{title }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{plot\_list3[[}\DecValTok{5}\NormalTok{]]}\SpecialCharTok{$}\NormalTok{labels}\SpecialCharTok{$}\NormalTok{title }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{plot\_list4[[}\DecValTok{5}\NormalTok{]]}\SpecialCharTok{$}\NormalTok{labels}\SpecialCharTok{$}\NormalTok{title }\OtherTok{\textless{}{-}} \StringTok{""}

\NormalTok{plot\_list[[}\DecValTok{5}\NormalTok{]] }\OtherTok{\textless{}{-}}\NormalTok{ plot\_list[[}\DecValTok{5}\NormalTok{]] }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.title =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.2}\NormalTok{, }\FloatTok{0.91}\NormalTok{),}
    \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{()}
\NormalTok{  )}

\NormalTok{plot\_list2[[}\DecValTok{5}\NormalTok{]] }\OtherTok{\textless{}{-}}\NormalTok{ plot\_list2[[}\DecValTok{5}\NormalTok{]] }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.title =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{angle =} \DecValTok{0}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.35}\NormalTok{, }\FloatTok{0.13}\NormalTok{),}
    \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.title.align =} \SpecialCharTok{{-}}\DecValTok{130}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{guides}\NormalTok{(}\AttributeTok{fill =} \FunctionTok{guide\_colourbar}\NormalTok{(}\AttributeTok{title.position =} \StringTok{"top"}\NormalTok{, }\AttributeTok{direction =} \StringTok{"horizontal"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{fill =} \StringTok{"Score (proportion of votes)"}\NormalTok{)}

\NormalTok{x\_grob }\OtherTok{\textless{}{-}} \FunctionTok{textGrob}\NormalTok{(}\StringTok{"Score (proportion of votes)"}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontsize =} \DecValTok{10}\NormalTok{))}
\NormalTok{y\_grob }\OtherTok{\textless{}{-}} \FunctionTok{textGrob}\NormalTok{(}\StringTok{"Density"}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontsize =} \DecValTok{10}\NormalTok{), }\AttributeTok{rot =} \DecValTok{90}\NormalTok{)}
\NormalTok{x\_grob2 }\OtherTok{\textless{}{-}} \FunctionTok{textGrob}\NormalTok{(}\StringTok{"Ranked known antigens (scaled)"}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontsize =} \DecValTok{10}\NormalTok{))}
\NormalTok{y\_grob2 }\OtherTok{\textless{}{-}} \FunctionTok{textGrob}\NormalTok{(}\StringTok{"Percent rank"}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontsize =} \DecValTok{10}\NormalTok{), }\AttributeTok{rot =} \DecValTok{90}\NormalTok{)}
\FunctionTok{plot\_grid}\NormalTok{(}
  \FunctionTok{arrangeGrob}\NormalTok{(plot\_list[[}\DecValTok{5}\NormalTok{]], }\AttributeTok{left =}\NormalTok{ y\_grob, }\AttributeTok{bottom =}\NormalTok{ x\_grob),}
  \FunctionTok{arrangeGrob}\NormalTok{(plot\_list2[[}\DecValTok{5}\NormalTok{]], }\AttributeTok{left =}\NormalTok{ y\_grob2, }\AttributeTok{bottom =}\NormalTok{ x\_grob2),}
  \FunctionTok{arrangeGrob}\NormalTok{(plot\_list3[[}\DecValTok{5}\NormalTok{]], }\AttributeTok{left =}\NormalTok{ y\_grob, }\AttributeTok{bottom =}\NormalTok{ x\_grob),}
  \FunctionTok{arrangeGrob}\NormalTok{(plot\_list4[[}\DecValTok{5}\NormalTok{]], }\AttributeTok{left =}\NormalTok{ y\_grob2, }\AttributeTok{bottom =}\NormalTok{ x\_grob2),}
  \AttributeTok{nrow =} \DecValTok{2}\NormalTok{, }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{, }\StringTok{"d"}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Fig 1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sessionInfo}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## R version 4.2.3 (2023-03-15)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur ... 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
## [1] gridExtra_2.3   cowplot_1.1.1   ggplot2_3.4.2   rlist_0.4.6.2  
## [5] pracma_2.4.2    mixR_0.2.0      reticulate_1.28
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.10       pillar_1.9.0      compiler_4.2.3    R.methodsS3_1.8.2
##  [5] R.utils_2.12.2    tools_4.2.3       digest_0.6.31     tibble_3.2.1     
##  [9] jsonlite_1.8.4    evaluate_0.21     lifecycle_1.0.3   gtable_0.3.3     
## [13] lattice_0.21-8    R.cache_0.16.0    pkgconfig_2.0.3   png_0.1-8        
## [17] rlang_1.1.1       Matrix_1.5-4      cli_3.6.1         rstudioapi_0.14  
## [21] yaml_2.3.7        xfun_0.39         fastmap_1.1.1     dplyr_1.1.2      
## [25] withr_2.5.0       styler_1.9.1      knitr_1.42        generics_0.1.3   
## [29] vctrs_0.6.2       tidyselect_1.2.0  rprojroot_2.0.3   data.table_1.14.8
## [33] glue_1.6.2        here_1.0.1        R6_2.5.1          fansi_1.0.4      
## [37] rmarkdown_2.21    bookdown_0.34     purrr_1.0.1       magrittr_2.0.3   
## [41] scales_1.2.1      codetools_0.2-19  htmltools_0.5.5   colorspace_2.1-0 
## [45] utf8_1.2.3        munsell_0.5.0     R.oo_1.25.0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{session\_info.show()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -----
## joblib              1.1.1
## numpy               1.19.0
## pandas              1.3.2
## purf                NA
## scipy               1.8.0
## session_info        1.0.0
## sklearn             0.24.2
## -----
## Python 3.8.2 (default, Mar 26 2020, 10:45:18) [Clang 4.0.1 (tags/RELEASE_401/final)]
## macOS-10.16-x86_64-i386-64bit
## -----
## Session information updated at 2023-05-18 12:30
\end{verbatim}

\hypertarget{03_model_evaluation}{%
\chapter{Model evaluation}\label{03_model_evaluation}}

\hypertarget{known-antigen-prediction-accuracy}{%
\section{Known antigen prediction accuracy}\label{known-antigen-prediction-accuracy}}

\hypertarget{analysis-1}{%
\subsection{Analysis}\label{analysis-1}}

\textbf{In Python: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(reticulate)}
\FunctionTok{use\_condaenv}\NormalTok{(}\StringTok{"/Users/renee/Library/r{-}miniconda/envs/purf/bin/python"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}
\ImportTok{from}\NormalTok{ sklearn.ensemble }\ImportTok{import}\NormalTok{ RandomForestClassifier}
\ImportTok{import}\NormalTok{ numpy }\ImportTok{as}\NormalTok{ np}
\ImportTok{from}\NormalTok{ sklearn.impute }\ImportTok{import}\NormalTok{ SimpleImputer}
\ImportTok{from}\NormalTok{ sklearn.preprocessing }\ImportTok{import}\NormalTok{ MinMaxScaler}
\ImportTok{from}\NormalTok{ scipy.spatial }\ImportTok{import}\NormalTok{ distance}
\ImportTok{from}\NormalTok{ purf.pu\_ensemble }\ImportTok{import}\NormalTok{ PURandomForestClassifier}
\ImportTok{import}\NormalTok{ pickle}
\ImportTok{import}\NormalTok{ os}
\ImportTok{import}\NormalTok{ re}
\ImportTok{import}\NormalTok{ session\_info}
\end{Highlighting}
\end{Shaded}

\hypertarget{pv-model-cross-species-predictions}{%
\subsubsection{Pv model cross-species predictions}\label{pv-model-cross-species-predictions}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_ }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./other\_data/pv\_ml\_input.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{X\_ }\OperatorTok{=}\NormalTok{ data\_.iloc[:,}\DecValTok{1}\NormalTok{:]}
\NormalTok{imputer }\OperatorTok{=}\NormalTok{ SimpleImputer(strategy}\OperatorTok{=}\StringTok{\textquotesingle{}median\textquotesingle{}}\NormalTok{)}
\NormalTok{imputer.fit(X\_)}

\NormalTok{data }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./other\_data/pf\_ml\_input.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{X }\OperatorTok{=}\NormalTok{ data.iloc[:,}\DecValTok{1}\NormalTok{:]}
\NormalTok{y }\OperatorTok{=}\NormalTok{ np.array(data.antigen\_label)}

\NormalTok{pickle\_path }\OperatorTok{=} \StringTok{\textquotesingle{}./pv\_0.5\_purf\_tree\_filtering.pkl\textquotesingle{}}

\ControlFlowTok{with} \BuiltInTok{open}\NormalTok{(pickle\_path, }\StringTok{\textquotesingle{}rb\textquotesingle{}}\NormalTok{) }\ImportTok{as}\NormalTok{ infile:}
\NormalTok{    purf }\OperatorTok{=}\NormalTok{ pickle.load(infile)}

\CommentTok{\# Convert float type}
\NormalTok{X[X.select\_dtypes(np.float64).columns] }\OperatorTok{=}\NormalTok{ X.select\_dtypes(np.float64).astype(np.float32)}
\CommentTok{\# Impute missing values}
\NormalTok{X }\OperatorTok{=}\NormalTok{ imputer.transform(X)}

\NormalTok{pred }\OperatorTok{=}\NormalTok{ purf[}\StringTok{\textquotesingle{}model\textquotesingle{}}\NormalTok{].predict\_proba(X)[:,}\DecValTok{1}\NormalTok{]}

\NormalTok{res }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{: data.index, }\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{: y\})}
\NormalTok{res[}\StringTok{\textquotesingle{}OOB score filtered\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ pred}
\NormalTok{res.to\_csv(}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pv\_single\_cross\_predictions.csv\textquotesingle{}}\NormalTok{, index}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{pf-model-cross-species-predictions}{%
\subsubsection{Pf model cross-species predictions}\label{pf-model-cross-species-predictions}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_ }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./other\_data/pf\_ml\_input.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{X\_ }\OperatorTok{=}\NormalTok{ data\_.iloc[:,}\DecValTok{1}\NormalTok{:]}
\NormalTok{imputer }\OperatorTok{=}\NormalTok{ SimpleImputer(strategy}\OperatorTok{=}\StringTok{\textquotesingle{}median\textquotesingle{}}\NormalTok{)}
\NormalTok{imputer.fit(X\_)}

\NormalTok{data }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./other\_data/pv\_ml\_input.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{X }\OperatorTok{=}\NormalTok{ data.iloc[:,}\DecValTok{1}\NormalTok{:]}
\NormalTok{y }\OperatorTok{=}\NormalTok{ np.array(data.antigen\_label)}

\NormalTok{pickle\_path }\OperatorTok{=} \StringTok{\textquotesingle{}./pf\_0.5\_purf\_tree\_filtering.pkl\textquotesingle{}}

\ControlFlowTok{with} \BuiltInTok{open}\NormalTok{(pickle\_path, }\StringTok{\textquotesingle{}rb\textquotesingle{}}\NormalTok{) }\ImportTok{as}\NormalTok{ infile:}
\NormalTok{    purf }\OperatorTok{=}\NormalTok{ pickle.load(infile)}

\CommentTok{\# Convert float type}
\NormalTok{X[X.select\_dtypes(np.float64).columns] }\OperatorTok{=}\NormalTok{ X.select\_dtypes(np.float64).astype(np.float32)}
\CommentTok{\# Impute missing values}
\NormalTok{X }\OperatorTok{=}\NormalTok{ imputer.transform(X)}

\NormalTok{pred }\OperatorTok{=}\NormalTok{ purf[}\StringTok{\textquotesingle{}model\textquotesingle{}}\NormalTok{].predict\_proba(X)[:,}\DecValTok{1}\NormalTok{]}

\NormalTok{res }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{: data.index, }\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{: y\})}
\NormalTok{res[}\StringTok{\textquotesingle{}OOB score filtered\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ pred}
\NormalTok{res.to\_csv(}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pf\_single\_cross\_predictions.csv\textquotesingle{}}\NormalTok{, index}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(DT)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{single\_model\_res }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf\_single\_pv\_single\_scores.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{cross\_pred\_res }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf\_single\_pv\_single\_cross\_predictions.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{combined\_model\_res }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_5\_pfpv\_purf\_oob\_predictions.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \StringTok{"PURF model"} \OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"Pv single model"}\NormalTok{, }\StringTok{"Pf single model"}\NormalTok{, }\StringTok{"Pv + Pf combined model"}\NormalTok{),}
  \StringTok{"Accuracy for Pv known antigens"} \OtherTok{=} \FunctionTok{c}\NormalTok{(}
    \FunctionTok{paste0}\NormalTok{(}
      \FunctionTok{nrow}\NormalTok{(single\_model\_res[single\_model\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ single\_model\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pv"} \SpecialCharTok{\&}\NormalTok{ single\_model\_res}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{, ]),}
      \StringTok{" / "}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(single\_model\_res[single\_model\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ single\_model\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pv"}\NormalTok{, ]),}
      \StringTok{" = "}\NormalTok{, }\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(single\_model\_res[single\_model\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ single\_model\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pv"} \SpecialCharTok{\&}\NormalTok{ single\_model\_res}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{, ]) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(single\_model\_res[single\_model\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ single\_model\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pv"}\NormalTok{, ]))}
\NormalTok{    ),}
    \FunctionTok{paste0}\NormalTok{(}
      \FunctionTok{nrow}\NormalTok{(cross\_pred\_res[cross\_pred\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ cross\_pred\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pv"} \SpecialCharTok{\&}\NormalTok{ cross\_pred\_res}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{, ]),}
      \StringTok{" / "}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(cross\_pred\_res[cross\_pred\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ cross\_pred\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pv"}\NormalTok{, ]),}
      \StringTok{" = "}\NormalTok{, }\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(cross\_pred\_res[cross\_pred\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ cross\_pred\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pv"} \SpecialCharTok{\&}\NormalTok{ cross\_pred\_res}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{, ]) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(cross\_pred\_res[cross\_pred\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ cross\_pred\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pv"}\NormalTok{, ]))}
\NormalTok{    ),}
    \FunctionTok{paste0}\NormalTok{(}
      \FunctionTok{nrow}\NormalTok{(combined\_model\_res[combined\_model\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ combined\_model\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pv"} \SpecialCharTok{\&}\NormalTok{ combined\_model\_res}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{, ]),}
      \StringTok{" / "}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(combined\_model\_res[combined\_model\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ combined\_model\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pv"}\NormalTok{, ]),}
      \StringTok{" = "}\NormalTok{, }\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(combined\_model\_res[combined\_model\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ combined\_model\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pv"} \SpecialCharTok{\&}\NormalTok{ combined\_model\_res}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{, ]) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(combined\_model\_res[combined\_model\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ combined\_model\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pv"}\NormalTok{, ]))}
\NormalTok{    )}
\NormalTok{  ),}
  \StringTok{"Accuracy for Pf known antigens"} \OtherTok{=} \FunctionTok{c}\NormalTok{(}
    \FunctionTok{paste0}\NormalTok{(}
      \FunctionTok{nrow}\NormalTok{(cross\_pred\_res[cross\_pred\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ cross\_pred\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pf"} \SpecialCharTok{\&}\NormalTok{ cross\_pred\_res}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{, ]),}
      \StringTok{" / "}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(cross\_pred\_res[cross\_pred\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ cross\_pred\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pf"}\NormalTok{, ]),}
      \StringTok{" = "}\NormalTok{, }\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(cross\_pred\_res[cross\_pred\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ cross\_pred\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pf"} \SpecialCharTok{\&}\NormalTok{ cross\_pred\_res}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{, ]) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(cross\_pred\_res[cross\_pred\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ cross\_pred\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pf"}\NormalTok{, ]))}
\NormalTok{    ),}
    \FunctionTok{paste0}\NormalTok{(}
      \FunctionTok{nrow}\NormalTok{(single\_model\_res[single\_model\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ single\_model\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pf"} \SpecialCharTok{\&}\NormalTok{ single\_model\_res}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{, ]),}
      \StringTok{" / "}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(single\_model\_res[single\_model\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ single\_model\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pf"}\NormalTok{, ]),}
      \StringTok{" = "}\NormalTok{, }\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(single\_model\_res[single\_model\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ single\_model\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pf"} \SpecialCharTok{\&}\NormalTok{ single\_model\_res}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{, ]) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(single\_model\_res[single\_model\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ single\_model\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pf"}\NormalTok{, ]))}
\NormalTok{    ),}
    \FunctionTok{paste0}\NormalTok{(}
      \FunctionTok{nrow}\NormalTok{(combined\_model\_res[combined\_model\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ combined\_model\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pf"} \SpecialCharTok{\&}\NormalTok{ combined\_model\_res}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{, ]),}
      \StringTok{" / "}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(combined\_model\_res[combined\_model\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ combined\_model\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pf"}\NormalTok{, ]),}
      \StringTok{" = "}\NormalTok{, }\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(combined\_model\_res[combined\_model\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ combined\_model\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pf"} \SpecialCharTok{\&}\NormalTok{ combined\_model\_res}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{, ]) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(combined\_model\_res[combined\_model\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ combined\_model\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pf"}\NormalTok{, ]))}
\NormalTok{    )}
\NormalTok{  ),}
  \AttributeTok{check.names =} \ConstantTok{FALSE}
\NormalTok{)}

\FunctionTok{save}\NormalTok{(df, }\AttributeTok{file =} \StringTok{"./rdata/known\_antigen\_pred\_acc.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\StringTok{"./rdata/known\_antigen\_pred\_acc.RData"}\NormalTok{)}
\NormalTok{df }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{datatable}\NormalTok{(}\AttributeTok{rownames =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{03_model_evaluation_files/figure-latex/unnamed-chunk-9-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pv\_antigens }\OtherTok{\textless{}{-}}\NormalTok{ single\_model\_res[single\_model\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ single\_model\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pv"}\NormalTok{, ]}\SpecialCharTok{$}\NormalTok{protein\_id}
\NormalTok{pv\_model\_pf\_antigens }\OtherTok{\textless{}{-}}\NormalTok{ cross\_pred\_res[cross\_pred\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ cross\_pred\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pf"} \SpecialCharTok{\&}\NormalTok{ cross\_pred\_res}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{, ]}\SpecialCharTok{$}\NormalTok{protein\_id}
\NormalTok{pv\_model\_pv\_antigens }\OtherTok{\textless{}{-}}\NormalTok{ single\_model\_res[single\_model\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ single\_model\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pv"} \SpecialCharTok{\&}\NormalTok{ single\_model\_res}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{, ]}\SpecialCharTok{$}\NormalTok{protein\_id}

\NormalTok{pf\_antigens }\OtherTok{\textless{}{-}}\NormalTok{ single\_model\_res[single\_model\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ single\_model\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pf"}\NormalTok{, ]}\SpecialCharTok{$}\NormalTok{protein\_id}
\NormalTok{pf\_model\_pf\_antigens }\OtherTok{\textless{}{-}}\NormalTok{ single\_model\_res[single\_model\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ single\_model\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pf"} \SpecialCharTok{\&}\NormalTok{ single\_model\_res}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{, ]}\SpecialCharTok{$}\NormalTok{protein\_id}
\NormalTok{pf\_model\_pv\_antigens }\OtherTok{\textless{}{-}}\NormalTok{ cross\_pred\_res[cross\_pred\_res}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ cross\_pred\_res}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pv"} \SpecialCharTok{\&}\NormalTok{ cross\_pred\_res}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{, ]}\SpecialCharTok{$}\NormalTok{protein\_id}

\NormalTok{pv\_intersect }\OtherTok{\textless{}{-}} \FunctionTok{intersect}\NormalTok{(pf\_model\_pv\_antigens, pv\_model\_pv\_antigens)}
\NormalTok{pf\_intersect }\OtherTok{\textless{}{-}} \FunctionTok{intersect}\NormalTok{(pf\_model\_pf\_antigens, pv\_model\_pf\_antigens)}
\NormalTok{pv\_union }\OtherTok{\textless{}{-}} \FunctionTok{union}\NormalTok{(pf\_model\_pv\_antigens, pv\_model\_pv\_antigens)}
\NormalTok{pf\_union }\OtherTok{\textless{}{-}} \FunctionTok{union}\NormalTok{(pf\_model\_pf\_antigens, pv\_model\_pf\_antigens)}

\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \StringTok{"Set"} \OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"Pv model only"}\NormalTok{, }\StringTok{"Intersect"}\NormalTok{, }\StringTok{"Pf model only"}\NormalTok{, }\StringTok{"Complement"}\NormalTok{),}
  \StringTok{"Pv known antigens"} \OtherTok{=} \FunctionTok{c}\NormalTok{(}
    \FunctionTok{paste}\NormalTok{(pv\_model\_pv\_antigens[}\SpecialCharTok{!}\NormalTok{pv\_model\_pv\_antigens }\SpecialCharTok{\%in\%}\NormalTok{ pv\_intersect], }\AttributeTok{collapse =} \StringTok{", "}\NormalTok{),}
    \FunctionTok{length}\NormalTok{(pv\_intersect),}
    \FunctionTok{paste}\NormalTok{(pf\_model\_pv\_antigens[}\SpecialCharTok{!}\NormalTok{pf\_model\_pv\_antigens }\SpecialCharTok{\%in\%}\NormalTok{ pv\_intersect], }\AttributeTok{collapse =} \StringTok{", "}\NormalTok{),}
    \FunctionTok{paste}\NormalTok{(pv\_antigens[}\SpecialCharTok{!}\NormalTok{pv\_antigens }\SpecialCharTok{\%in\%}\NormalTok{ pv\_union], }\AttributeTok{collapse =} \StringTok{", "}\NormalTok{)}
\NormalTok{  ),}
  \StringTok{"Pf known antigens"} \OtherTok{=} \FunctionTok{c}\NormalTok{(}
    \FunctionTok{paste}\NormalTok{(pv\_model\_pf\_antigens[}\SpecialCharTok{!}\NormalTok{pv\_model\_pf\_antigens }\SpecialCharTok{\%in\%}\NormalTok{ pf\_intersect], }\AttributeTok{collapse =} \StringTok{", "}\NormalTok{),}
    \FunctionTok{length}\NormalTok{(pf\_intersect),}
    \FunctionTok{paste}\NormalTok{(pf\_model\_pf\_antigens[}\SpecialCharTok{!}\NormalTok{pf\_model\_pf\_antigens }\SpecialCharTok{\%in\%}\NormalTok{ pf\_intersect], }\AttributeTok{collapse =} \StringTok{", "}\NormalTok{),}
    \FunctionTok{paste}\NormalTok{(pf\_antigens[}\SpecialCharTok{!}\NormalTok{pf\_antigens }\SpecialCharTok{\%in\%}\NormalTok{ pf\_union], }\AttributeTok{collapse =} \StringTok{", "}\NormalTok{)}
\NormalTok{  ),}
  \AttributeTok{check.names =} \ConstantTok{FALSE}
\NormalTok{)}

\FunctionTok{save}\NormalTok{(df, }\AttributeTok{file =} \StringTok{"./rdata/known\_antigen\_pred\_set\_analysis.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\StringTok{"./rdata/known\_antigen\_pred\_set\_analysis.RData"}\NormalTok{)}
\NormalTok{df }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{datatable}\NormalTok{(}\AttributeTok{rownames =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{03_model_evaluation_files/figure-latex/unnamed-chunk-11-1.pdf}

\hypertarget{adversarial-controls}{%
\section{Adversarial controls}\label{adversarial-controls}}

\hypertarget{analysis-2}{%
\subsection{Analysis}\label{analysis-2}}

\textbf{In Python: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(reticulate)}
\FunctionTok{use\_condaenv}\NormalTok{(}\StringTok{"/Users/renee/Library/r{-}miniconda/envs/purf/bin/python"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}
\ImportTok{from}\NormalTok{ sklearn.utils }\ImportTok{import}\NormalTok{ shuffle}
\ImportTok{import}\NormalTok{ numpy }\ImportTok{as}\NormalTok{ np}
\ImportTok{import}\NormalTok{ pickle}
\ImportTok{from}\NormalTok{ sklearn.impute }\ImportTok{import}\NormalTok{ SimpleImputer}
\ImportTok{from}\NormalTok{ purf.pu\_ensemble }\ImportTok{import}\NormalTok{ PURandomForestClassifier}
\ImportTok{from}\NormalTok{ sklearn.preprocessing }\ImportTok{import}\NormalTok{ MinMaxScaler}
\ImportTok{from}\NormalTok{ scipy.spatial }\ImportTok{import}\NormalTok{ distance}
\ImportTok{from}\NormalTok{ joblib }\ImportTok{import}\NormalTok{ Parallel, delayed}
\ImportTok{from}\NormalTok{ sklearn.ensemble.\_forest }\ImportTok{import}\NormalTok{ \_generate\_unsampled\_indices}
\ImportTok{import}\NormalTok{ os}
\ImportTok{import}\NormalTok{ re}
\ImportTok{import}\NormalTok{ session\_info}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# private function for train\_purf()}
\KeywordTok{def}\NormalTok{ \_get\_ref\_antigen\_stats(idx, tree, X, y, ref\_indices, max\_samples}\OperatorTok{=}\VariableTok{None}\NormalTok{):}
    \ControlFlowTok{if}\NormalTok{ max\_samples }\KeywordTok{is} \VariableTok{None}\NormalTok{:}
\NormalTok{        max\_samples }\OperatorTok{=}\NormalTok{ y.shape[}\DecValTok{0}\NormalTok{]}
\NormalTok{    oob\_indices }\OperatorTok{=}\NormalTok{ \_generate\_unsampled\_indices(tree.random\_state, y.shape[}\DecValTok{0}\NormalTok{], max\_samples)}
\NormalTok{    ref\_oob }\OperatorTok{=}\NormalTok{ [i }\KeywordTok{in}\NormalTok{ oob\_indices }\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in}\NormalTok{ ref\_indices]}
\NormalTok{    ref\_pred }\OperatorTok{=} \BuiltInTok{list}\NormalTok{()}
\NormalTok{    pred }\OperatorTok{=}\NormalTok{ tree.predict\_proba(X[ref\_indices,:], check\_input}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\NormalTok{    ref\_pred }\OperatorTok{=}\NormalTok{ pred[:,}\DecValTok{1}\NormalTok{]}
    \ControlFlowTok{return}\NormalTok{ ref\_oob, ref\_pred}
  
\KeywordTok{def}\NormalTok{ train\_purf(features, outcome, pos\_level}\OperatorTok{=}\FloatTok{0.5}\NormalTok{, purf}\OperatorTok{=}\VariableTok{None}\NormalTok{, tree\_filtering}\OperatorTok{=}\VariableTok{False}\NormalTok{, ref\_antigens}\OperatorTok{=}\VariableTok{None}\NormalTok{, n\_jobs}\OperatorTok{=}\DecValTok{1}\NormalTok{):}
\NormalTok{    features, outcome }\OperatorTok{=}\NormalTok{ shuffle(features, outcome, random\_state}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
    \CommentTok{\# Imputation}
\NormalTok{    imputer }\OperatorTok{=}\NormalTok{ SimpleImputer(strategy}\OperatorTok{=}\StringTok{\textquotesingle{}median\textquotesingle{}}\NormalTok{)}
\NormalTok{    X }\OperatorTok{=}\NormalTok{ imputer.fit\_transform(features)}
\NormalTok{    X }\OperatorTok{=}\NormalTok{ pd.DataFrame(X, index}\OperatorTok{=}\NormalTok{features.index, columns}\OperatorTok{=}\NormalTok{features.columns)}
\NormalTok{    y }\OperatorTok{=}\NormalTok{ outcome}
\NormalTok{    features }\OperatorTok{=}\NormalTok{ X}
    \BuiltInTok{print}\NormalTok{(}\StringTok{\textquotesingle{}There are }\SpecialCharTok{\%d}\StringTok{ positives out of }\SpecialCharTok{\%d}\StringTok{ samples before feature space weighting.\textquotesingle{}} \OperatorTok{\%}\NormalTok{ (}\BuiltInTok{sum}\NormalTok{(y), }\BuiltInTok{len}\NormalTok{(y)))}
    \CommentTok{\# Feature space weighting}
\NormalTok{    lab\_pos }\OperatorTok{=}\NormalTok{ X.loc[y}\OperatorTok{==}\DecValTok{1}\NormalTok{,:]}
\NormalTok{    median }\OperatorTok{=}\NormalTok{ np.median(lab\_pos, axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
    \CommentTok{\# Feature space weighting}
\NormalTok{    lab\_pos }\OperatorTok{=}\NormalTok{ X.loc[y}\OperatorTok{==}\DecValTok{1}\NormalTok{,:]}
\NormalTok{    median }\OperatorTok{=}\NormalTok{ np.median(lab\_pos, axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{    scaler }\OperatorTok{=}\NormalTok{ MinMaxScaler(feature\_range}\OperatorTok{=}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{10}\NormalTok{))}
\NormalTok{    dist }\OperatorTok{=} \BuiltInTok{list}\NormalTok{()}
    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(lab\_pos.shape[}\DecValTok{0}\NormalTok{]):}
\NormalTok{        dist.append(distance.euclidean(lab\_pos.iloc[i, :], median))}
\NormalTok{    dist }\OperatorTok{=}\NormalTok{ np.asarray(dist).reshape(}\OperatorTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{    counts }\OperatorTok{=}\NormalTok{ np.}\BuiltInTok{round}\NormalTok{(scaler.fit\_transform(dist))}
\NormalTok{    counts }\OperatorTok{=}\NormalTok{ np.array(counts, dtype}\OperatorTok{=}\NormalTok{np.int64)[:, }\DecValTok{0}\NormalTok{]}
\NormalTok{    X\_temp }\OperatorTok{=}\NormalTok{ X.iloc[y}\OperatorTok{==}\DecValTok{1}\NormalTok{, :]}
\NormalTok{    X }\OperatorTok{=}\NormalTok{ X.iloc[y}\OperatorTok{==}\DecValTok{0}\NormalTok{, :]}
\NormalTok{    y }\OperatorTok{=}\NormalTok{ np.asarray([}\DecValTok{0}\NormalTok{] }\OperatorTok{*}\NormalTok{ X.shape[}\DecValTok{0}\NormalTok{] }\OperatorTok{+}\NormalTok{ [}\DecValTok{1}\NormalTok{] }\OperatorTok{*}\NormalTok{ (}\BuiltInTok{sum}\NormalTok{(counts)))}
\NormalTok{    appended\_data }\OperatorTok{=}\NormalTok{ [X]}
    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(counts)):}
\NormalTok{        appended\_data.append(pd.concat([X\_temp.iloc[[i]]] }\OperatorTok{*}\NormalTok{ counts[i]))}
\NormalTok{    X }\OperatorTok{=}\NormalTok{ pd.concat(appended\_data)}
        \BuiltInTok{print}\NormalTok{(}\StringTok{\textquotesingle{}There are }\SpecialCharTok{\%d}\StringTok{ positives out of }\SpecialCharTok{\%d}\StringTok{ samples after feature space weighting.\textquotesingle{}} \OperatorTok{\%}\NormalTok{ (}\BuiltInTok{sum}\NormalTok{(y), }\BuiltInTok{len}\NormalTok{(y)))}
\NormalTok{    res }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{: X.index, }\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{ : y\})}
    \ControlFlowTok{if}\NormalTok{ tree\_filtering }\KeywordTok{is} \VariableTok{True}\NormalTok{:}
        \CommentTok{\# get ref antigen indices}
\NormalTok{        ref\_index\_dict }\OperatorTok{=}\NormalTok{ \{ref:}\BuiltInTok{list}\NormalTok{() }\ControlFlowTok{for}\NormalTok{ ref }\KeywordTok{in} \BuiltInTok{list}\NormalTok{(ref\_antigens.values())\}}
        \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(res.shape[}\DecValTok{0}\NormalTok{]):}
            \ControlFlowTok{if}\NormalTok{ res[}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{][i] }\KeywordTok{in} \BuiltInTok{list}\NormalTok{(ref\_antigens.values()):}
\NormalTok{                ref\_index\_dict[res[}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{][i]].append(res.index[i])}
\NormalTok{        ref\_indices }\OperatorTok{=} \BuiltInTok{sum}\NormalTok{(ref\_index\_dict.values(), [])}
        \CommentTok{\# get OOB stats and predictions}
\NormalTok{        X }\OperatorTok{=}\NormalTok{ X.astype(}\StringTok{\textquotesingle{}float32\textquotesingle{}}\NormalTok{)}
\NormalTok{        trees }\OperatorTok{=}\NormalTok{ purf.estimators\_}
\NormalTok{        idx\_list }\OperatorTok{=}\NormalTok{ [i }\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(trees))]}
\NormalTok{        stats\_res }\OperatorTok{=}\NormalTok{ Parallel(n\_jobs}\OperatorTok{=}\NormalTok{n\_jobs)(}
\NormalTok{                    delayed(\_get\_ref\_antigen\_stats)(idx, trees[idx], np.array(X), y, ref\_indices) }\ControlFlowTok{for}\NormalTok{ idx }\KeywordTok{in}\NormalTok{ idx\_list)}
        \CommentTok{\# ref\_oob data structure:}
        \CommentTok{\# rows represent individual trees}
        \CommentTok{\# column represent reference antigens}
        \CommentTok{\# cells indicate whether the reference antigen is in the OOB samples of the tree}
\NormalTok{        ref\_oob }\OperatorTok{=}\NormalTok{ np.array([ref\_oob }\ControlFlowTok{for}\NormalTok{ ref\_oob, ref\_pred }\KeywordTok{in}\NormalTok{ stats\_res])}
        \CommentTok{\# ref\_pred data structure:}
        \CommentTok{\# rows represent individual trees}
        \CommentTok{\# column represent reference antigens}
        \CommentTok{\# cells indicate the prediction of the reference antigen by the tree}
\NormalTok{        ref\_pred }\OperatorTok{=}\NormalTok{ np.array([ref\_pred }\ControlFlowTok{for}\NormalTok{ ref\_oob, ref\_pred }\KeywordTok{in}\NormalTok{ stats\_res])}
        \CommentTok{\# analyze duplicated reference antigens as a group}
\NormalTok{        cumsum\_num\_ref }\OperatorTok{=}\NormalTok{ np.cumsum(np.array([}\BuiltInTok{len}\NormalTok{(v) }\ControlFlowTok{for}\NormalTok{ k,v }\KeywordTok{in}\NormalTok{ ref\_index\_dict.items()]))}
\NormalTok{        ref\_oob\_all }\OperatorTok{=}\NormalTok{ np.array([ref\_oob[:, }\DecValTok{0}\NormalTok{:cumsum\_num\_ref[i]].}\BuiltInTok{any}\NormalTok{(axis}\OperatorTok{=}\DecValTok{1}\NormalTok{) }\ControlFlowTok{if}\NormalTok{ i }\OperatorTok{==} \DecValTok{0} \ControlFlowTok{else} \OperatorTok{\textbackslash{}}
\NormalTok{                                ref\_oob[:, cumsum\_num\_ref[i }\OperatorTok{{-}} \DecValTok{1}\NormalTok{]:cumsum\_num\_ref[i]].}\BuiltInTok{any}\NormalTok{(axis}\OperatorTok{=}\DecValTok{1}\NormalTok{) }\OperatorTok{\textbackslash{}}
                                \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(ref\_antigens))]).T}
\NormalTok{        ref\_pred\_all }\OperatorTok{=}\NormalTok{ np.array([ref\_pred[:, }\DecValTok{0}\NormalTok{:cumsum\_num\_ref[i]].}\BuiltInTok{any}\NormalTok{(axis}\OperatorTok{=}\DecValTok{1}\NormalTok{) }\ControlFlowTok{if}\NormalTok{ i }\OperatorTok{==} \DecValTok{0} \ControlFlowTok{else} \OperatorTok{\textbackslash{}}
\NormalTok{                                 ref\_pred[:, cumsum\_num\_ref[i }\OperatorTok{{-}} \DecValTok{1}\NormalTok{]:cumsum\_num\_ref[i]].}\BuiltInTok{sum}\NormalTok{(axis}\OperatorTok{=}\DecValTok{1}\NormalTok{) }\OperatorTok{\textbackslash{}}
                                 \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(ref\_antigens))]).T}
        \CommentTok{\# calculate number of reference antigens as OOB samples for each tree}
\NormalTok{        oob\_total }\OperatorTok{=}\NormalTok{ ref\_oob\_all.}\BuiltInTok{sum}\NormalTok{(axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
        \CommentTok{\# assign score of 1 to trees that correctly predict all OOB reference antigens; otherwise, assign 0 score }
\NormalTok{        weights }\OperatorTok{=}\NormalTok{ np.zeros(}\BuiltInTok{len}\NormalTok{(trees))}
        \CommentTok{\# iterate through the trees and calculate the stats}
        \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(trees)):}
\NormalTok{            oob\_list }\OperatorTok{=} \BuiltInTok{list}\NormalTok{(ref\_oob\_all[i,:])}
\NormalTok{            pred\_list }\OperatorTok{=} \BuiltInTok{list}\NormalTok{(ref\_pred\_all[i,:])}
            \ControlFlowTok{if}\NormalTok{ oob\_total[i] }\OperatorTok{==} \DecValTok{0}\NormalTok{:}
\NormalTok{                weights[i] }\OperatorTok{=} \DecValTok{0}
            \ControlFlowTok{else}\NormalTok{:}
                \ControlFlowTok{if} \BuiltInTok{sum}\NormalTok{(np.array(pred\_list)[oob\_list] }\OperatorTok{!=} \DecValTok{0}\NormalTok{) }\OperatorTok{==}\NormalTok{ oob\_total[i]:}
\NormalTok{                    weights[i] }\OperatorTok{=} \DecValTok{1}
    \ControlFlowTok{if}\NormalTok{ tree\_filtering }\KeywordTok{is} \VariableTok{False}\NormalTok{:}
        \CommentTok{\# Training PURF}
\NormalTok{        purf }\OperatorTok{=}\NormalTok{ PURandomForestClassifier(}
\NormalTok{            n\_estimators }\OperatorTok{=} \DecValTok{100000}\NormalTok{,}
\NormalTok{            oob\_score }\OperatorTok{=} \VariableTok{True}\NormalTok{,}
\NormalTok{            n\_jobs }\OperatorTok{=} \DecValTok{64}\NormalTok{,}
\NormalTok{            random\_state }\OperatorTok{=} \DecValTok{42}\NormalTok{,}
\NormalTok{            pos\_level }\OperatorTok{=}\NormalTok{ pos\_level}
\NormalTok{        )}
\NormalTok{        purf.fit(X, y)}
    \ControlFlowTok{else}\NormalTok{:}
\NormalTok{        purf.\_set\_oob\_score\_with\_weights(np.array(X), y.reshape(}\OperatorTok{{-}}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{), weights}\OperatorTok{=}\NormalTok{weights)}
    \CommentTok{\# Storing results}
\NormalTok{    res[}\StringTok{\textquotesingle{}OOB score\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ purf.oob\_decision\_function\_[:,}\DecValTok{1}\NormalTok{]}
\NormalTok{    res }\OperatorTok{=}\NormalTok{ features.merge(res.groupby(}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{).mean(), left\_index}\OperatorTok{=}\VariableTok{True}\NormalTok{, right\_on}\OperatorTok{=}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{)}
\NormalTok{    res }\OperatorTok{=}\NormalTok{ res[[}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}OOB score\textquotesingle{}}\NormalTok{]]}
    \ControlFlowTok{if}\NormalTok{ tree\_filtering }\KeywordTok{is} \VariableTok{False}\NormalTok{:}
        \ControlFlowTok{return}\NormalTok{ (purf, res)}
    \ControlFlowTok{else}\NormalTok{:}
        \ControlFlowTok{return}\NormalTok{ (\{}\StringTok{\textquotesingle{}model\textquotesingle{}}\NormalTok{: purf, }\StringTok{\textquotesingle{}weights\textquotesingle{}}\NormalTok{: weights\}, res)}
\end{Highlighting}
\end{Shaded}

\hypertarget{pv-data-set-2}{%
\subsubsection{Pv data set}\label{pv-data-set-2}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ref\_antigens }\OperatorTok{=}\NormalTok{ \{}\StringTok{\textquotesingle{}CSP\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PVP01\_0835600.1{-}p1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}DBP\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PVP01\_0623800.1{-}p1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}MSP1\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PVP01\_0728900.1{-}p1\textquotesingle{}}\NormalTok{\}}
\NormalTok{data }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./other\_data/pv\_ml\_input.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{features }\OperatorTok{=}\NormalTok{ data.iloc[:, }\DecValTok{1}\NormalTok{:]}
\NormalTok{outcome }\OperatorTok{=}\NormalTok{ np.array(data.antigen\_label)}

\ControlFlowTok{for}\NormalTok{ (idx, (antigen, out)) }\KeywordTok{in} \BuiltInTok{enumerate}\NormalTok{(}\BuiltInTok{zip}\NormalTok{(features.index, outcome)):}
    \ControlFlowTok{if}\NormalTok{ out }\OperatorTok{==} \DecValTok{1}\NormalTok{:}
        \ControlFlowTok{if}\NormalTok{ antigen }\KeywordTok{in}\NormalTok{ ref\_antigens.values():}
            \ControlFlowTok{continue}
\NormalTok{        outcome\_ }\OperatorTok{=}\NormalTok{ outcome.copy()}
\NormalTok{        outcome\_[idx] }\OperatorTok{=} \DecValTok{0}
\NormalTok{        (purf, res) }\OperatorTok{=}\NormalTok{ train\_purf(features, outcome\_, pos\_level}\OperatorTok{=}\FloatTok{0.5}\NormalTok{, tree\_filtering}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\NormalTok{        (purf\_filtered, res\_filtered) }\OperatorTok{=}\NormalTok{ train\_purf(features, outcome\_, pos\_level}\OperatorTok{=}\FloatTok{0.5}\NormalTok{, purf}\OperatorTok{=}\NormalTok{purf, tree\_filtering}\OperatorTok{=}\VariableTok{True}\NormalTok{, ref\_antigens}\OperatorTok{=}\NormalTok{ref\_antigens)}
\NormalTok{        res\_filtered.to\_csv(}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pv\_jackknife/\textquotesingle{}} \OperatorTok{+}\NormalTok{ antigen }\OperatorTok{+} \StringTok{\textquotesingle{}\_res.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{dir} \OperatorTok{=} \StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pv\_jackknife/\textquotesingle{}}
\NormalTok{files }\OperatorTok{=}\NormalTok{ os.listdir(}\BuiltInTok{dir}\NormalTok{)}

\ControlFlowTok{for} \BuiltInTok{file} \KeywordTok{in}\NormalTok{ files:}
    \ControlFlowTok{if} \BuiltInTok{file}\NormalTok{.endswith(}\StringTok{\textquotesingle{}csv\textquotesingle{}}\NormalTok{):}
\NormalTok{        tmp }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\BuiltInTok{dir} \OperatorTok{+} \BuiltInTok{file}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)[}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{]}
        \ControlFlowTok{break}

\NormalTok{data\_frames }\OperatorTok{=}\NormalTok{ [pd.read\_csv(}\BuiltInTok{dir} \OperatorTok{+} \BuiltInTok{file}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)[}\StringTok{\textquotesingle{}OOB score\textquotesingle{}}\NormalTok{] }\ControlFlowTok{for} \BuiltInTok{file} \KeywordTok{in}\NormalTok{ files }\ControlFlowTok{if} \BuiltInTok{file}\NormalTok{.endswith(}\StringTok{\textquotesingle{}csv\textquotesingle{}}\NormalTok{)]}
\NormalTok{merged\_df }\OperatorTok{=}\NormalTok{ pd.concat([tmp] }\OperatorTok{+}\NormalTok{ data\_frames, join}\OperatorTok{=}\StringTok{\textquotesingle{}outer\textquotesingle{}}\NormalTok{, axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{colnames }\OperatorTok{=}\NormalTok{ [}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{] }\OperatorTok{+}\NormalTok{ [re.match(}\StringTok{\textquotesingle{}PVP01\_[0{-}9]+\textbackslash{}.[0{-}9]{-}p1\textquotesingle{}}\NormalTok{, }\BuiltInTok{file}\NormalTok{)[}\DecValTok{0}\NormalTok{] }\ControlFlowTok{for} \BuiltInTok{file} \KeywordTok{in}\NormalTok{ files }\ControlFlowTok{if} \BuiltInTok{file}\NormalTok{.endswith(}\StringTok{\textquotesingle{}csv\textquotesingle{}}\NormalTok{)]}
\NormalTok{merged\_df.columns }\OperatorTok{=}\NormalTok{ colnames}
\NormalTok{merged\_df.to\_csv(}\StringTok{\textquotesingle{}./other\_data/pv\_adversarial\_controls.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{pv-pf-combined-data-set-2}{%
\subsubsection{Pv + Pf combined data set}\label{pv-pf-combined-data-set-2}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ref\_antigens }\OperatorTok{=}\NormalTok{ \{}\StringTok{\textquotesingle{}CSP (Pf)\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PF3D7\_0304600.1{-}p1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}RH5 (Pf)\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PF3D7\_0424100.1{-}p1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}MSP5 (Pf)\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PF3D7\_0206900.1{-}p1\textquotesingle{}}\NormalTok{,}
                \StringTok{\textquotesingle{}P230 (Pf)\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PF3D7\_0209000.1{-}p1\textquotesingle{}}\NormalTok{,}
                \StringTok{\textquotesingle{}CSP (Pv)\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PVP01\_0835600.1{-}p1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}DBP (Pv)\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PVP01\_0623800.1{-}p1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}MSP1 (Pv)\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PVP01\_0728900.1{-}p1\textquotesingle{}}\NormalTok{\}}
\NormalTok{data }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./data/supplementary\_data\_4\_pfpv\_ml\_input.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{features }\OperatorTok{=}\NormalTok{ data.iloc[:, }\DecValTok{1}\NormalTok{:]}
\NormalTok{outcome }\OperatorTok{=}\NormalTok{ np.array(data.antigen\_label)}

\ControlFlowTok{for}\NormalTok{ (idx, (antigen, out)) }\KeywordTok{in} \BuiltInTok{enumerate}\NormalTok{(}\BuiltInTok{zip}\NormalTok{(features.index, outcome)):}
    \ControlFlowTok{if}\NormalTok{ out }\OperatorTok{==} \DecValTok{1}\NormalTok{:}
        \ControlFlowTok{if}\NormalTok{ antigen }\KeywordTok{in}\NormalTok{ ref\_antigens.values():}
            \ControlFlowTok{continue}
\NormalTok{        outcome\_ }\OperatorTok{=}\NormalTok{ outcome.copy()}
\NormalTok{        outcome\_[idx] }\OperatorTok{=} \DecValTok{0}
\NormalTok{        (purf, res) }\OperatorTok{=}\NormalTok{ train\_purf(features, outcome\_, pos\_level}\OperatorTok{=}\FloatTok{0.5}\NormalTok{, tree\_filtering}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\NormalTok{        (purf\_filtered, res\_filtered) }\OperatorTok{=}\NormalTok{ train\_purf(features, outcome\_, pos\_level}\OperatorTok{=}\FloatTok{0.5}\NormalTok{, purf}\OperatorTok{=}\NormalTok{purf, tree\_filtering}\OperatorTok{=}\VariableTok{True}\NormalTok{, ref\_antigens}\OperatorTok{=}\NormalTok{ref\_antigens)}
\NormalTok{        res\_filtered.to\_csv(}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pfpv\_jackknife/\textquotesingle{}} \OperatorTok{+}\NormalTok{ antigen }\OperatorTok{+} \StringTok{\textquotesingle{}\_res.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{dir} \OperatorTok{=} \StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pfpv\_jackknife/\textquotesingle{}}
\NormalTok{files }\OperatorTok{=}\NormalTok{ os.listdir(}\BuiltInTok{dir}\NormalTok{)}

\ControlFlowTok{for} \BuiltInTok{file} \KeywordTok{in}\NormalTok{ files:}
    \ControlFlowTok{if} \BuiltInTok{file}\NormalTok{.endswith(}\StringTok{\textquotesingle{}csv\textquotesingle{}}\NormalTok{):}
\NormalTok{        tmp }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\BuiltInTok{dir} \OperatorTok{+} \BuiltInTok{file}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)[}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{]}
        \ControlFlowTok{break}

\NormalTok{data\_frames }\OperatorTok{=}\NormalTok{ [pd.read\_csv(}\BuiltInTok{dir} \OperatorTok{+} \BuiltInTok{file}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)[}\StringTok{\textquotesingle{}OOB score\textquotesingle{}}\NormalTok{] }\ControlFlowTok{for} \BuiltInTok{file} \KeywordTok{in}\NormalTok{ files }\ControlFlowTok{if} \BuiltInTok{file}\NormalTok{.endswith(}\StringTok{\textquotesingle{}csv\textquotesingle{}}\NormalTok{)]}
\NormalTok{merged\_df }\OperatorTok{=}\NormalTok{ pd.concat([tmp] }\OperatorTok{+}\NormalTok{ data\_frames, join}\OperatorTok{=}\StringTok{\textquotesingle{}outer\textquotesingle{}}\NormalTok{, axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{colnames }\OperatorTok{=}\NormalTok{ [}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{] }\OperatorTok{+}\NormalTok{ [re.match(}\StringTok{\textquotesingle{}PF3D7\_[0{-}9]+\textbackslash{}.[0{-}9]{-}p1\textquotesingle{}}\NormalTok{, }\BuiltInTok{file}\NormalTok{)[}\DecValTok{0}\NormalTok{] }\ControlFlowTok{if} \BuiltInTok{file}\NormalTok{.startswith(}\StringTok{\textquotesingle{}PF3D7\textquotesingle{}}\NormalTok{) }\ControlFlowTok{else}\NormalTok{ re.match(}\StringTok{\textquotesingle{}PVP01\_[0{-}9]+\textbackslash{}.[0{-}9]{-}p1\textquotesingle{}}\NormalTok{, }\BuiltInTok{file}\NormalTok{)[}\DecValTok{0}\NormalTok{] }\ControlFlowTok{for} \BuiltInTok{file} \KeywordTok{in}\NormalTok{ files }\ControlFlowTok{if} \BuiltInTok{file}\NormalTok{.endswith(}\StringTok{\textquotesingle{}csv\textquotesingle{}}\NormalTok{)]}
\NormalTok{merged\_df.columns }\OperatorTok{=}\NormalTok{ colnames}
\NormalTok{merged\_df.to\_csv(}\StringTok{\textquotesingle{}./other\_data/pfpv\_adversarial\_controls.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{plotting-1}{%
\subsection{Plotting}\label{plotting-1}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(ggdist)}
\FunctionTok{library}\NormalTok{(gghalves)}
\FunctionTok{library}\NormalTok{(cowplot)}
\FunctionTok{library}\NormalTok{(grid)}
\FunctionTok{library}\NormalTok{(ggbeeswarm)}
\FunctionTok{library}\NormalTok{(ggpubr)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pv\_data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_3\_pv\_purf\_oob\_predictions.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{pf\_data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf\_single\_pv\_single\_scores.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{pfpv\_data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_5\_pfpv\_purf\_oob\_predictions.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}

\NormalTok{pv\_ad\_ctrl }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pv\_adversarial\_controls.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{pf\_ad\_ctrl }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf\_adversarial\_controls.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{pfpv\_ad\_ctrl }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pfpv\_adversarial\_controls.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{mean-differences-in-scores}{%
\subsubsection{Mean differences in scores}\label{mean-differences-in-scores}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pv\_products }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pvp01\_gene\_products\_v62.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{pf\_products }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf3d7\_gene\_products\_v62.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{gene\_products }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(pf\_products, pv\_products)}

\NormalTok{calculate\_known\_antigen\_scores }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(validation\_data, baseline\_scores) \{}
\NormalTok{  scores }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{2}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(validation\_data)) \{}
\NormalTok{    known\_antigen }\OtherTok{\textless{}{-}} \FunctionTok{sort}\NormalTok{(}\FunctionTok{colnames}\NormalTok{(validation\_data))[i]}
\NormalTok{    other\_antigens }\OtherTok{\textless{}{-}} \FunctionTok{sort}\NormalTok{(}\FunctionTok{colnames}\NormalTok{(validation\_data))[}\SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, i)]}
\NormalTok{    scores }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(scores, }\FunctionTok{mean}\NormalTok{(validation\_data[other\_antigens, known\_antigen] }\SpecialCharTok{{-}}\NormalTok{ baseline\_scores[other\_antigens, ]))}
\NormalTok{  \}}
  \FunctionTok{names}\NormalTok{(scores) }\OtherTok{\textless{}{-}} \FunctionTok{sort}\NormalTok{(}\FunctionTok{colnames}\NormalTok{(validation\_data))[}\DecValTok{2}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(validation\_data)]}
  \FunctionTok{return}\NormalTok{(scores)}
\NormalTok{\}}

\NormalTok{pv\_ad\_ctrl\_scores }\OtherTok{\textless{}{-}} \FunctionTok{calculate\_known\_antigen\_scores}\NormalTok{(pv\_ad\_ctrl, pv\_data[}\StringTok{"OOB score filtered"}\NormalTok{])}
\NormalTok{pf\_ad\_ctrl\_scores }\OtherTok{\textless{}{-}} \FunctionTok{calculate\_known\_antigen\_scores}\NormalTok{(pf\_ad\_ctrl, pf\_data[}\FunctionTok{rownames}\NormalTok{(pf\_ad\_ctrl), }\StringTok{"OOB score filtered"}\NormalTok{, }\AttributeTok{drop =} \ConstantTok{FALSE}\NormalTok{])}
\NormalTok{pfpv\_ad\_ctrl\_scores }\OtherTok{\textless{}{-}} \FunctionTok{calculate\_known\_antigen\_scores}\NormalTok{(pfpv\_ad\_ctrl, pfpv\_data[}\StringTok{"OOB score filtered"}\NormalTok{])}

\NormalTok{pv\_ad\_ctrl\_res }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \StringTok{"score"} \OtherTok{=}\NormalTok{ pv\_ad\_ctrl\_scores,}
  \StringTok{"gene\_product"} \OtherTok{=}\NormalTok{ gene\_products[}\FunctionTok{names}\NormalTok{(pv\_ad\_ctrl\_scores), }\StringTok{"gene\_product"}\NormalTok{],}
  \AttributeTok{row.names =} \FunctionTok{names}\NormalTok{(pv\_ad\_ctrl\_scores)}
\NormalTok{)}
\NormalTok{pv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{source }\OtherTok{\textless{}{-}} \StringTok{"Intersect"}
\NormalTok{literature }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"PVP01\_0102300.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0118900.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0202200.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0205500.1{-}p1"}\NormalTok{,}
  \StringTok{"PVP01\_0210500.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0304300.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0317900.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0418300.1{-}p1"}\NormalTok{,}
  \StringTok{"PVP01\_0418400.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0529100.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0532400.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0616000.1{-}p1"}\NormalTok{,}
  \StringTok{"PVP01\_0616100.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0701200.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0707700.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_1026000.1{-}p1"}\NormalTok{,}
  \StringTok{"PVP01\_1030900.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_1129100.1{-}p1"}
\NormalTok{)}
\NormalTok{IEDB }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"PVP01\_0106200.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0106300.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0215600.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0307400.1{-}p1"}\NormalTok{,}
  \StringTok{"PVP01\_0522300.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0813700.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0829000.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0835600.1{-}p1"}\NormalTok{,}
  \StringTok{"PVP01\_0923000.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0932400.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_1240600.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_1306000.1{-}p1"}\NormalTok{,}
  \StringTok{"PVP01\_1412900.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_1453900.1{-}p1"}
\NormalTok{)}
\NormalTok{pv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{source[}\FunctionTok{rownames}\NormalTok{(pv\_ad\_ctrl\_res) }\SpecialCharTok{\%in\%}\NormalTok{ literature] }\OtherTok{\textless{}{-}} \StringTok{"Literature"}
\NormalTok{pv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{source[}\FunctionTok{rownames}\NormalTok{(pv\_ad\_ctrl\_res) }\SpecialCharTok{\%in\%}\NormalTok{ IEDB] }\OtherTok{\textless{}{-}} \StringTok{"IEDB"}

\NormalTok{pfpv\_ad\_ctrl\_res }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \StringTok{"score"} \OtherTok{=}\NormalTok{ pfpv\_ad\_ctrl\_scores,}
  \StringTok{"gene\_product"} \OtherTok{=}\NormalTok{ gene\_products[}\FunctionTok{names}\NormalTok{(pfpv\_ad\_ctrl\_scores), }\StringTok{"gene\_product"}\NormalTok{],}
  \AttributeTok{row.names =} \FunctionTok{names}\NormalTok{(pfpv\_ad\_ctrl\_scores)}
\NormalTok{)}
\NormalTok{pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{source }\OtherTok{\textless{}{-}} \StringTok{"Intersect"}
\NormalTok{pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{source[}\FunctionTok{rownames}\NormalTok{(pfpv\_ad\_ctrl\_res) }\SpecialCharTok{\%in\%}\NormalTok{ literature] }\OtherTok{\textless{}{-}} \StringTok{"Literature"}
\NormalTok{pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{source[}\FunctionTok{rownames}\NormalTok{(pfpv\_ad\_ctrl\_res) }\SpecialCharTok{\%in\%}\NormalTok{ IEDB] }\OtherTok{\textless{}{-}} \StringTok{"IEDB"}

\FunctionTok{write.csv}\NormalTok{(pv\_ad\_ctrl\_res, }\AttributeTok{file =} \StringTok{"./other\_data/pv\_ad\_ctrl\_res.csv"}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{write.csv}\NormalTok{(pfpv\_ad\_ctrl\_res, }\AttributeTok{file =} \StringTok{"./other\_data/pfpv\_ad\_ctrl\_res.csv"}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pv\_ad\_ctrl\_res }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pv\_ad\_ctrl\_res.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{pfpv\_ad\_ctrl\_res }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pfpv\_ad\_ctrl\_res.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{data\_ }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{group =} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}
    \FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FunctionTok{length}\NormalTok{(pv\_ad\_ctrl\_scores)), }\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{length}\NormalTok{(pf\_ad\_ctrl\_scores)),}
    \FunctionTok{rep}\NormalTok{(}\DecValTok{2}\NormalTok{, }\FunctionTok{length}\NormalTok{(pfpv\_ad\_ctrl\_scores))}
\NormalTok{  )),}
  \AttributeTok{score =} \FunctionTok{c}\NormalTok{(pv\_ad\_ctrl\_scores, pf\_ad\_ctrl\_scores, pfpv\_ad\_ctrl\_scores)}
\NormalTok{)}

\NormalTok{p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ group, }\AttributeTok{y =}\NormalTok{ score)) }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey80"}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{) }\SpecialCharTok{+}
\NormalTok{  ggdist}\SpecialCharTok{::}\FunctionTok{stat\_halfeye}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ group, }\AttributeTok{fill =}\NormalTok{ group), }\AttributeTok{adjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{width =} \FloatTok{0.7}\NormalTok{, }\AttributeTok{.width =} \DecValTok{0}\NormalTok{, }\AttributeTok{justification =} \SpecialCharTok{{-}}\FloatTok{0.1}\NormalTok{, }\AttributeTok{point\_colour =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.9}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ group), }\AttributeTok{width =} \FloatTok{0.1}\NormalTok{, }\AttributeTok{outlier.color =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{lwd =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
\NormalTok{  gghalves}\SpecialCharTok{::}\FunctionTok{geom\_half\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ group), }\AttributeTok{side =} \StringTok{"l"}\NormalTok{, }\AttributeTok{range\_scale =} \FloatTok{0.4}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.6}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.1}\NormalTok{, }\AttributeTok{size =} \DecValTok{2}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#03a1fc"}\NormalTok{, }\StringTok{"\#984EA3"}\NormalTok{, }\StringTok{"\#FF7F00"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#03a1fc"}\NormalTok{, }\StringTok{"\#984EA3"}\NormalTok{, }\StringTok{"\#FF7F00"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_discrete}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}
      \FunctionTok{expression}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\FunctionTok{italic}\NormalTok{(}\StringTok{"P. vivax"}\NormalTok{), }\StringTok{" model"}\NormalTok{)),}
      \FunctionTok{expression}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\FunctionTok{italic}\NormalTok{(}\StringTok{"P. falciparum"}\NormalTok{), }\StringTok{" model"}\NormalTok{)),}
      \StringTok{"Combined model"}
\NormalTok{    ),}
    \AttributeTok{limits =}\NormalTok{ rev}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Mean difference in scores (proportion of votes)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{png}\NormalTok{(}
  \AttributeTok{file =} \StringTok{"./figures/Supplementary Fig 5.png"}\NormalTok{,}
  \AttributeTok{width =} \DecValTok{5000}\NormalTok{, }\AttributeTok{height =} \DecValTok{2000}\NormalTok{, }\AttributeTok{res =} \DecValTok{600}
\NormalTok{)}
\FunctionTok{print}\NormalTok{(p)}
\FunctionTok{dev.off}\NormalTok{()}

\FunctionTok{pdf}\NormalTok{(}\AttributeTok{file =} \StringTok{"../supplementary\_figures/Supplementary Fig 5.pdf"}\NormalTok{, }\AttributeTok{width =} \DecValTok{10}\NormalTok{, }\AttributeTok{height =} \DecValTok{4}\NormalTok{)}
\FunctionTok{print}\NormalTok{(p)}
\FunctionTok{dev.off}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 5} \end{center}

\hypertarget{investigation-of-known-antigen-groups}{%
\subsubsection{Investigation of known antigen groups}\label{investigation-of-known-antigen-groups}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(umap)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(ggrepel)}
\FunctionTok{library}\NormalTok{(cowplot)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pv\_ad\_ctrl\_res }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pv\_ad\_ctrl\_res.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\CommentTok{\# pv\_ad\_ctrl\_res = pv\_ad\_ctrl\_res[pv\_ad\_ctrl\_res$source != \textquotesingle{}Intersect\textquotesingle{}, ]}
\NormalTok{pv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{score\_group }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{pv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{score\_group[pv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{score }\SpecialCharTok{\textless{}} \FloatTok{0.01}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Group 1"}
\NormalTok{pv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{score\_group[pv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{score }\SpecialCharTok{\textgreater{}=} \FloatTok{0.01}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Group 2"}
\FunctionTok{table}\NormalTok{(pv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{score\_group, pv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{source)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##          
##           IEDB Intersect Literature
##   Group 1   11         2          3
##   Group 2    2         2         15
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{fisher.test}\NormalTok{(pv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{score\_group, pv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{source)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Fisher's Exact Test for Count Data
## 
## data:  pv_ad_ctrl_res$score_group and pv_ad_ctrl_res$source
## p-value = 0.0002597
## alternative hypothesis: two.sided
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pfpv\_ad\_ctrl\_res }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pfpv\_ad\_ctrl\_res.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\CommentTok{\# pfpv\_ad\_ctrl\_res = pfpv\_ad\_ctrl\_res[pfpv\_ad\_ctrl\_res$source != \textquotesingle{}Intersect\textquotesingle{}, ]}
\NormalTok{pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{score\_group }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{score\_group[pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{score }\SpecialCharTok{\textless{}} \SpecialCharTok{{-}}\FloatTok{0.09}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Group 1"}
\NormalTok{pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{score\_group[pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{score }\SpecialCharTok{\textgreater{}=} \SpecialCharTok{{-}}\FloatTok{0.09}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Group 2"}
\FunctionTok{table}\NormalTok{(pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{score\_group, pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{source)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##          
##           IEDB Intersect Literature
##   Group 1   12        27          2
##   Group 2    1        25         16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{fisher.test}\NormalTok{(pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{score\_group, pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{source)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Fisher's Exact Test for Count Data
## 
## data:  pfpv_ad_ctrl_res$score_group and pfpv_ad_ctrl_res$source
## p-value = 1.176e-05
## alternative hypothesis: two.sided
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pfpv\_ad\_ctrl\_res }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pfpv\_ad\_ctrl\_res.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{score\_group }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{score\_group[pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{score }\SpecialCharTok{\textless{}} \SpecialCharTok{{-}}\FloatTok{0.09}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Group 1"}
\NormalTok{pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{score\_group[pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{score }\SpecialCharTok{\textgreater{}=} \SpecialCharTok{{-}}\FloatTok{0.09}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Group 2"}
\NormalTok{pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{species }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{species[}\FunctionTok{startsWith}\NormalTok{(}\FunctionTok{rownames}\NormalTok{(pfpv\_ad\_ctrl\_res), }\StringTok{"PF3D7"}\NormalTok{)] }\OtherTok{\textless{}{-}} \StringTok{"Pf"}
\NormalTok{pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{species[}\FunctionTok{startsWith}\NormalTok{(}\FunctionTok{rownames}\NormalTok{(pfpv\_ad\_ctrl\_res), }\StringTok{"PVP01"}\NormalTok{)] }\OtherTok{\textless{}{-}} \StringTok{"Pv"}
\FunctionTok{table}\NormalTok{(pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{score\_group, pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{species)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##          
##           Pf Pv
##   Group 1 25 16
##   Group 2 23 19
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{fisher.test}\NormalTok{(pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{score\_group, pfpv\_ad\_ctrl\_res}\SpecialCharTok{$}\NormalTok{species)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Fisher's Exact Test for Count Data
## 
## data:  pfpv_ad_ctrl_res$score_group and pfpv_ad_ctrl_res$species
## p-value = 0.6584
## alternative hypothesis: true odds ratio is not equal to 1
## 95 percent confidence interval:
##  0.4934941 3.3881568
## sample estimates:
## odds ratio 
##   1.286776
\end{verbatim}

\hypertarget{labeled-known-antigen-accuracies}{%
\subsubsection{Labeled known antigen accuracies}\label{labeled-known-antigen-accuracies}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{calculate\_known\_antigen\_accuracies }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(validation\_data, baseline\_scores) \{}
\NormalTok{  accuracies }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{2}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(validation\_data)) \{}
\NormalTok{    known\_antigen }\OtherTok{\textless{}{-}} \FunctionTok{sort}\NormalTok{(}\FunctionTok{colnames}\NormalTok{(validation\_data))[i]}
\NormalTok{    other\_antigens }\OtherTok{\textless{}{-}} \FunctionTok{sort}\NormalTok{(}\FunctionTok{colnames}\NormalTok{(validation\_data))[}\SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, i)]}
\NormalTok{    accuracies }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(accuracies, }\FunctionTok{sum}\NormalTok{(validation\_data[other\_antigens, known\_antigen] }\SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{/} \FunctionTok{length}\NormalTok{(validation\_data[other\_antigens, known\_antigen]))}
\NormalTok{  \}}
  \FunctionTok{return}\NormalTok{(accuracies)}
\NormalTok{\}}

\NormalTok{pv\_ad\_ctrl\_accuracies }\OtherTok{\textless{}{-}} \FunctionTok{calculate\_known\_antigen\_accuracies}\NormalTok{(pv\_ad\_ctrl, pv\_data[}\StringTok{"OOB score filtered"}\NormalTok{])}
\NormalTok{pf\_ad\_ctrl\_accuracies }\OtherTok{\textless{}{-}} \FunctionTok{calculate\_known\_antigen\_accuracies}\NormalTok{(pf\_ad\_ctrl, pf\_data[}\FunctionTok{rownames}\NormalTok{(pf\_ad\_ctrl), }\StringTok{"OOB score filtered"}\NormalTok{, }\AttributeTok{drop =} \ConstantTok{FALSE}\NormalTok{])}
\NormalTok{pfpv\_ad\_ctrl\_accuracies }\OtherTok{\textless{}{-}} \FunctionTok{calculate\_known\_antigen\_accuracies}\NormalTok{(pfpv\_ad\_ctrl, pfpv\_data[}\StringTok{"OOB score filtered"}\NormalTok{])}

\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \StringTok{"PURF model"} \OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"Pv single model"}\NormalTok{, }\StringTok{"Pf single model"}\NormalTok{, }\StringTok{"Pv + Pf combined model"}\NormalTok{),}
  \StringTok{"Accuracy (mean  SD)"} \OtherTok{=} \FunctionTok{c}\NormalTok{(}
    \FunctionTok{paste0}\NormalTok{(}
      \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, }\FunctionTok{mean}\NormalTok{(pv\_ad\_ctrl\_accuracies)), }\StringTok{"  "}\NormalTok{,}
      \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, }\FunctionTok{sd}\NormalTok{(pv\_ad\_ctrl\_accuracies))}
\NormalTok{    ),}
    \FunctionTok{paste0}\NormalTok{(}
      \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, }\FunctionTok{mean}\NormalTok{(pf\_ad\_ctrl\_accuracies)), }\StringTok{"  "}\NormalTok{,}
      \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, }\FunctionTok{sd}\NormalTok{(pf\_ad\_ctrl\_accuracies))}
\NormalTok{    ),}
    \FunctionTok{paste0}\NormalTok{(}
      \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, }\FunctionTok{mean}\NormalTok{(pfpv\_ad\_ctrl\_accuracies)), }\StringTok{"  "}\NormalTok{,}
      \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, }\FunctionTok{sd}\NormalTok{(pfpv\_ad\_ctrl\_accuracies))}
\NormalTok{    )}
\NormalTok{  ),}
  \AttributeTok{check.names =} \ConstantTok{FALSE}
\NormalTok{)}

\FunctionTok{save}\NormalTok{(df, }\AttributeTok{file =} \StringTok{"./rdata/ad\_ctrl\_pred\_accuracy.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\StringTok{"./rdata/ad\_ctrl\_pred\_accuracy.RData"}\NormalTok{)}
\NormalTok{df }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{datatable}\NormalTok{(}\AttributeTok{rownames =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{03_model_evaluation_files/figure-latex/unnamed-chunk-30-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sessionInfo}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## R version 4.2.3 (2023-03-15)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur ... 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
##  [1] ggrepel_0.9.3    umap_0.2.10.0    ggpubr_0.6.0     ggbeeswarm_0.7.2
##  [5] cowplot_1.1.1    gghalves_0.1.4   ggdist_3.2.1     ggplot2_3.4.2   
##  [9] DT_0.27          reticulate_1.28 
## 
## loaded via a namespace (and not attached):
##  [1] sass_0.4.6           tidyr_1.3.0          jsonlite_1.8.4      
##  [4] carData_3.0-5        R.utils_2.12.2       here_1.0.1          
##  [7] bslib_0.4.2          distributional_0.3.2 askpass_1.1         
## [10] highr_0.10           vipor_0.4.5          yaml_2.3.7          
## [13] pillar_1.9.0         backports_1.4.1      lattice_0.21-8      
## [16] glue_1.6.2           digest_0.6.31        ggsignif_0.6.4      
## [19] colorspace_2.1-0     htmltools_0.5.5      Matrix_1.5-4        
## [22] R.oo_1.25.0          pkgconfig_2.0.3      broom_1.0.4         
## [25] bookdown_0.34        purrr_1.0.1          scales_1.2.1        
## [28] webshot_0.5.4        processx_3.8.1       RSpectra_0.16-1     
## [31] tibble_3.2.1         openssl_2.0.6        styler_1.9.1        
## [34] generics_0.1.3       farver_2.1.1         car_3.1-2           
## [37] ellipsis_0.3.2       cachem_1.0.8         withr_2.5.0         
## [40] cli_3.6.1            magrittr_2.0.3       evaluate_0.21       
## [43] ps_1.7.5             R.methodsS3_1.8.2    fansi_1.0.4         
## [46] R.cache_0.16.0       rstatix_0.7.2        beeswarm_0.4.0      
## [49] tools_4.2.3          lifecycle_1.0.3      munsell_0.5.0       
## [52] callr_3.7.3          compiler_4.2.3       jquerylib_0.1.4     
## [55] rlang_1.1.1          rstudioapi_0.14      htmlwidgets_1.6.2   
## [58] crosstalk_1.2.0      rmarkdown_2.21       gtable_0.3.3        
## [61] codetools_0.2-19     abind_1.4-5          R6_2.5.1            
## [64] knitr_1.42           dplyr_1.1.2          fastmap_1.1.1       
## [67] utf8_1.2.3           rprojroot_2.0.3      Rcpp_1.0.10         
## [70] vctrs_0.6.2          png_0.1-8            tidyselect_1.2.0    
## [73] xfun_0.39
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{session\_info.show()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -----
## joblib              1.1.1
## numpy               1.19.0
## pandas              1.3.2
## purf                NA
## scipy               1.8.0
## session_info        1.0.0
## sklearn             0.24.2
## -----
## Python 3.8.2 (default, Mar 26 2020, 10:45:18) [Clang 4.0.1 (tags/RELEASE_401/final)]
## macOS-10.16-x86_64-i386-64bit
## -----
## Session information updated at 2023-05-18 12:30
\end{verbatim}

\hypertarget{04_model_comparisons}{%
\chapter{Model comparisons}\label{04_model_comparisons}}

\hypertarget{known-antigen-score-comparisons}{%
\section{Known antigen score comparisons}\label{known-antigen-score-comparisons}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(reshape2)}
\FunctionTok{library}\NormalTok{(ggdist)}
\FunctionTok{library}\NormalTok{(gghalves)}
\FunctionTok{library}\NormalTok{(cowplot)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pv\_scores }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pv\_known\_antigen\_scores.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{pv\_unl\_scores }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pv\_unlabeled\_protein\_scores.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{pv\_scores}\SpecialCharTok{$}\NormalTok{label }\OtherTok{\textless{}{-}} \DecValTok{2}
\NormalTok{pv\_unl\_scores}\SpecialCharTok{$}\NormalTok{label }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{data\_ }\OtherTok{\textless{}{-}} \FunctionTok{melt}\NormalTok{(}\FunctionTok{rbind}\NormalTok{(pv\_scores, pv\_unl\_scores), }\AttributeTok{id.vars =} \StringTok{"label"}\NormalTok{)}
\NormalTok{data\_}\SpecialCharTok{$}\NormalTok{variable }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(data\_}\SpecialCharTok{$}\NormalTok{variable, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}
  \StringTok{"pf\_single\_model"}\NormalTok{,}
  \StringTok{"pv\_single\_model"}\NormalTok{, }\StringTok{"pv\_pf\_pos"}\NormalTok{,}
  \StringTok{"pfpv\_combined\_model"}\NormalTok{,}
  \StringTok{"pv\_pf\_unl"}
\NormalTok{))}
\NormalTok{data\_}\SpecialCharTok{$}\NormalTok{label[data\_}\SpecialCharTok{$}\NormalTok{value }\SpecialCharTok{\textless{}} \FloatTok{0.5} \SpecialCharTok{\&}\NormalTok{ data\_}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{0}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{12}\NormalTok{)}
\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ variable, }\AttributeTok{y =}\NormalTok{ value)) }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey70"}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{stat\_halfeye}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =} \FunctionTok{factor}\NormalTok{(label, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{))),}
    \AttributeTok{slab\_color =} \StringTok{"black"}\NormalTok{,}
    \AttributeTok{slab\_linewidth =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{adjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{width =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{.width =} \DecValTok{0}\NormalTok{,}
    \AttributeTok{justification =} \SpecialCharTok{{-}}\FloatTok{0.2}\NormalTok{, }\AttributeTok{point\_colour =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.6}\NormalTok{, }\AttributeTok{normalize =} \StringTok{"all"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =} \FunctionTok{factor}\NormalTok{(label, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{))),}
    \AttributeTok{width =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{outlier.color =} \ConstantTok{NA}\NormalTok{,}
    \AttributeTok{lwd =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.6}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_half\_point}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ data\_[data\_}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{2}\NormalTok{, ], }\AttributeTok{fill =} \StringTok{"\#FCB40A"}\NormalTok{, }\AttributeTok{side =} \StringTok{"l"}\NormalTok{,}
    \AttributeTok{range\_scale =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.8}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.1}\NormalTok{, }\AttributeTok{size =} \DecValTok{2}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}
    \AttributeTok{name =} \StringTok{""}\NormalTok{, }\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#FCB40A"}\NormalTok{, }\StringTok{"\#FF007F"}\NormalTok{, }\StringTok{"\#0080FF"}\NormalTok{), }\AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Known antigen"}\NormalTok{, }\StringTok{"Predicted antigen"}\NormalTok{, }\StringTok{"Predicted non{-}antigen"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_manual}\NormalTok{(}
    \AttributeTok{name =} \StringTok{""}\NormalTok{, }\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#FCB40A"}\NormalTok{, }\StringTok{"\#FF007F"}\NormalTok{, }\StringTok{"\#0080FF"}\NormalTok{), }\AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Known antigen"}\NormalTok{, }\StringTok{"Predicted antigen"}\NormalTok{, }\StringTok{"Predicted non{-}antigen"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_discrete}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}
      \StringTok{"pf\_single\_model"}\NormalTok{, }\StringTok{"pv\_single\_model"}\NormalTok{, }\StringTok{"pv\_pf\_pos"}\NormalTok{,}
      \StringTok{"pfpv\_combined\_model"}\NormalTok{, }\StringTok{"pv\_pf\_unl"}
\NormalTok{    ),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}
      \StringTok{"Heterologous model"}\NormalTok{, }\StringTok{"Autologous model"}\NormalTok{,}
      \StringTok{"Autologous with}\SpecialCharTok{\textbackslash{}n}\StringTok{ heterologous positives model"}\NormalTok{,}
      \StringTok{"Combined model"}\NormalTok{,}
      \StringTok{"Autologous with}\SpecialCharTok{\textbackslash{}n}\StringTok{ heterologous unlabeled model"}
\NormalTok{    ),}
    \AttributeTok{limits =}\NormalTok{ rev}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Score (proportion of votes)"}\NormalTok{)}

\NormalTok{legend }\OtherTok{\textless{}{-}} \FunctionTok{get\_legend}\NormalTok{(p2 }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{legend.direction =} \StringTok{"horizontal"}\NormalTok{,}
    \AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{,}
    \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{()}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{guides}\NormalTok{(}\AttributeTok{fill =} \FunctionTok{guide\_legend}\NormalTok{(}\AttributeTok{title =} \StringTok{""}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pf\_scores }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf\_known\_antigen\_scores.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{pf\_unl\_scores }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf\_unlabeled\_protein\_scores.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{pf\_scores}\SpecialCharTok{$}\NormalTok{label }\OtherTok{\textless{}{-}} \DecValTok{2}
\NormalTok{pf\_unl\_scores}\SpecialCharTok{$}\NormalTok{label }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{data\_ }\OtherTok{\textless{}{-}} \FunctionTok{melt}\NormalTok{(}\FunctionTok{rbind}\NormalTok{(pf\_scores, pf\_unl\_scores), }\AttributeTok{id.vars =} \StringTok{"label"}\NormalTok{)}
\NormalTok{data\_}\SpecialCharTok{$}\NormalTok{variable }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(data\_}\SpecialCharTok{$}\NormalTok{variable, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}
  \StringTok{"pv\_single\_model"}\NormalTok{,}
  \StringTok{"pf\_single\_model"}\NormalTok{, }\StringTok{"pf\_pv\_pos"}\NormalTok{,}
  \StringTok{"pfpv\_combined\_model"}\NormalTok{,}
  \StringTok{"pf\_pv\_unl"}
\NormalTok{))}
\NormalTok{data\_}\SpecialCharTok{$}\NormalTok{label[data\_}\SpecialCharTok{$}\NormalTok{value }\SpecialCharTok{\textless{}} \FloatTok{0.5} \SpecialCharTok{\&}\NormalTok{ data\_}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{0}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{12}\NormalTok{)}
\NormalTok{p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ variable, }\AttributeTok{y =}\NormalTok{ value)) }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey70"}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{stat\_halfeye}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =} \FunctionTok{factor}\NormalTok{(label, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{))),}
    \AttributeTok{slab\_color =} \StringTok{"black"}\NormalTok{,}
    \AttributeTok{slab\_linewidth =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{adjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{width =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{.width =} \DecValTok{0}\NormalTok{,}
    \AttributeTok{justification =} \SpecialCharTok{{-}}\FloatTok{0.2}\NormalTok{, }\AttributeTok{point\_colour =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.6}\NormalTok{, }\AttributeTok{normalize =} \StringTok{"all"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =} \FunctionTok{factor}\NormalTok{(label, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{))),}
    \AttributeTok{width =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{outlier.color =} \ConstantTok{NA}\NormalTok{,}
    \AttributeTok{lwd =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.6}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_half\_point}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ data\_[data\_}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{2}\NormalTok{, ], }\AttributeTok{fill =} \StringTok{"\#FCB40A"}\NormalTok{, }\AttributeTok{side =} \StringTok{"l"}\NormalTok{,}
    \AttributeTok{range\_scale =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.8}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.1}\NormalTok{, }\AttributeTok{size =} \DecValTok{2}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}
    \AttributeTok{name =} \StringTok{""}\NormalTok{, }\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#FCB40A"}\NormalTok{, }\StringTok{"\#FF007F"}\NormalTok{, }\StringTok{"\#0080FF"}\NormalTok{), }\AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Known antigen"}\NormalTok{, }\StringTok{"Predicted antigen"}\NormalTok{, }\StringTok{"Predicted non{-}antigen"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_manual}\NormalTok{(}
    \AttributeTok{name =} \StringTok{""}\NormalTok{, }\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#FCB40A"}\NormalTok{, }\StringTok{"\#FF007F"}\NormalTok{, }\StringTok{"\#0080FF"}\NormalTok{), }\AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Known antigen"}\NormalTok{, }\StringTok{"Predicted antigen"}\NormalTok{, }\StringTok{"Predicted non{-}antigen"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_discrete}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}
      \StringTok{"pv\_single\_model"}\NormalTok{, }\StringTok{"pf\_single\_model"}\NormalTok{, }\StringTok{"pf\_pv\_pos"}\NormalTok{,}
      \StringTok{"pfpv\_combined\_model"}\NormalTok{, }\StringTok{"pf\_pv\_unl"}
\NormalTok{    ),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}
      \StringTok{"Heterologous model"}\NormalTok{, }\StringTok{"Autologous model"}\NormalTok{,}
      \StringTok{"Autologous with}\SpecialCharTok{\textbackslash{}n}\StringTok{ heterologous positives model"}\NormalTok{,}
      \StringTok{"Combined model"}\NormalTok{,}
      \StringTok{"Autologous with}\SpecialCharTok{\textbackslash{}n}\StringTok{ heterologous unlabeled model"}
\NormalTok{    ),}
    \AttributeTok{limits =}\NormalTok{ rev}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Score (proportion of votes)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p\_combined }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(p1, p2, }\FunctionTok{plot\_grid}\NormalTok{(}\ConstantTok{NULL}\NormalTok{, legend, }\AttributeTok{rel\_widths =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.2}\NormalTok{, }\FloatTok{0.8}\NormalTok{)),}
  \AttributeTok{ncol =} \DecValTok{2}\NormalTok{,}
  \AttributeTok{rel\_heights =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FloatTok{0.1}\NormalTok{), }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{""}\NormalTok{, }\StringTok{""}\NormalTok{)}
\NormalTok{)}
\NormalTok{p\_combined}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{png}\NormalTok{(}\AttributeTok{file =} \StringTok{"./figures/Fig 2.png"}\NormalTok{, }\AttributeTok{width =} \DecValTok{7500}\NormalTok{, }\AttributeTok{height =} \DecValTok{4000}\NormalTok{, }\AttributeTok{res =} \DecValTok{600}\NormalTok{)}
\FunctionTok{print}\NormalTok{(p\_combined)}
\FunctionTok{dev.off}\NormalTok{()}

\FunctionTok{pdf}\NormalTok{(}\AttributeTok{file =} \StringTok{"../figures/Fig 2.pdf"}\NormalTok{, }\AttributeTok{width =} \DecValTok{13}\NormalTok{, }\AttributeTok{height =} \DecValTok{7}\NormalTok{)}
\FunctionTok{print}\NormalTok{(p\_combined)}
\FunctionTok{dev.off}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Fig 2} \end{center}

\hypertarget{known-antigen-prediction-summary}{%
\section{Known antigen prediction summary}\label{known-antigen-prediction-summary}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(pracma)}
\FunctionTok{library}\NormalTok{(ggsci)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pv\_scores }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pv\_known\_antigen\_scores.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{pv\_unl\_scores }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pv\_unlabeled\_protein\_scores.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{pv\_scores}\SpecialCharTok{$}\NormalTok{label }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{pv\_unl\_scores}\SpecialCharTok{$}\NormalTok{label }\OtherTok{\textless{}{-}} \DecValTok{0}
\NormalTok{pv\_all }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(pv\_scores, pv\_unl\_scores)}

\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \StringTok{"antigen\_label"} \OtherTok{=}\NormalTok{ pv\_all}\SpecialCharTok{$}\NormalTok{label,}
  \StringTok{"Heterologous model"} \OtherTok{=}\NormalTok{ pv\_all}\SpecialCharTok{$}\NormalTok{pf\_single\_model,}
  \StringTok{"Autologous model"} \OtherTok{=}\NormalTok{ pv\_all}\SpecialCharTok{$}\NormalTok{pv\_single\_model,}
  \StringTok{"Autologous with heterologous positives model"} \OtherTok{=}\NormalTok{ pv\_all}\SpecialCharTok{$}\NormalTok{pv\_pf\_pos,}
  \StringTok{"Combined model"} \OtherTok{=}\NormalTok{ pv\_all}\SpecialCharTok{$}\NormalTok{pfpv\_combined\_model,}
  \StringTok{"Autologous with heterologous unlabeled model"} \OtherTok{=}\NormalTok{ pv\_all}\SpecialCharTok{$}\NormalTok{pv\_pf\_unl,}
  \AttributeTok{check.names =} \ConstantTok{FALSE}
\NormalTok{)}

\CommentTok{\# Calculate percent rank for labeled positives}
\NormalTok{model\_names }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\NormalTok{percent\_rank }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\NormalTok{auc }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (model }\ControlFlowTok{in} \FunctionTok{colnames}\NormalTok{(data)[}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]) \{}
\NormalTok{  data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data[}\FunctionTok{c}\NormalTok{(}\StringTok{"antigen\_label"}\NormalTok{, model)]}
\NormalTok{  percent\_rank\_ }\OtherTok{\textless{}{-}}\NormalTok{ (}\FunctionTok{rank}\NormalTok{(data\_[[model]]) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data))[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{]}
\NormalTok{  percent\_rank }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(percent\_rank, percent\_rank\_[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{percent\_rank\_)])}
\NormalTok{  data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data\_[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ]}
\NormalTok{  data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data\_[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{percent\_rank\_), ]}
\NormalTok{  x\_ }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(data\_) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data\_)}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(x, x\_)}
\NormalTok{  model\_names }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(model\_names, }\FunctionTok{rep}\NormalTok{(model, }\FunctionTok{nrow}\NormalTok{(data\_)))}
\NormalTok{  auc }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(auc, }\FunctionTok{round}\NormalTok{(}\FunctionTok{trapz}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, x\_, }\DecValTok{1}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, percent\_rank\_, }\DecValTok{0}\NormalTok{)), }\DecValTok{2}\NormalTok{))}
  \FunctionTok{cat}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"EPR: "}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_[[model]] }\SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data\_), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{))}
\NormalTok{\}}
\FunctionTok{names}\NormalTok{(auc) }\OtherTok{\textless{}{-}} \FunctionTok{colnames}\NormalTok{(data)[}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]}

\NormalTok{res }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{model =}\NormalTok{ model\_names, }\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{percent\_rank =}\NormalTok{ percent\_rank)}

\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(res, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =} \StringTok{\textasciigrave{}}\AttributeTok{percent\_rank}\StringTok{\textasciigrave{}}\NormalTok{, }\AttributeTok{group =}\NormalTok{ model)) }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey50"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{linewidth =} \FloatTok{0.1}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey30"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ model),}
    \AttributeTok{size =} \FloatTok{2.2}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey30"}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.1}\NormalTok{,}
    \AttributeTok{alpha =} \FloatTok{0.8}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_jco}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{colnames}\NormalTok{(data)[}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{][}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{auc)],}
    \AttributeTok{labels =} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{colnames}\NormalTok{(data)[}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{][}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{auc)], }\ControlFlowTok{function}\NormalTok{(x) \{}
      \FunctionTok{paste0}\NormalTok{(}
\NormalTok{        x, }\StringTok{" (AUC = "}\NormalTok{,}
\NormalTok{        auc[x], }\StringTok{")"}
\NormalTok{      )}
\NormalTok{    \})}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{angle =} \DecValTok{0}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.34}\NormalTok{, }\FloatTok{0.16}\NormalTok{),}
    \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.key =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{colour =} \StringTok{"transparent"}\NormalTok{, }\AttributeTok{fill =} \StringTok{"transparent"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{fill =} \StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Ranked known antigens (scaled)"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Percent rank"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pf\_scores }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf\_known\_antigen\_scores.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{pf\_unl\_scores }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf\_unlabeled\_protein\_scores.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{pf\_scores}\SpecialCharTok{$}\NormalTok{label }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{pf\_unl\_scores}\SpecialCharTok{$}\NormalTok{label }\OtherTok{\textless{}{-}} \DecValTok{0}
\NormalTok{pf\_all }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(pf\_scores, pf\_unl\_scores)}

\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \StringTok{"antigen\_label"} \OtherTok{=}\NormalTok{ pf\_all}\SpecialCharTok{$}\NormalTok{label,}
  \StringTok{"Heterologous model"} \OtherTok{=}\NormalTok{ pf\_all}\SpecialCharTok{$}\NormalTok{pv\_single\_model,}
  \StringTok{"Autologous model"} \OtherTok{=}\NormalTok{ pf\_all}\SpecialCharTok{$}\NormalTok{pf\_single\_model,}
  \StringTok{"Autologous with heterologous positives model"} \OtherTok{=}\NormalTok{ pf\_all}\SpecialCharTok{$}\NormalTok{pf\_pv\_pos,}
  \StringTok{"Combined model"} \OtherTok{=}\NormalTok{ pf\_all}\SpecialCharTok{$}\NormalTok{pfpv\_combined\_model,}
  \StringTok{"Autologous with heterologous unlabeled model"} \OtherTok{=}\NormalTok{ pf\_all}\SpecialCharTok{$}\NormalTok{pf\_pv\_unl,}
  \AttributeTok{check.names =} \ConstantTok{FALSE}
\NormalTok{)}

\CommentTok{\# Calculate percent rank for labeled positives}
\NormalTok{model\_names }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\NormalTok{percent\_rank }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\NormalTok{auc }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (model }\ControlFlowTok{in} \FunctionTok{colnames}\NormalTok{(data)[}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]) \{}
\NormalTok{  data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data[}\FunctionTok{c}\NormalTok{(}\StringTok{"antigen\_label"}\NormalTok{, model)]}
\NormalTok{  percent\_rank\_ }\OtherTok{\textless{}{-}}\NormalTok{ (}\FunctionTok{rank}\NormalTok{(data\_[[model]]) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data))[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{]}
\NormalTok{  percent\_rank }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(percent\_rank, percent\_rank\_[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{percent\_rank\_)])}
\NormalTok{  data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data\_[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ]}
\NormalTok{  data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data\_[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{percent\_rank\_), ]}
\NormalTok{  x\_ }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(data\_) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data\_)}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(x, x\_)}
\NormalTok{  model\_names }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(model\_names, }\FunctionTok{rep}\NormalTok{(model, }\FunctionTok{nrow}\NormalTok{(data\_)))}
\NormalTok{  auc }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(auc, }\FunctionTok{round}\NormalTok{(}\FunctionTok{trapz}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, x\_, }\DecValTok{1}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, percent\_rank\_, }\DecValTok{0}\NormalTok{)), }\DecValTok{2}\NormalTok{))}
  \FunctionTok{cat}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"EPR: "}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_[[model]] }\SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data\_), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{))}
\NormalTok{\}}
\FunctionTok{names}\NormalTok{(auc) }\OtherTok{\textless{}{-}} \FunctionTok{colnames}\NormalTok{(data)[}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]}

\NormalTok{res }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{model =}\NormalTok{ model\_names, }\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{percent\_rank =}\NormalTok{ percent\_rank)}

\NormalTok{p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(res, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =} \StringTok{\textasciigrave{}}\AttributeTok{percent\_rank}\StringTok{\textasciigrave{}}\NormalTok{, }\AttributeTok{group =}\NormalTok{ model)) }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey50"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{linewidth =} \FloatTok{0.1}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey30"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ model),}
    \AttributeTok{size =} \FloatTok{2.2}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey30"}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.1}\NormalTok{,}
    \AttributeTok{alpha =} \FloatTok{0.8}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_jco}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{colnames}\NormalTok{(data)[}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{][}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{auc)],}
    \AttributeTok{labels =} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{colnames}\NormalTok{(data)[}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{][}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{auc)], }\ControlFlowTok{function}\NormalTok{(x) \{}
      \FunctionTok{paste0}\NormalTok{(}
\NormalTok{        x, }\StringTok{" (AUC = "}\NormalTok{,}
\NormalTok{        auc[x], }\StringTok{")"}
\NormalTok{      )}
\NormalTok{    \})}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{angle =} \DecValTok{0}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.34}\NormalTok{, }\FloatTok{0.16}\NormalTok{),}
    \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.key =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{colour =} \StringTok{"transparent"}\NormalTok{, }\AttributeTok{fill =} \StringTok{"transparent"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{fill =} \StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Ranked known antigens (scaled)"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Percent rank"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p\_combined }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(p1, p2, }\AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{))}
\NormalTok{p\_combined}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{png}\NormalTok{(}\AttributeTok{file =} \StringTok{"./figures/Supplementary Fig 6.png"}\NormalTok{, }\AttributeTok{width =} \DecValTok{7600}\NormalTok{, }\AttributeTok{height =} \DecValTok{3500}\NormalTok{, }\AttributeTok{res =} \DecValTok{600}\NormalTok{)}
\FunctionTok{print}\NormalTok{(p\_combined)}
\FunctionTok{dev.off}\NormalTok{()}

\FunctionTok{pdf}\NormalTok{(}\AttributeTok{file =} \StringTok{"../supplementary\_figures/Supplementary Fig 6.pdf"}\NormalTok{, }\AttributeTok{width =} \FloatTok{15.2}\NormalTok{, }\AttributeTok{height =} \DecValTok{7}\NormalTok{)}
\FunctionTok{print}\NormalTok{(p\_combined)}
\FunctionTok{dev.off}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 6} \end{center}

\hypertarget{score-and-species-association}{%
\section{Score and species association}\label{score-and-species-association}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(scales)}
\FunctionTok{library}\NormalTok{(rlist)}
\FunctionTok{library}\NormalTok{(rcompanion)}
\FunctionTok{library}\NormalTok{(DT)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{scientific }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \FunctionTok{ifelse}\NormalTok{(x }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, }\StringTok{"0"}\NormalTok{, }\FunctionTok{gsub}\NormalTok{(}\StringTok{"e"}\NormalTok{, }\StringTok{" * 10\^{}"}\NormalTok{, }\FunctionTok{scientific\_format}\NormalTok{(}\AttributeTok{digits =} \DecValTok{3}\NormalTok{)(x)))}
\NormalTok{\}}
\NormalTok{contingency\_table }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
\NormalTok{chisq\_pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\NormalTok{cramer\_res }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
\CommentTok{\# Combined}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_5\_pfpv\_purf\_oob\_predictions.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{pred }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(data}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}}\NormalTok{[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{], }\ControlFlowTok{function}\NormalTok{(x) }\ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{) }\StringTok{"pos"} \ControlFlowTok{else} \StringTok{"neg"}\NormalTok{)}
\NormalTok{species }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{species[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{]}
\NormalTok{M }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(pred, species)}
\NormalTok{Xsq }\OtherTok{\textless{}{-}} \FunctionTok{chisq.test}\NormalTok{(M, }\AttributeTok{correct =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{cramerV }\OtherTok{\textless{}{-}} \FunctionTok{cramerV}\NormalTok{(M, }\AttributeTok{ci =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{contingency\_table }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(contingency\_table, M)}
\NormalTok{chisq\_pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(chisq\_pval, Xsq}\SpecialCharTok{$}\NormalTok{p.value)}
\NormalTok{cramer\_res }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(cramer\_res, }\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, cramerV))}
\CommentTok{\# P. vivax \& P. falciparum single models}
\NormalTok{data\_1 }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf\_single\_pv\_single\_scores.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{data\_2 }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf\_single\_pv\_single\_cross\_predictions.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{pred\_1 }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(data\_1}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}}\NormalTok{[data\_1}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{], }\ControlFlowTok{function}\NormalTok{(x) }\ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{) }\StringTok{"pos"} \ControlFlowTok{else} \StringTok{"neg"}\NormalTok{)}
\NormalTok{species\_1 }\OtherTok{\textless{}{-}}\NormalTok{ data\_1}\SpecialCharTok{$}\NormalTok{species[data\_1}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{]}
\NormalTok{pred\_2 }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(data\_2}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}}\NormalTok{[data\_2}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{], }\ControlFlowTok{function}\NormalTok{(x) }\ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{) }\StringTok{"pos"} \ControlFlowTok{else} \StringTok{"neg"}\NormalTok{)}
\NormalTok{species\_2 }\OtherTok{\textless{}{-}}\NormalTok{ data\_2}\SpecialCharTok{$}\NormalTok{species[data\_2}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{]}
\DocumentationTok{\#\# P. vivax}
\NormalTok{M }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(pred\_1[species\_1 }\SpecialCharTok{==} \StringTok{"pv"}\NormalTok{], pred\_2[species\_2 }\SpecialCharTok{==} \StringTok{"pf"}\NormalTok{]),}
  \FunctionTok{c}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\StringTok{"pv"}\NormalTok{, }\FunctionTok{length}\NormalTok{(pred\_1[species\_1 }\SpecialCharTok{==} \StringTok{"pv"}\NormalTok{])), }\FunctionTok{rep}\NormalTok{(}\StringTok{"pf"}\NormalTok{, }\FunctionTok{length}\NormalTok{(pred\_2[species\_2 }\SpecialCharTok{==} \StringTok{"pf"}\NormalTok{])))}
\NormalTok{)}
\NormalTok{Xsq }\OtherTok{\textless{}{-}} \FunctionTok{chisq.test}\NormalTok{(M, }\AttributeTok{correct =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{cramerV }\OtherTok{\textless{}{-}} \FunctionTok{cramerV}\NormalTok{(M, }\AttributeTok{ci =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{contingency\_table }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(contingency\_table, M)}
\NormalTok{chisq\_pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(chisq\_pval, Xsq}\SpecialCharTok{$}\NormalTok{p.value)}
\NormalTok{cramer\_res }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(cramer\_res, }\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, cramerV))}
\DocumentationTok{\#\# P. falciparum}
\NormalTok{M }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(pred\_1[species\_1 }\SpecialCharTok{==} \StringTok{"pf"}\NormalTok{], pred\_2[species\_2 }\SpecialCharTok{==} \StringTok{"pv"}\NormalTok{]),}
  \FunctionTok{c}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\StringTok{"pf"}\NormalTok{, }\FunctionTok{length}\NormalTok{(pred\_1[species\_1 }\SpecialCharTok{==} \StringTok{"pf"}\NormalTok{])), }\FunctionTok{rep}\NormalTok{(}\StringTok{"pv"}\NormalTok{, }\FunctionTok{length}\NormalTok{(pred\_2[species\_2 }\SpecialCharTok{==} \StringTok{"pv"}\NormalTok{])))}
\NormalTok{)}
\NormalTok{Xsq }\OtherTok{\textless{}{-}} \FunctionTok{chisq.test}\NormalTok{(M, }\AttributeTok{correct =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{cramerV }\OtherTok{\textless{}{-}} \FunctionTok{cramerV}\NormalTok{(M, }\AttributeTok{ci =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{contingency\_table }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(contingency\_table, M)}
\NormalTok{chisq\_pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(chisq\_pval, Xsq}\SpecialCharTok{$}\NormalTok{p.value)}
\NormalTok{cramer\_res }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(cramer\_res, }\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, cramerV))}
\CommentTok{\# P. vivax with heterologous positives}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pv\_pf\_pos\_scores.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{pred }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(data}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB scores}\StringTok{\textasciigrave{}}\NormalTok{[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{], }\ControlFlowTok{function}\NormalTok{(x) }\ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{) }\StringTok{"pos"} \ControlFlowTok{else} \StringTok{"neg"}\NormalTok{)}
\NormalTok{species }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{species[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{]}
\NormalTok{M }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(pred, species)}
\NormalTok{Xsq }\OtherTok{\textless{}{-}} \FunctionTok{chisq.test}\NormalTok{(M, }\AttributeTok{correct =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{cramerV }\OtherTok{\textless{}{-}} \FunctionTok{cramerV}\NormalTok{(M, }\AttributeTok{ci =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{contingency\_table }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(contingency\_table, M)}
\NormalTok{chisq\_pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(chisq\_pval, Xsq}\SpecialCharTok{$}\NormalTok{p.value)}
\NormalTok{cramer\_res }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(cramer\_res, }\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, cramerV))}
\CommentTok{\# P. falciparum with heterologous positives}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf\_pv\_pos\_scores.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{pred }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(data}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB scores}\StringTok{\textasciigrave{}}\NormalTok{[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{], }\ControlFlowTok{function}\NormalTok{(x) }\ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{) }\StringTok{"pos"} \ControlFlowTok{else} \StringTok{"neg"}\NormalTok{)}
\NormalTok{species }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{species[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{]}
\NormalTok{M }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(pred, species)}
\NormalTok{Xsq }\OtherTok{\textless{}{-}} \FunctionTok{chisq.test}\NormalTok{(M, }\AttributeTok{correct =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{cramerV }\OtherTok{\textless{}{-}} \FunctionTok{cramerV}\NormalTok{(M, }\AttributeTok{ci =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{contingency\_table }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(contingency\_table, M)}
\NormalTok{chisq\_pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(chisq\_pval, Xsq}\SpecialCharTok{$}\NormalTok{p.value)}
\NormalTok{cramer\_res }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(cramer\_res, }\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, cramerV))}
\CommentTok{\# P. vivax with heterologous unlabeled}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pv\_pf\_unl\_scores.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{pred }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(data}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB scores}\StringTok{\textasciigrave{}}\NormalTok{[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{], }\ControlFlowTok{function}\NormalTok{(x) }\ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{) }\StringTok{"pos"} \ControlFlowTok{else} \StringTok{"neg"}\NormalTok{)}
\NormalTok{species }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{species[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{]}
\NormalTok{M }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(pred, species)}
\NormalTok{Xsq }\OtherTok{\textless{}{-}} \FunctionTok{chisq.test}\NormalTok{(M, }\AttributeTok{correct =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{cramerV }\OtherTok{\textless{}{-}} \FunctionTok{cramerV}\NormalTok{(M, }\AttributeTok{ci =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{contingency\_table }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(contingency\_table, M)}
\NormalTok{chisq\_pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(chisq\_pval, Xsq}\SpecialCharTok{$}\NormalTok{p.value)}
\NormalTok{cramer\_res }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(cramer\_res, }\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, cramerV))}
\CommentTok{\# P. falciparum with heterologous unlabeled}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf\_pv\_unl\_scores.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{pred }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(data}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB scores}\StringTok{\textasciigrave{}}\NormalTok{[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{], }\ControlFlowTok{function}\NormalTok{(x) }\ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{) }\StringTok{"pos"} \ControlFlowTok{else} \StringTok{"neg"}\NormalTok{)}
\NormalTok{species }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{species[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{]}
\NormalTok{M }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(pred, species)}
\NormalTok{Xsq }\OtherTok{\textless{}{-}} \FunctionTok{chisq.test}\NormalTok{(M, }\AttributeTok{correct =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{cramerV }\OtherTok{\textless{}{-}} \FunctionTok{cramerV}\NormalTok{(M, }\AttributeTok{ci =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{contingency\_table }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(contingency\_table, M)}
\NormalTok{chisq\_pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(chisq\_pval, Xsq}\SpecialCharTok{$}\NormalTok{p.value)}
\NormalTok{cramer\_res }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(cramer\_res, }\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, cramerV))}
\CommentTok{\# Save results}
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(}\FunctionTok{cbind}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}
    \StringTok{"Combined"}\NormalTok{, }\StringTok{"P. vivax"}\NormalTok{, }\StringTok{"P. falciparum"}\NormalTok{,}
    \StringTok{"P. vivax with heterologous positives"}\NormalTok{,}
    \StringTok{"P. falciparum with heterologous positives"}\NormalTok{,}
    \StringTok{"P. vivax with heterologous unlabeled"}\NormalTok{,}
    \StringTok{"P. falciparum with heterologous unlabeled"}
\NormalTok{  ),}
\NormalTok{  chisq\_pval, }\FunctionTok{do.call}\NormalTok{(rbind, cramer\_res)}
\NormalTok{))}
\FunctionTok{colnames}\NormalTok{(df) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"PURF model"}\NormalTok{, }\StringTok{"Chi{-}squared test p{-}value"}\NormalTok{, }\StringTok{"Cramer\textquotesingle{}s V"}\NormalTok{, }\StringTok{"Lower CI"}\NormalTok{, }\StringTok{"Upper CI"}\NormalTok{)}
\NormalTok{df}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Chi{-}squared test p{-}value}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{as.numeric}\NormalTok{(df}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Chi{-}squared test p{-}value}\StringTok{\textasciigrave{}}\NormalTok{), scientific)}
\FunctionTok{names}\NormalTok{(contingency\_table) }\OtherTok{\textless{}{-}}\NormalTok{ df}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{PURF model}\StringTok{\textasciigrave{}}
\FunctionTok{save}\NormalTok{(contingency\_table, df, }\AttributeTok{file =} \StringTok{"./rdata/score\_species\_association.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\StringTok{"./rdata/score\_species\_association.RData"}\NormalTok{)}
\NormalTok{contingency\_table}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $Combined
##      species
## pred    pf   pv
##   neg 2719 3814
##   pos 2622 2639
## 
## $`P. falciparum`
##      
##         pf   pv
##   neg 2897 3091
##   pos 2444 3362
## 
## $`P. vivax`
##      
##         pf   pv
##   neg 2451 3618
##   pos 2890 2835
## 
## $`P. falciparum with heterologous positives`
##      species
## pred    pf   pv
##   neg 2932   63
##   pos 2409 6390
## 
## $`P. vivax with heterologous positives`
##      species
## pred    pf   pv
##   neg    0 3695
##   pos 5341 2758
## 
## $`P. falciparum with heterologous unlabeled`
##      species
## pred    pf   pv
##   neg  108 6314
##   pos 5233  139
## 
## $`P. vivax with heterologous unlabeled`
##      species
## pred    pf   pv
##   neg 5133 1055
##   pos  208 5398
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{datatable}\NormalTok{(}\AttributeTok{rownames =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{04_model_comparisons_files/figure-latex/unnamed-chunk-16-1.pdf}

\hypertarget{tree-depth-analysis}{%
\section{Tree depth analysis}\label{tree-depth-analysis}}

\hypertarget{analysis-3}{%
\subsection{Analysis}\label{analysis-3}}

\textbf{In Python: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(reticulate)}
\FunctionTok{use\_condaenv}\NormalTok{(}\StringTok{"/Users/renee/Library/r{-}miniconda/envs/purf/bin/python"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}
\ImportTok{import}\NormalTok{ numpy }\ImportTok{as}\NormalTok{ np}
\ImportTok{import}\NormalTok{ pickle}
\ImportTok{from}\NormalTok{ purf.pu\_ensemble }\ImportTok{import}\NormalTok{ PURandomForestClassifier}
\ImportTok{import}\NormalTok{ session\_info}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{with} \BuiltInTok{open}\NormalTok{(}\StringTok{\textquotesingle{}./pickle\_data/pf\_0.5\_purf\_tree\_filtering.pkl\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}rb\textquotesingle{}}\NormalTok{) }\ImportTok{as}\NormalTok{ infile:}
\NormalTok{    pf\_single\_model }\OperatorTok{=}\NormalTok{ pickle.load(infile)}

\ControlFlowTok{with} \BuiltInTok{open}\NormalTok{(}\StringTok{\textquotesingle{}./pickle\_data/pv\_0.5\_purf\_tree\_filtering.pkl\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}rb\textquotesingle{}}\NormalTok{) }\ImportTok{as}\NormalTok{ infile:}
\NormalTok{    pv\_single\_model }\OperatorTok{=}\NormalTok{ pickle.load(infile)}

\ControlFlowTok{with} \BuiltInTok{open}\NormalTok{(}\StringTok{\textquotesingle{}./pickle\_data/pfpv\_0.5\_purf\_tree\_filtering.pkl\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}rb\textquotesingle{}}\NormalTok{) }\ImportTok{as}\NormalTok{ infile:}
\NormalTok{    pfpv\_combined\_model }\OperatorTok{=}\NormalTok{ pickle.load(infile)}
    
\ControlFlowTok{with} \BuiltInTok{open}\NormalTok{(}\StringTok{\textquotesingle{}./pickle\_data/pf\_pv\_pos\_purf.pkl\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}rb\textquotesingle{}}\NormalTok{) }\ImportTok{as}\NormalTok{ infile:}
\NormalTok{    pf\_pv\_pos\_model }\OperatorTok{=}\NormalTok{ pickle.load(infile)}
    
\ControlFlowTok{with} \BuiltInTok{open}\NormalTok{(}\StringTok{\textquotesingle{}./pickle\_data/pf\_pv\_unl\_purf.pkl\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}rb\textquotesingle{}}\NormalTok{) }\ImportTok{as}\NormalTok{ infile:}
\NormalTok{    pf\_pv\_unl\_model }\OperatorTok{=}\NormalTok{ pickle.load(infile)}
    
\ControlFlowTok{with} \BuiltInTok{open}\NormalTok{(}\StringTok{\textquotesingle{}./pickle\_data/pv\_pf\_pos\_purf.pkl\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}rb\textquotesingle{}}\NormalTok{) }\ImportTok{as}\NormalTok{ infile:}
\NormalTok{    pv\_pf\_pos\_model }\OperatorTok{=}\NormalTok{ pickle.load(infile)}
    
\ControlFlowTok{with} \BuiltInTok{open}\NormalTok{(}\StringTok{\textquotesingle{}./pickle\_data/pv\_pf\_unl\_purf.pkl\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}rb\textquotesingle{}}\NormalTok{) }\ImportTok{as}\NormalTok{ infile:}
\NormalTok{    pv\_pf\_unl\_model }\OperatorTok{=}\NormalTok{ pickle.load(infile)}

\NormalTok{res }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}pf\_single\_model\textquotesingle{}}\NormalTok{: [tree.get\_depth() }\ControlFlowTok{for}\NormalTok{ tree }\KeywordTok{in}\NormalTok{ pf\_single\_model[}\StringTok{\textquotesingle{}model\textquotesingle{}}\NormalTok{].estimators\_],}
                    \StringTok{\textquotesingle{}pv\_single\_model\textquotesingle{}}\NormalTok{: [tree.get\_depth() }\ControlFlowTok{for}\NormalTok{ tree }\KeywordTok{in}\NormalTok{ pv\_single\_model[}\StringTok{\textquotesingle{}model\textquotesingle{}}\NormalTok{].estimators\_],}
                    \StringTok{\textquotesingle{}pfpv\_combined\_model\textquotesingle{}}\NormalTok{: [tree.get\_depth() }\ControlFlowTok{for}\NormalTok{ tree }\KeywordTok{in}\NormalTok{ pfpv\_combined\_model[}\StringTok{\textquotesingle{}model\textquotesingle{}}\NormalTok{].estimators\_],}
                    \StringTok{\textquotesingle{}pf\_pv\_pos\_model\textquotesingle{}}\NormalTok{: [tree.get\_depth() }\ControlFlowTok{for}\NormalTok{ tree }\KeywordTok{in}\NormalTok{ pf\_pv\_pos\_model[}\StringTok{\textquotesingle{}model\textquotesingle{}}\NormalTok{].estimators\_],}
                    \StringTok{\textquotesingle{}pf\_pv\_unl\_model\textquotesingle{}}\NormalTok{: [tree.get\_depth() }\ControlFlowTok{for}\NormalTok{ tree }\KeywordTok{in}\NormalTok{ pf\_pv\_unl\_model[}\StringTok{\textquotesingle{}model\textquotesingle{}}\NormalTok{].estimators\_],}
                    \StringTok{\textquotesingle{}pv\_pf\_pos\_model\textquotesingle{}}\NormalTok{: [tree.get\_depth() }\ControlFlowTok{for}\NormalTok{ tree }\KeywordTok{in}\NormalTok{ pv\_pf\_pos\_model[}\StringTok{\textquotesingle{}model\textquotesingle{}}\NormalTok{].estimators\_],}
                    \StringTok{\textquotesingle{}pv\_pf\_unl\_model\textquotesingle{}}\NormalTok{: [tree.get\_depth() }\ControlFlowTok{for}\NormalTok{ tree }\KeywordTok{in}\NormalTok{ pv\_pf\_unl\_model[}\StringTok{\textquotesingle{}model\textquotesingle{}}\NormalTok{].estimators\_]\})}

\NormalTok{res.to\_csv(}\StringTok{\textquotesingle{}./other\_data/tree\_depths.csv\textquotesingle{}}\NormalTok{, index}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{In R}

\hypertarget{plotting-2}{%
\subsection{Plotting}\label{plotting-2}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(psych)}
\FunctionTok{library}\NormalTok{(ggrepel)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/tree\_depths.csv"}\NormalTok{)}
\NormalTok{proportion\_positives }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{52} \SpecialCharTok{/} \DecValTok{5393}\NormalTok{, }\DecValTok{90} \SpecialCharTok{/} \DecValTok{5431}\NormalTok{, }\DecValTok{52} \SpecialCharTok{/} \DecValTok{11846}\NormalTok{, }\DecValTok{38} \SpecialCharTok{/} \DecValTok{6491}\NormalTok{, }\DecValTok{90} \SpecialCharTok{/} \DecValTok{6543}\NormalTok{, }\DecValTok{38} \SpecialCharTok{/} \DecValTok{11832}\NormalTok{, }\DecValTok{90} \SpecialCharTok{/} \DecValTok{11884}\NormalTok{)}
\NormalTok{mean\_tree\_depth }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \FunctionTok{mean}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{pf\_single\_model), }\FunctionTok{mean}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{pf\_pv\_pos\_model), }\FunctionTok{mean}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{pf\_pv\_unl\_model),}
  \FunctionTok{mean}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{pv\_single\_model), }\FunctionTok{mean}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{pv\_pf\_pos\_model), }\FunctionTok{mean}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{pv\_pf\_unl\_model),}
  \FunctionTok{mean}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{pfpv\_combined\_model)}
\NormalTok{)}
\NormalTok{sd\_tree\_depth }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \FunctionTok{sd}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{pf\_single\_model), }\FunctionTok{sd}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{pf\_pv\_pos\_model), }\FunctionTok{sd}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{pf\_pv\_unl\_model),}
  \FunctionTok{sd}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{pv\_single\_model), }\FunctionTok{sd}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{pv\_pf\_pos\_model), }\FunctionTok{sd}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{pv\_pf\_unl\_model),}
  \FunctionTok{sd}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{pfpv\_combined\_model)}
\NormalTok{)}

\FunctionTok{cat}\NormalTok{(}\StringTok{"\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\DocumentationTok{\#\# \textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}
\FunctionTok{cat}\NormalTok{(}\StringTok{"No transformation}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\DocumentationTok{\#\# No transformation}
\FunctionTok{cat}\NormalTok{(}\StringTok{"\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\DocumentationTok{\#\# \textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}
\NormalTok{res }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(mean\_tree\_depth }\SpecialCharTok{\textasciitilde{}}\NormalTok{ proportion\_positives,}
  \AttributeTok{data =} \FunctionTok{data.frame}\NormalTok{(}
    \AttributeTok{proportion\_positives =}\NormalTok{ proportion\_positives,}
    \AttributeTok{mean\_tree\_depth =}\NormalTok{ mean\_tree\_depth}
\NormalTok{  )}
\NormalTok{)}
\FunctionTok{summary}\NormalTok{(res)}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Call:}
\DocumentationTok{\#\# lm(formula = mean\_tree\_depth \textasciitilde{} proportion\_positives, data = data.frame(proportion\_positives = proportion\_positives, }
\DocumentationTok{\#\#     mean\_tree\_depth = mean\_tree\_depth))}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Residuals:}
\DocumentationTok{\#\#        1        2        3        4        5        6        7 }
\DocumentationTok{\#\# {-}0.12948 {-}0.97473 {-}1.25954  0.10225  0.04435 {-}1.13048  3.34764 }
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Coefficients:}
\DocumentationTok{\#\#                      Estimate Std. Error t value Pr(\textgreater{}|t|)  }
\DocumentationTok{\#\# (Intercept)             3.269      1.411   2.317   0.0683 .}
\DocumentationTok{\#\# proportion\_positives  366.882    143.355   2.559   0.0507 .}
\DocumentationTok{\#\# {-}{-}{-}}
\DocumentationTok{\#\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Residual standard error: 1.735 on 5 degrees of freedom}
\DocumentationTok{\#\# Multiple R{-}squared:  0.5671, Adjusted R{-}squared:  0.4805 }
\DocumentationTok{\#\# F{-}statistic:  6.55 on 1 and 5 DF,  p{-}value: 0.05069}

\FunctionTok{cat}\NormalTok{(}\StringTok{"\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\DocumentationTok{\#\# \textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}
\FunctionTok{cat}\NormalTok{(}\StringTok{"Log transform for tree depth}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\DocumentationTok{\#\# Log transform for tree depth}
\FunctionTok{cat}\NormalTok{(}\StringTok{"\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\DocumentationTok{\#\# \textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}
\NormalTok{res }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(mean\_tree\_depth }\SpecialCharTok{\textasciitilde{}}\NormalTok{ proportion\_positives,}
  \AttributeTok{data =} \FunctionTok{data.frame}\NormalTok{(}
    \AttributeTok{proportion\_positives =}\NormalTok{ proportion\_positives,}
    \AttributeTok{mean\_tree\_depth =} \FunctionTok{log2}\NormalTok{(mean\_tree\_depth)}
\NormalTok{  )}
\NormalTok{)}
\FunctionTok{summary}\NormalTok{(res)}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Call:}
\DocumentationTok{\#\# lm(formula = mean\_tree\_depth \textasciitilde{} proportion\_positives, data = data.frame(proportion\_positives = proportion\_positives, }
\DocumentationTok{\#\#     mean\_tree\_depth = log2(mean\_tree\_depth)))}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Residuals:}
\DocumentationTok{\#\#         1         2         3         4         5         6         7 }
\DocumentationTok{\#\#  0.058792 {-}0.267279 {-}0.329568  0.140857 {-}0.004416 {-}0.344751  0.746365 }
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Coefficients:}
\DocumentationTok{\#\#                      Estimate Std. Error t value Pr(\textgreater{}|t|)   }
\DocumentationTok{\#\# (Intercept)             1.772      0.341   5.197  0.00348 **}
\DocumentationTok{\#\# proportion\_positives   94.203     34.650   2.719  0.04184 * }
\DocumentationTok{\#\# {-}{-}{-}}
\DocumentationTok{\#\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Residual standard error: 0.4194 on 5 degrees of freedom}
\DocumentationTok{\#\# Multiple R{-}squared:  0.5965, Adjusted R{-}squared:  0.5158 }
\DocumentationTok{\#\# F{-}statistic: 7.391 on 1 and 5 DF,  p{-}value: 0.04184}

\FunctionTok{cat}\NormalTok{(}\StringTok{"\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\DocumentationTok{\#\# \textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}
\FunctionTok{cat}\NormalTok{(}\StringTok{"Logit transform for proportion positives}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\DocumentationTok{\#\# Logit transform for proportion positives}
\FunctionTok{cat}\NormalTok{(}\StringTok{"\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\DocumentationTok{\#\# \textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}
\NormalTok{res }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(mean\_tree\_depth }\SpecialCharTok{\textasciitilde{}}\NormalTok{ proportion\_positives,}
  \AttributeTok{data =} \FunctionTok{data.frame}\NormalTok{(}
    \AttributeTok{proportion\_positives =} \FunctionTok{logit}\NormalTok{(proportion\_positives),}
    \AttributeTok{mean\_tree\_depth =}\NormalTok{ mean\_tree\_depth}
\NormalTok{  )}
\NormalTok{)}
\FunctionTok{summary}\NormalTok{(res)}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Call:}
\DocumentationTok{\#\# lm(formula = mean\_tree\_depth \textasciitilde{} proportion\_positives, data = data.frame(proportion\_positives = logit(proportion\_positives), }
\DocumentationTok{\#\#     mean\_tree\_depth = mean\_tree\_depth))}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Residuals:}
\DocumentationTok{\#\#       1       2       3       4       5       6       7 }
\DocumentationTok{\#\# {-}0.6182 {-}0.7549 {-}1.0271 {-}0.0954 {-}0.1369 {-}0.2818  2.9143 }
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Coefficients:}
\DocumentationTok{\#\#                      Estimate Std. Error t value Pr(\textgreater{}|t|)   }
\DocumentationTok{\#\# (Intercept)           22.7794     4.8653   4.682  0.00542 **}
\DocumentationTok{\#\# proportion\_positives   3.3428     0.9906   3.375  0.01979 * }
\DocumentationTok{\#\# {-}{-}{-}}
\DocumentationTok{\#\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Residual standard error: 1.457 on 5 degrees of freedom}
\DocumentationTok{\#\# Multiple R{-}squared:  0.6949, Adjusted R{-}squared:  0.6339 }
\DocumentationTok{\#\# F{-}statistic: 11.39 on 1 and 5 DF,  p{-}value: 0.01979}

\FunctionTok{cat}\NormalTok{(}\StringTok{"\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\DocumentationTok{\#\# \textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}
\FunctionTok{cat}\NormalTok{(}\StringTok{"Arc{-}sine transform for proportion positives}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\DocumentationTok{\#\# Arc{-}sine transform for proportion positives}
\FunctionTok{cat}\NormalTok{(}\StringTok{"\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\DocumentationTok{\#\# \textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}
\NormalTok{res }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(mean\_tree\_depth }\SpecialCharTok{\textasciitilde{}}\NormalTok{ proportion\_positives,}
  \AttributeTok{data =} \FunctionTok{data.frame}\NormalTok{(}
    \AttributeTok{proportion\_positives =} \FunctionTok{asin}\NormalTok{(}\FunctionTok{sqrt}\NormalTok{(proportion\_positives)),}
    \AttributeTok{mean\_tree\_depth =}\NormalTok{ mean\_tree\_depth}
\NormalTok{  )}
\NormalTok{)}
\FunctionTok{summary}\NormalTok{(res)}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Call:}
\DocumentationTok{\#\# lm(formula = mean\_tree\_depth \textasciitilde{} proportion\_positives, data = data.frame(proportion\_positives = asin(sqrt(proportion\_positives)), }
\DocumentationTok{\#\#     mean\_tree\_depth = mean\_tree\_depth))}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Residuals:}
\DocumentationTok{\#\#        1        2        3        4        5        6        7 }
\DocumentationTok{\#\# {-}0.37586 {-}0.90400 {-}1.11266  0.04187 {-}0.08305 {-}0.72069  3.15439 }
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Coefficients:}
\DocumentationTok{\#\#                      Estimate Std. Error t value Pr(\textgreater{}|t|)  }
\DocumentationTok{\#\# (Intercept)          {-}0.06706    2.29355  {-}0.029   0.9778  }
\DocumentationTok{\#\# proportion\_positives 72.39644   24.52407   2.952   0.0318 *}
\DocumentationTok{\#\# {-}{-}{-}}
\DocumentationTok{\#\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Residual standard error: 1.592 on 5 degrees of freedom}
\DocumentationTok{\#\# Multiple R{-}squared:  0.6354, Adjusted R{-}squared:  0.5625 }
\DocumentationTok{\#\# F{-}statistic: 8.715 on 1 and 5 DF,  p{-}value: 0.03181}

\FunctionTok{cat}\NormalTok{(}\StringTok{"\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\DocumentationTok{\#\# \textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}
\FunctionTok{cat}\NormalTok{(}\StringTok{"Logit transform for proportion positives \& log transform for tree depth }\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\DocumentationTok{\#\# Logit transform for proportion positives \& log transform for tree depth}
\FunctionTok{cat}\NormalTok{(}\StringTok{"\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\DocumentationTok{\#\# \textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}
\NormalTok{res }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(mean\_tree\_depth }\SpecialCharTok{\textasciitilde{}}\NormalTok{ proportion\_positives,}
  \AttributeTok{data =} \FunctionTok{data.frame}\NormalTok{(}
    \AttributeTok{proportion\_positives =} \FunctionTok{logit}\NormalTok{(proportion\_positives),}
    \AttributeTok{mean\_tree\_depth =} \FunctionTok{log2}\NormalTok{(mean\_tree\_depth)}
\NormalTok{  )}
\NormalTok{)}
\FunctionTok{summary}\NormalTok{(res)}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Call:}
\DocumentationTok{\#\# lm(formula = mean\_tree\_depth \textasciitilde{} proportion\_positives, data = data.frame(proportion\_positives = logit(proportion\_positives), }
\DocumentationTok{\#\#     mean\_tree\_depth = log2(mean\_tree\_depth)))}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Residuals:}
\DocumentationTok{\#\#        1        2        3        4        5        6        7 }
\DocumentationTok{\#\# {-}0.06899 {-}0.21823 {-}0.26484  0.09247 {-}0.05659 {-}0.11887  0.63505 }
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Coefficients:}
\DocumentationTok{\#\#                      Estimate Std. Error t value Pr(\textgreater{}|t|)   }
\DocumentationTok{\#\# (Intercept)            6.8270     1.1096   6.153  0.00165 **}
\DocumentationTok{\#\# proportion\_positives   0.8676     0.2259   3.840  0.01212 * }
\DocumentationTok{\#\# {-}{-}{-}}
\DocumentationTok{\#\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Residual standard error: 0.3322 on 5 degrees of freedom}
\DocumentationTok{\#\# Multiple R{-}squared:  0.7468, Adjusted R{-}squared:  0.6962 }
\DocumentationTok{\#\# F{-}statistic: 14.75 on 1 and 5 DF,  p{-}value: 0.01212}

\FunctionTok{cat}\NormalTok{(}\StringTok{"\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\DocumentationTok{\#\# \textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}
\FunctionTok{cat}\NormalTok{(}\StringTok{"Arc{-}sine transform for proportion positives \& log transform for tree depth}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\DocumentationTok{\#\# Arc{-}sine transform for proportion positives \& log transform for tree depth}
\FunctionTok{cat}\NormalTok{(}\StringTok{"\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\DocumentationTok{\#\# \textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}*\textasciitilde{}}
\NormalTok{res }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(mean\_tree\_depth }\SpecialCharTok{\textasciitilde{}}\NormalTok{ proportion\_positives,}
  \AttributeTok{data =} \FunctionTok{data.frame}\NormalTok{(}
    \AttributeTok{proportion\_positives =} \FunctionTok{asin}\NormalTok{(}\FunctionTok{sqrt}\NormalTok{(proportion\_positives)),}
    \AttributeTok{mean\_tree\_depth =} \FunctionTok{log2}\NormalTok{(mean\_tree\_depth)}
\NormalTok{  )}
\NormalTok{)}
\FunctionTok{summary}\NormalTok{(res)}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Call:}
\DocumentationTok{\#\# lm(formula = mean\_tree\_depth \textasciitilde{} proportion\_positives, data = data.frame(proportion\_positives = asin(sqrt(proportion\_positives)), }
\DocumentationTok{\#\#     mean\_tree\_depth = log2(mean\_tree\_depth)))}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Residuals:}
\DocumentationTok{\#\#        1        2        3        4        5        6        7 }
\DocumentationTok{\#\# {-}0.00527 {-}0.25295 {-}0.28949  0.12670 {-}0.03982 {-}0.23622  0.69705 }
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Coefficients:}
\DocumentationTok{\#\#                      Estimate Std. Error t value Pr(\textgreater{}|t|)  }
\DocumentationTok{\#\# (Intercept)            0.9066     0.5417   1.673   0.1551  }
\DocumentationTok{\#\# proportion\_positives  18.6878     5.7926   3.226   0.0233 *}
\DocumentationTok{\#\# {-}{-}{-}}
\DocumentationTok{\#\# Signif. codes:  0 \textquotesingle{}***\textquotesingle{} 0.001 \textquotesingle{}**\textquotesingle{} 0.01 \textquotesingle{}*\textquotesingle{} 0.05 \textquotesingle{}.\textquotesingle{} 0.1 \textquotesingle{} \textquotesingle{} 1}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# Residual standard error: 0.3761 on 5 degrees of freedom}
\DocumentationTok{\#\# Multiple R{-}squared:  0.6755, Adjusted R{-}squared:  0.6106 }
\DocumentationTok{\#\# F{-}statistic: 10.41 on 1 and 5 DF,  p{-}value: 0.02331}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{proportion\_positives =} \FunctionTok{logit}\NormalTok{(proportion\_positives),}
  \AttributeTok{mean\_tree\_depth =} \FunctionTok{log2}\NormalTok{(mean\_tree\_depth),}
  \AttributeTok{upper\_error\_tree\_depth =} \FunctionTok{log2}\NormalTok{(mean\_tree\_depth }\SpecialCharTok{+}\NormalTok{ sd\_tree\_depth),}
  \AttributeTok{lower\_error\_tree\_depth =} \FunctionTok{log2}\NormalTok{(mean\_tree\_depth }\SpecialCharTok{{-}}\NormalTok{ sd\_tree\_depth)}
\NormalTok{)}
\NormalTok{data}\SpecialCharTok{$}\NormalTok{model }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"italic(P.\textasciitilde{}falciparum)\textasciitilde{}model"}\NormalTok{,}
  \StringTok{"italic(P.\textasciitilde{}falciparum)\textasciitilde{}with\textasciitilde{}heterologous\textasciitilde{}positives\textasciitilde{}model"}\NormalTok{,}
  \StringTok{"italic(P.\textasciitilde{}falciparum)\textasciitilde{}with\textasciitilde{}heterologous\textasciitilde{}unlabeled\textasciitilde{}model"}\NormalTok{,}
  \StringTok{"italic(P.\textasciitilde{}vivax)\textasciitilde{}model"}\NormalTok{,}
  \StringTok{"italic(P.\textasciitilde{}vivax)\textasciitilde{}with\textasciitilde{}heterologous\textasciitilde{}positives\textasciitilde{}model"}\NormalTok{,}
  \StringTok{"italic(P.\textasciitilde{}vivax)\textasciitilde{}with\textasciitilde{}heterologous\textasciitilde{}unlabeled\textasciitilde{}model"}\NormalTok{,}
  \StringTok{"Combined\textasciitilde{}model"}
\NormalTok{)}

\NormalTok{lm\_eqn }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(data) \{}
\NormalTok{  m }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(mean\_tree\_depth }\SpecialCharTok{\textasciitilde{}}\NormalTok{ proportion\_positives, data)}
\NormalTok{  eq }\OtherTok{\textless{}{-}} \FunctionTok{substitute}\NormalTok{(}
\NormalTok{    log[}\DecValTok{2}\NormalTok{](}\FunctionTok{italic}\NormalTok{(y)) }\SpecialCharTok{==}\NormalTok{ a }\SpecialCharTok{+}\NormalTok{ b }\SpecialCharTok{\%.\%} \FunctionTok{logit}\NormalTok{(}\FunctionTok{italic}\NormalTok{(x)) }\SpecialCharTok{*} \StringTok{","} \SpecialCharTok{\textasciitilde{}} \ErrorTok{\textasciitilde{}} \FunctionTok{italic}\NormalTok{(r}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{) }\SpecialCharTok{\textasciitilde{}} \StringTok{"="} \SpecialCharTok{\textasciitilde{}}\NormalTok{ r2,}
    \FunctionTok{list}\NormalTok{(}
      \AttributeTok{a =} \FunctionTok{format}\NormalTok{(}\FunctionTok{unname}\NormalTok{(}\FunctionTok{coef}\NormalTok{(m)[}\DecValTok{1}\NormalTok{]), }\AttributeTok{digits =} \DecValTok{2}\NormalTok{),}
      \AttributeTok{b =} \FunctionTok{format}\NormalTok{(}\FunctionTok{unname}\NormalTok{(}\FunctionTok{coef}\NormalTok{(m)[}\DecValTok{2}\NormalTok{]), }\AttributeTok{digits =} \DecValTok{2}\NormalTok{),}
      \AttributeTok{r2 =} \FunctionTok{format}\NormalTok{(}\FunctionTok{summary}\NormalTok{(m)}\SpecialCharTok{$}\NormalTok{adj.r.squared, }\AttributeTok{digits =} \DecValTok{2}\NormalTok{)}
\NormalTok{    )}
\NormalTok{  )}
  \FunctionTok{as.character}\NormalTok{(}\FunctionTok{as.expression}\NormalTok{(eq))}
\NormalTok{\}}

\NormalTok{p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data, }\FunctionTok{aes}\NormalTok{(proportion\_positives, mean\_tree\_depth)) }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method =} \StringTok{"lm"}\NormalTok{, }\AttributeTok{formula =}\NormalTok{ y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x, }\AttributeTok{se =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey50"}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{color =} \StringTok{"grey10"}\NormalTok{, }\AttributeTok{size =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.8}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_errorbar}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{ymin =}\NormalTok{ lower\_error\_tree\_depth, }\AttributeTok{ymax =}\NormalTok{ upper\_error\_tree\_depth), }\AttributeTok{width =} \FloatTok{0.05}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.2}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ model),}
    \AttributeTok{size =} \FloatTok{2.5}\NormalTok{, }\AttributeTok{parse =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{segment.size =} \FloatTok{0.2}\NormalTok{,}
    \AttributeTok{nudge\_x =} \FloatTok{0.02}\NormalTok{, }\AttributeTok{nudge\_y =} \SpecialCharTok{{-}}\FloatTok{0.15}\NormalTok{, }\AttributeTok{point.padding =} \FloatTok{0.1}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\AttributeTok{x =} \SpecialCharTok{{-}}\FloatTok{5.5}\NormalTok{, }\AttributeTok{y =} \FloatTok{3.5}\NormalTok{, }\AttributeTok{label =} \FunctionTok{lm\_eqn}\NormalTok{(data), }\AttributeTok{parse =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{size =} \DecValTok{3}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_continuous}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{logit}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\FloatTok{0.004}\NormalTok{, }\FloatTok{0.008}\NormalTok{, }\FloatTok{0.012}\NormalTok{, }\FloatTok{0.016}\NormalTok{)),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.004}\NormalTok{, }\FloatTok{0.008}\NormalTok{, }\FloatTok{0.012}\NormalTok{, }\FloatTok{0.016}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{breaks =} \FunctionTok{log2}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\FloatTok{0.25}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{8}\NormalTok{)), }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.25}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{8}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Proportion of positives"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Mean tree depth"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{png}\NormalTok{(}\AttributeTok{file =} \StringTok{"./figures/Supplementary Fig 7.png"}\NormalTok{, }\AttributeTok{width =} \DecValTok{3800}\NormalTok{, }\AttributeTok{height =} \DecValTok{3500}\NormalTok{, }\AttributeTok{res =} \DecValTok{600}\NormalTok{)}
\FunctionTok{print}\NormalTok{(p)}
\FunctionTok{dev.off}\NormalTok{()}

\FunctionTok{pdf}\NormalTok{(}\AttributeTok{file =} \StringTok{"../supplementary\_figures/Supplementary Fig 7.pdf"}\NormalTok{, }\AttributeTok{width =} \FloatTok{7.6}\NormalTok{, }\AttributeTok{height =} \DecValTok{7}\NormalTok{)}
\FunctionTok{print}\NormalTok{(p)}
\FunctionTok{dev.off}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 7} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sessionInfo}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## R version 4.2.3 (2023-03-15)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur ... 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] ggrepel_0.9.3     psych_2.3.3       reticulate_1.28   DT_0.27          
##  [5] rcompanion_2.4.30 rlist_0.4.6.2     scales_1.2.1      ggsci_3.0.0      
##  [9] pracma_2.4.2      cowplot_1.1.1     gghalves_0.1.4    ggdist_3.2.1     
## [13] reshape2_1.4.4    ggplot2_3.4.2    
## 
## loaded via a namespace (and not attached):
##  [1] nlme_3.1-162         matrixStats_0.63.0   webshot_0.5.4       
##  [4] httr_1.4.6           rprojroot_2.0.3      R.cache_0.16.0      
##  [7] tools_4.2.3          bslib_0.4.2          utf8_1.2.3          
## [10] R6_2.5.1             nortest_1.0-4        colorspace_2.1-0    
## [13] withr_2.5.0          mnormt_2.1.1         tidyselect_1.2.0    
## [16] Exact_3.2            processx_3.8.1       compiler_4.2.3      
## [19] cli_3.6.1            expm_0.999-7         sandwich_3.0-2      
## [22] bookdown_0.34        sass_0.4.6           lmtest_0.9-40       
## [25] mvtnorm_1.1-3        callr_3.7.3          proxy_0.4-27        
## [28] multcompView_0.1-9   stringr_1.5.0        digest_0.6.31       
## [31] rmarkdown_2.21       R.utils_2.12.2       pkgconfig_2.0.3     
## [34] htmltools_0.5.5      styler_1.9.1         fastmap_1.1.1       
## [37] highr_0.10           htmlwidgets_1.6.2    rlang_1.1.1         
## [40] readxl_1.4.2         rstudioapi_0.14      jquerylib_0.1.4     
## [43] farver_2.1.1         generics_0.1.3       zoo_1.8-12          
## [46] jsonlite_1.8.4       crosstalk_1.2.0      dplyr_1.1.2         
## [49] R.oo_1.25.0          distributional_0.3.2 magrittr_2.0.3      
## [52] modeltools_0.2-23    Matrix_1.5-4         Rcpp_1.0.10         
## [55] DescTools_0.99.48    munsell_0.5.0        fansi_1.0.4         
## [58] lifecycle_1.0.3      R.methodsS3_1.8.2    stringi_1.7.12      
## [61] multcomp_1.4-23      yaml_2.3.7           MASS_7.3-60         
## [64] rootSolve_1.8.2.3    plyr_1.8.8           grid_4.2.3          
## [67] parallel_4.2.3       lmom_2.9             lattice_0.21-8      
## [70] splines_4.2.3        knitr_1.42           ps_1.7.5            
## [73] pillar_1.9.0         boot_1.3-28.1        gld_2.6.6           
## [76] codetools_0.2-19     stats4_4.2.3         glue_1.6.2          
## [79] evaluate_0.21        data.table_1.14.8    png_0.1-8           
## [82] vctrs_0.6.2          cellranger_1.1.0     gtable_0.3.3        
## [85] purrr_1.0.1          cachem_1.0.8         xfun_0.39           
## [88] coin_1.4-2           libcoin_1.0-9        e1071_1.7-13        
## [91] class_7.3-22         survival_3.5-5       tibble_3.2.1        
## [94] TH.data_1.1-2        ellipsis_0.3.2       here_1.0.1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{session\_info.show()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -----
## numpy               1.19.0
## pandas              1.3.2
## purf                NA
## session_info        1.0.0
## -----
## Python 3.8.2 (default, Mar 26 2020, 10:45:18) [Clang 4.0.1 (tags/RELEASE_401/final)]
## macOS-10.16-x86_64-i386-64bit
## -----
## Session information updated at 2023-05-18 12:31
\end{verbatim}

\hypertarget{05_model_interpretation}{%
\chapter{Model interpretation}\label{05_model_interpretation}}

\hypertarget{proximity-matrix-calculation}{%
\section{Proximity matrix calculation}\label{proximity-matrix-calculation}}

\hypertarget{analysis-4}{%
\subsection{Analysis}\label{analysis-4}}

\textbf{In Python: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(reticulate)}
\FunctionTok{use\_condaenv}\NormalTok{(}\StringTok{"/Users/renee/Library/r{-}miniconda/envs/purf/bin/python"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}
\ImportTok{import}\NormalTok{ numpy }\ImportTok{as}\NormalTok{ np}
\ImportTok{import}\NormalTok{ pickle}
\ImportTok{from}\NormalTok{ purf.pu\_ensemble }\ImportTok{import}\NormalTok{ PURandomForestClassifier}
\ImportTok{from}\NormalTok{ sklearn.impute }\ImportTok{import}\NormalTok{ SimpleImputer}
\ImportTok{from}\NormalTok{ sklearn.ensemble.\_forest }\ImportTok{import}\NormalTok{ \_generate\_unsampled\_indices}
\ImportTok{import}\NormalTok{ multiprocessing}
\ImportTok{from}\NormalTok{ joblib }\ImportTok{import}\NormalTok{ Parallel, delayed}
\NormalTok{num\_cores }\OperatorTok{=}\NormalTok{ multiprocessing.cpu\_count()}
\ImportTok{import}\NormalTok{ session\_info}
\end{Highlighting}
\end{Shaded}

\hypertarget{pv-data-set-3}{%
\subsubsection{Pv data set}\label{pv-data-set-3}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./other\_data/pv\_ml\_input.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{features }\OperatorTok{=}\NormalTok{ data.iloc[:, }\DecValTok{1}\NormalTok{:]}
\NormalTok{outcome }\OperatorTok{=}\NormalTok{ np.array(data.antigen\_label)}

\CommentTok{\# Imputation}
\NormalTok{imputer }\OperatorTok{=}\NormalTok{ SimpleImputer(strategy}\OperatorTok{=}\StringTok{\textquotesingle{}median\textquotesingle{}}\NormalTok{)}
\NormalTok{X }\OperatorTok{=}\NormalTok{ imputer.fit\_transform(features)}

\CommentTok{\# Load model}
\NormalTok{model\_tree\_filtered }\OperatorTok{=}\NormalTok{ pickle.load(}\BuiltInTok{open}\NormalTok{(}\StringTok{\textquotesingle{}./pickle\_data/pv\_0.5\_purf\_tree\_filtering.pkl\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}rb\textquotesingle{}}\NormalTok{))}
\NormalTok{model }\OperatorTok{=}\NormalTok{ model\_tree\_filtered[}\StringTok{\textquotesingle{}model\textquotesingle{}}\NormalTok{]}
\NormalTok{weights }\OperatorTok{=}\NormalTok{ model\_tree\_filtered[}\StringTok{\textquotesingle{}weights\textquotesingle{}}\NormalTok{]}

\KeywordTok{def}\NormalTok{ calculate\_proximity\_(trees, y, leaf\_indices):}
\NormalTok{    same\_leaf\_mat }\OperatorTok{=}\NormalTok{ np.zeros([y.shape[}\DecValTok{0}\NormalTok{], y.shape[}\DecValTok{0}\NormalTok{]])}
\NormalTok{    same\_oob\_mat }\OperatorTok{=}\NormalTok{ np.zeros([y.shape[}\DecValTok{0}\NormalTok{], y.shape[}\DecValTok{0}\NormalTok{]])}
    \ControlFlowTok{for}\NormalTok{ idx, tree }\KeywordTok{in} \BuiltInTok{enumerate}\NormalTok{(trees):}
\NormalTok{        oob\_indices }\OperatorTok{=}\NormalTok{ \_generate\_unsampled\_indices(tree.random\_state, y.shape[}\DecValTok{0}\NormalTok{], y.shape[}\DecValTok{0}\NormalTok{])}
        \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in}\NormalTok{ oob\_indices:}
            \ControlFlowTok{for}\NormalTok{ j }\KeywordTok{in}\NormalTok{ oob\_indices:}
\NormalTok{                same\_oob\_mat[i, j] }\OperatorTok{+=} \DecValTok{1}
                \ControlFlowTok{if}\NormalTok{ leaf\_indices[i, idx] }\OperatorTok{==}\NormalTok{ leaf\_indices[j, idx]:}
\NormalTok{                    same\_leaf\_mat[i, j] }\OperatorTok{+=} \DecValTok{1}
    \ControlFlowTok{return}\NormalTok{ (same\_leaf\_mat, same\_oob\_mat)}

\NormalTok{trees }\OperatorTok{=}\NormalTok{ model.estimators\_}
\NormalTok{leaf\_indices }\OperatorTok{=}\NormalTok{ model.}\BuiltInTok{apply}\NormalTok{(X)}
\NormalTok{idx\_list }\OperatorTok{=}\NormalTok{ [i }\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(trees)) }\ControlFlowTok{if}\NormalTok{ weights[i] }\OperatorTok{==} \DecValTok{1}\NormalTok{]}
\NormalTok{idx\_list }\OperatorTok{=}\NormalTok{ np.array\_split(idx\_list, }\DecValTok{1000}\NormalTok{)}

\NormalTok{res }\OperatorTok{=}\NormalTok{ Parallel(n\_jobs}\OperatorTok{=}\NormalTok{num\_cores)(}
\NormalTok{    delayed(calculate\_proximity\_)(}\BuiltInTok{list}\NormalTok{(trees[i] }\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in}\NormalTok{ idx), outcome, leaf\_indices[:, idx]) }\ControlFlowTok{for}\NormalTok{ idx }\KeywordTok{in}\NormalTok{ idx\_list)}

\NormalTok{same\_leaf\_mat }\OperatorTok{=} \BuiltInTok{sum}\NormalTok{([r[}\DecValTok{0}\NormalTok{] }\ControlFlowTok{for}\NormalTok{ r }\KeywordTok{in}\NormalTok{ res])}
\NormalTok{same\_oob\_mat }\OperatorTok{=} \BuiltInTok{sum}\NormalTok{([r[}\DecValTok{1}\NormalTok{] }\ControlFlowTok{for}\NormalTok{ r }\KeywordTok{in}\NormalTok{ res])}

\NormalTok{prox\_mat }\OperatorTok{=}\NormalTok{ pd.DataFrame(np.divide(same\_leaf\_mat, same\_oob\_mat, out}\OperatorTok{=}\NormalTok{np.zeros\_like(same\_leaf\_mat), }
\NormalTok{                        where}\OperatorTok{=}\NormalTok{same\_oob\_mat}\OperatorTok{!=}\DecValTok{0}\NormalTok{))}
\NormalTok{prox\_mat.index }\OperatorTok{=}\NormalTok{ features.index}
\NormalTok{prox\_mat.columns }\OperatorTok{=}\NormalTok{ features.index}
\NormalTok{prox\_mat.to\_csv(}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pv\_proximity\_values.csv\textquotesingle{}}\NormalTok{, index}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{pv-pf-combined-data-set-3}{%
\subsubsection{Pv + Pf combined data set}\label{pv-pf-combined-data-set-3}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./data/supplementary\_data\_4\_pfpv\_ml\_input.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{features }\OperatorTok{=}\NormalTok{ data.iloc[:, }\DecValTok{1}\NormalTok{:]}
\NormalTok{outcome }\OperatorTok{=}\NormalTok{ np.array(data.antigen\_label)}

\CommentTok{\# Imputation}
\NormalTok{imputer }\OperatorTok{=}\NormalTok{ SimpleImputer(strategy}\OperatorTok{=}\StringTok{\textquotesingle{}median\textquotesingle{}}\NormalTok{)}
\NormalTok{X }\OperatorTok{=}\NormalTok{ imputer.fit\_transform(features)}

\CommentTok{\# Load model}
\NormalTok{model\_tree\_filtered }\OperatorTok{=}\NormalTok{ pickle.load(}\BuiltInTok{open}\NormalTok{(}\StringTok{\textquotesingle{}./pickle\_data/pfpv\_0.5\_purf\_tree\_filtering.pkl\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}rb\textquotesingle{}}\NormalTok{))}
\NormalTok{model }\OperatorTok{=}\NormalTok{ model\_tree\_filtered[}\StringTok{\textquotesingle{}model\textquotesingle{}}\NormalTok{]}
\NormalTok{weights }\OperatorTok{=}\NormalTok{ model\_tree\_filtered[}\StringTok{\textquotesingle{}weights\textquotesingle{}}\NormalTok{]}

\KeywordTok{def}\NormalTok{ calculate\_proximity\_(trees, y, leaf\_indices):}
\NormalTok{    same\_leaf\_mat }\OperatorTok{=}\NormalTok{ np.zeros([y.shape[}\DecValTok{0}\NormalTok{], y.shape[}\DecValTok{0}\NormalTok{]])}
\NormalTok{    same\_oob\_mat }\OperatorTok{=}\NormalTok{ np.zeros([y.shape[}\DecValTok{0}\NormalTok{], y.shape[}\DecValTok{0}\NormalTok{]])}
    \ControlFlowTok{for}\NormalTok{ idx, tree }\KeywordTok{in} \BuiltInTok{enumerate}\NormalTok{(trees):}
\NormalTok{        oob\_indices }\OperatorTok{=}\NormalTok{ \_generate\_unsampled\_indices(tree.random\_state, y.shape[}\DecValTok{0}\NormalTok{], y.shape[}\DecValTok{0}\NormalTok{])}
        \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in}\NormalTok{ oob\_indices:}
            \ControlFlowTok{for}\NormalTok{ j }\KeywordTok{in}\NormalTok{ oob\_indices:}
\NormalTok{                same\_oob\_mat[i, j] }\OperatorTok{+=} \DecValTok{1}
                \ControlFlowTok{if}\NormalTok{ leaf\_indices[i, idx] }\OperatorTok{==}\NormalTok{ leaf\_indices[j, idx]:}
\NormalTok{                    same\_leaf\_mat[i, j] }\OperatorTok{+=} \DecValTok{1}
    \ControlFlowTok{return}\NormalTok{ (same\_leaf\_mat, same\_oob\_mat)}

\NormalTok{trees }\OperatorTok{=}\NormalTok{ model.estimators\_}
\NormalTok{leaf\_indices }\OperatorTok{=}\NormalTok{ model.}\BuiltInTok{apply}\NormalTok{(X)}
\NormalTok{idx\_list }\OperatorTok{=}\NormalTok{ [i }\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(trees)) }\ControlFlowTok{if}\NormalTok{ weights[i] }\OperatorTok{==} \DecValTok{1}\NormalTok{]}
\NormalTok{idx\_list }\OperatorTok{=}\NormalTok{ np.array\_split(idx\_list, }\DecValTok{1000}\NormalTok{)}

\NormalTok{res }\OperatorTok{=}\NormalTok{ Parallel(n\_jobs}\OperatorTok{=}\NormalTok{num\_cores)(}
\NormalTok{    delayed(calculate\_proximity\_)(}\BuiltInTok{list}\NormalTok{(trees[i] }\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in}\NormalTok{ idx), outcome, leaf\_indices[:, idx]) }\ControlFlowTok{for}\NormalTok{ idx }\KeywordTok{in}\NormalTok{ idx\_list)}

\NormalTok{same\_leaf\_mat }\OperatorTok{=} \BuiltInTok{sum}\NormalTok{([r[}\DecValTok{0}\NormalTok{] }\ControlFlowTok{for}\NormalTok{ r }\KeywordTok{in}\NormalTok{ res])}
\NormalTok{same\_oob\_mat }\OperatorTok{=} \BuiltInTok{sum}\NormalTok{([r[}\DecValTok{1}\NormalTok{] }\ControlFlowTok{for}\NormalTok{ r }\KeywordTok{in}\NormalTok{ res])}

\NormalTok{prox\_mat }\OperatorTok{=}\NormalTok{ pd.DataFrame(np.divide(same\_leaf\_mat, same\_oob\_mat, out}\OperatorTok{=}\NormalTok{np.zeros\_like(same\_leaf\_mat), }
\NormalTok{                        where}\OperatorTok{=}\NormalTok{same\_oob\_mat}\OperatorTok{!=}\DecValTok{0}\NormalTok{))}
\NormalTok{prox\_mat.index }\OperatorTok{=}\NormalTok{ features.index}
\NormalTok{prox\_mat.columns }\OperatorTok{=}\NormalTok{ features.index}
\NormalTok{prox\_mat.to\_csv(}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pfpv\_proximity\_values.csv\textquotesingle{}}\NormalTok{, index}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Multidimensional scaling}
\NormalTok{prox\_mat }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"\textasciitilde{}/Downloads/pv\_proximity\_values.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{mds }\OtherTok{\textless{}{-}} \FunctionTok{cmdscale}\NormalTok{(}\FunctionTok{as.dist}\NormalTok{(}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ prox\_mat), }\AttributeTok{k =} \FunctionTok{ncol}\NormalTok{(prox\_mat) }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{, }\AttributeTok{eig =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{var\_explained }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(mds}\SpecialCharTok{$}\NormalTok{eig }\SpecialCharTok{*} \DecValTok{100} \SpecialCharTok{/} \FunctionTok{sum}\NormalTok{(mds}\SpecialCharTok{$}\NormalTok{eig), }\DecValTok{2}\NormalTok{)}
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"Dimension 1 ("}\NormalTok{, var\_explained[}\DecValTok{1}\NormalTok{], }\StringTok{"\%)"}\NormalTok{)) }\CommentTok{\# 41.44\%}
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"Dimension 2 ("}\NormalTok{, var\_explained[}\DecValTok{2}\NormalTok{], }\StringTok{"\%)"}\NormalTok{)) }\CommentTok{\# 8.64\%}
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"Dimension 3 ("}\NormalTok{, var\_explained[}\DecValTok{3}\NormalTok{], }\StringTok{"\%)"}\NormalTok{)) }\CommentTok{\# 4.72\%}

\NormalTok{mds }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(mds}\SpecialCharTok{$}\NormalTok{points)}
\FunctionTok{write.csv}\NormalTok{(mds, }\StringTok{"\textasciitilde{}/Downloads/mds\_pv\_proximity\_values.csv"}\NormalTok{)}

\NormalTok{prox\_mat }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"\textasciitilde{}/Downloads/pfpv\_proximity\_values.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{mds }\OtherTok{\textless{}{-}} \FunctionTok{cmdscale}\NormalTok{(}\FunctionTok{as.dist}\NormalTok{(}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ prox\_mat), }\AttributeTok{k =} \FunctionTok{ncol}\NormalTok{(prox\_mat) }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{, }\AttributeTok{eig =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{var\_explained }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(mds}\SpecialCharTok{$}\NormalTok{eig }\SpecialCharTok{*} \DecValTok{100} \SpecialCharTok{/} \FunctionTok{sum}\NormalTok{(mds}\SpecialCharTok{$}\NormalTok{eig), }\DecValTok{2}\NormalTok{)}
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"Dimension 1 ("}\NormalTok{, var\_explained[}\DecValTok{1}\NormalTok{], }\StringTok{"\%)"}\NormalTok{)) }\CommentTok{\# 37.91\%}
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"Dimension 2 ("}\NormalTok{, var\_explained[}\DecValTok{2}\NormalTok{], }\StringTok{"\%)"}\NormalTok{)) }\CommentTok{\# 7.88\%}
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"Dimension 3 ("}\NormalTok{, var\_explained[}\DecValTok{3}\NormalTok{], }\StringTok{"\%)"}\NormalTok{)) }\CommentTok{\# 4.79\%}

\NormalTok{mds }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(mds}\SpecialCharTok{$}\NormalTok{points)}
\FunctionTok{write.csv}\NormalTok{(mds, }\StringTok{"\textasciitilde{}/Downloads/mds\_pfpv\_proximity\_values.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{plotting-3}{%
\subsection{Plotting}\label{plotting-3}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(umap)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(ggrepel)}
\FunctionTok{library}\NormalTok{(cowplot)}
\end{Highlighting}
\end{Shaded}

\hypertarget{pv-pf-combined-data-set-4}{%
\subsubsection{Pv + Pf combined data set}\label{pv-pf-combined-data-set-4}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"\textasciitilde{}/Downloads/mds\_pfpv\_proximity\_values.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}

\FunctionTok{set.seed}\NormalTok{(}\DecValTok{22}\NormalTok{)}
\NormalTok{umap\_res }\OtherTok{\textless{}{-}} \FunctionTok{umap}\NormalTok{(data)}
\NormalTok{umap\_df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(umap\_res}\SpecialCharTok{$}\NormalTok{layout)}
\FunctionTok{save}\NormalTok{(umap\_df, }\AttributeTok{file =} \StringTok{"./rdata/pfpv\_prox\_mds\_umap.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_5\_pfpv\_purf\_oob\_predictions.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)[}\DecValTok{5394}\SpecialCharTok{:}\DecValTok{11884}\NormalTok{, ]}
\FunctionTok{load}\NormalTok{(}\StringTok{"./rdata/pfpv\_prox\_mds\_umap.RData"}\NormalTok{)}
\NormalTok{umap\_df\_ }\OtherTok{\textless{}{-}}\NormalTok{ umap\_df[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5393}\NormalTok{, ]}
\NormalTok{umap\_df }\OtherTok{\textless{}{-}}\NormalTok{ umap\_df[}\DecValTok{5394}\SpecialCharTok{:}\DecValTok{11884}\NormalTok{, ]}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{label }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{antigen\_label}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{score }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}}
\NormalTok{umap\_df\_text }\OtherTok{\textless{}{-}}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ]}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PVP01\_0835600.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"CSP"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PVP01\_0623800.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"DBP"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PVP01\_0728900.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"MSP1"}

\NormalTok{umap\_p1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data =}\NormalTok{ umap\_df\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2), }\AttributeTok{color =} \StringTok{"grey90"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data =}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, ], }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2, }\AttributeTok{color =}\NormalTok{ score), }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ], }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2, }\AttributeTok{shape =} \FunctionTok{factor}\NormalTok{(}\DecValTok{21}\NormalTok{)), }\AttributeTok{color =} \StringTok{"black"}\NormalTok{,}
    \AttributeTok{fill =} \StringTok{"\#FCB40A"}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.9}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ umap\_df\_text, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2, }\AttributeTok{label =}\NormalTok{ label\_text), }\AttributeTok{size =} \FloatTok{3.5}\NormalTok{,}
    \AttributeTok{nudge\_x =} \DecValTok{1}\NormalTok{, }\AttributeTok{nudge\_y =} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\AttributeTok{point.padding =} \FloatTok{0.1}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_gradient2}\NormalTok{(}\AttributeTok{low =} \StringTok{"\#3399FF"}\NormalTok{, }\AttributeTok{mid =} \StringTok{"white"}\NormalTok{, }\AttributeTok{high =} \StringTok{"\#FF3399"}\NormalTok{, }\AttributeTok{midpoint =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{scale\_shape\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\DecValTok{21}\NormalTok{), }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Known antigens"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Dimension 1"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Dimension 2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_5\_pfpv\_purf\_oob\_predictions.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5393}\NormalTok{, ]}
\FunctionTok{load}\NormalTok{(}\StringTok{"./rdata/pfpv\_prox\_mds\_umap.RData"}\NormalTok{)}
\NormalTok{umap\_df\_ }\OtherTok{\textless{}{-}}\NormalTok{ umap\_df[}\DecValTok{5394}\SpecialCharTok{:}\DecValTok{11884}\NormalTok{, ]}
\NormalTok{umap\_df }\OtherTok{\textless{}{-}}\NormalTok{ umap\_df[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5393}\NormalTok{, ]}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{label }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{antigen\_label}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{score }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}}
\NormalTok{umap\_df\_text }\OtherTok{\textless{}{-}}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ]}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"CSP"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"RH5"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"MSP5"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0209000.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"P230"}

\NormalTok{umap\_p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data =}\NormalTok{ umap\_df\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2), }\AttributeTok{color =} \StringTok{"grey90"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data =}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, ], }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2, }\AttributeTok{color =}\NormalTok{ score), }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ], }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2), }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{,}
    \AttributeTok{fill =} \StringTok{"\#FCB40A"}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.9}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ umap\_df\_text, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2, }\AttributeTok{label =}\NormalTok{ label\_text), }\AttributeTok{size =} \FloatTok{3.5}\NormalTok{,}
    \AttributeTok{nudge\_x =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{nudge\_y =} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\AttributeTok{point.padding =} \FloatTok{0.1}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_gradient2}\NormalTok{(}\AttributeTok{low =} \StringTok{"\#3399FF"}\NormalTok{, }\AttributeTok{mid =} \StringTok{"white"}\NormalTok{, }\AttributeTok{high =} \StringTok{"\#FF3399"}\NormalTok{, }\AttributeTok{midpoint =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Dimension 1"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Dimension 2"}\NormalTok{)}

\NormalTok{legend }\OtherTok{\textless{}{-}} \FunctionTok{get\_legend}\NormalTok{(umap\_p2 }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{legend.direction =} \StringTok{"horizontal"}\NormalTok{,}
    \AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{,}
    \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{vjust =} \FloatTok{0.8}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{guides}\NormalTok{(}
    \AttributeTok{color =} \FunctionTok{guide\_colorbar}\NormalTok{(}\AttributeTok{title =} \StringTok{"Score"}\NormalTok{),}
    \AttributeTok{shape =} \FunctionTok{guide\_legend}\NormalTok{(}\AttributeTok{title =} \StringTok{""}\NormalTok{)}
\NormalTok{  ))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{umap\_p\_combined }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(umap\_p1, umap\_p2,}
  \FunctionTok{plot\_grid}\NormalTok{(}\ConstantTok{NULL}\NormalTok{, legend, }\AttributeTok{rel\_widths =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.15}\NormalTok{, }\FloatTok{0.85}\NormalTok{)),}
  \AttributeTok{ncol =} \DecValTok{2}\NormalTok{,}
  \AttributeTok{rel\_heights =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FloatTok{0.2}\NormalTok{), }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{""}\NormalTok{, }\StringTok{""}\NormalTok{)}
\NormalTok{)}
\NormalTok{umap\_p\_combined}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{png}\NormalTok{(}\AttributeTok{file =} \StringTok{"./figures/Fig 3.png"}\NormalTok{, }\AttributeTok{width =} \DecValTok{6000}\NormalTok{, }\AttributeTok{height =} \DecValTok{3500}\NormalTok{, }\AttributeTok{res =} \DecValTok{600}\NormalTok{)}
\FunctionTok{print}\NormalTok{(umap\_p\_combined)}
\FunctionTok{dev.off}\NormalTok{()}

\FunctionTok{pdf}\NormalTok{(}\AttributeTok{file =} \StringTok{"../figures/Fig 3.pdf"}\NormalTok{, }\AttributeTok{width =} \DecValTok{12}\NormalTok{, }\AttributeTok{height =} \DecValTok{7}\NormalTok{)}
\FunctionTok{print}\NormalTok{(umap\_p\_combined)}
\FunctionTok{dev.off}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Fig 3} \end{center}

\hypertarget{clustering-of-predicted-positives}{%
\section{Clustering of predicted positives}\label{clustering-of-predicted-positives}}

\hypertarget{analysis-5}{%
\subsection{Analysis}\label{analysis-5}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(DT)}
\FunctionTok{library}\NormalTok{(factoextra)}
\FunctionTok{library}\NormalTok{(NbClust)}
\FunctionTok{library}\NormalTok{(cluster)}
\FunctionTok{library}\NormalTok{(dendextend)}
\FunctionTok{library}\NormalTok{(umap)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(ggrepel)}
\FunctionTok{library}\NormalTok{(cowplot)}
\FunctionTok{library}\NormalTok{(scales)}
\FunctionTok{library}\NormalTok{(rcompanion)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{scientific }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \FunctionTok{ifelse}\NormalTok{(x }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, }\StringTok{"0"}\NormalTok{, }\FunctionTok{gsub}\NormalTok{(}\StringTok{"e"}\NormalTok{, }\StringTok{" * 10\^{}"}\NormalTok{, }\FunctionTok{scientific\_format}\NormalTok{(}\AttributeTok{digits =} \DecValTok{3}\NormalTok{)(x)))}
\NormalTok{\}}

\NormalTok{calculate\_association }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(clusters) \{}
\NormalTok{  species }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(clusters), }\ControlFlowTok{function}\NormalTok{(x) }\ControlFlowTok{if}\NormalTok{ (}\FunctionTok{startsWith}\NormalTok{(x, }\StringTok{"PF3D7"}\NormalTok{)) }\StringTok{"pf"} \ControlFlowTok{else} \StringTok{"pv"}\NormalTok{)}
\NormalTok{  M }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(clusters, species)}
\NormalTok{  Xsq }\OtherTok{\textless{}{-}} \FunctionTok{chisq.test}\NormalTok{(M, }\AttributeTok{correct =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{  cramerV }\OtherTok{\textless{}{-}} \FunctionTok{cramerV}\NormalTok{(M, }\AttributeTok{ci =} \ConstantTok{TRUE}\NormalTok{)}
  \FunctionTok{return}\NormalTok{(}\FunctionTok{list}\NormalTok{(}
    \AttributeTok{M =}\NormalTok{ M, }\AttributeTok{xsq\_pval =} \FunctionTok{scientific}\NormalTok{(}\FunctionTok{as.numeric}\NormalTok{(Xsq}\SpecialCharTok{$}\NormalTok{p.value)),}
    \AttributeTok{cramerV =} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, cramerV)}
\NormalTok{  ))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pfpv\_data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_5\_pfpv\_purf\_oob\_predictions.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{pred\_pos }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(pfpv\_data)[pfpv\_data}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{]}
\NormalTok{pfpv\_prox }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"\textasciitilde{}/Downloads/pfpv\_proximity\_values.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{pred\_pos\_dist }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ pfpv\_prox}
\FunctionTok{rownames}\NormalTok{(pred\_pos\_dist) }\OtherTok{\textless{}{-}} \FunctionTok{colnames}\NormalTok{(pred\_pos\_dist)}
\NormalTok{pred\_pos\_dist }\OtherTok{\textless{}{-}}\NormalTok{ pred\_pos\_dist[}\FunctionTok{rownames}\NormalTok{(pred\_pos\_dist) }\SpecialCharTok{\%in\%}\NormalTok{ pred\_pos, }\FunctionTok{colnames}\NormalTok{(pred\_pos\_dist) }\SpecialCharTok{\%in\%}\NormalTok{ pred\_pos]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pred\_pos\_hc }\OtherTok{\textless{}{-}} \FunctionTok{hclust}\NormalTok{(}\FunctionTok{as.dist}\NormalTok{(pred\_pos\_dist), }\AttributeTok{method =} \StringTok{"ward.D2"}\NormalTok{)}
\FunctionTok{save}\NormalTok{(pred\_pos\_hc, }\AttributeTok{file =} \StringTok{"./rdata/pred\_pos\_clusters.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\AttributeTok{file =} \StringTok{"./rdata/pred\_pos\_clusters.RData"}\NormalTok{)}
\NormalTok{clusters }\OtherTok{\textless{}{-}} \FunctionTok{cutree}\NormalTok{(pred\_pos\_hc, }\AttributeTok{k =} \DecValTok{2}\NormalTok{)}
\FunctionTok{calculate\_association}\NormalTok{(clusters)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $M
##         species
## clusters   pf   pv
##        1 1695 1918
##        2  979  759
## 
## $xsq_pval
## [1] "1.11 * 10^-10"
## 
## $cramerV
## [1] "0.09" "0.06" "0.12"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_5\_pfpv\_purf\_oob\_predictions.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\FunctionTok{load}\NormalTok{(}\StringTok{"./rdata/pfpv\_prox\_mds\_umap.RData"}\NormalTok{)}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{label }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{antigen\_label}
\NormalTok{umap\_df\_ }\OtherTok{\textless{}{-}}\NormalTok{ umap\_df[}\SpecialCharTok{!}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters), ]}
\NormalTok{umap\_df }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ], umap\_df[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters), ])}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Known antigen"}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0209000.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0835600.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0623800.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0728900.1{-}p1"}\NormalTok{)] }\OtherTok{\textless{}{-}} \StringTok{"Reference antigen"}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters)[clusters }\SpecialCharTok{==} \DecValTok{1}\NormalTok{]] }\OtherTok{\textless{}{-}} \StringTok{"Group 1"}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters)[clusters }\SpecialCharTok{==} \DecValTok{2}\NormalTok{]] }\OtherTok{\textless{}{-}} \StringTok{"Group 2"}
\NormalTok{umap\_df\_text }\OtherTok{\textless{}{-}}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ]}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"PfCSP"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"RH5"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"MSP5"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0209000.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"P230"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PVP01\_0835600.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"PvCSP"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PVP01\_0623800.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"DBP"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PVP01\_0728900.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"MSP1"}

\NormalTok{umap\_p1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data =}\NormalTok{ umap\_df\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2), }\AttributeTok{color =} \StringTok{"grey90"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data =}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, ], }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2, }\AttributeTok{fill =}\NormalTok{ group), }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"Group 1"}\NormalTok{, }\StringTok{"Group 2"}\NormalTok{), }\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#A552FD"}\NormalTok{, }\StringTok{"\#FD529B"}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Predicted antigen (Group 1)"}\NormalTok{, }\StringTok{"Predicted antigen (Group 2)"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ], }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2), }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{,}
    \AttributeTok{fill =} \StringTok{"\#FFFF33"}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ umap\_df\_text, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2, }\AttributeTok{label =}\NormalTok{ label\_text), }\AttributeTok{size =} \FloatTok{3.5}\NormalTok{,}
    \AttributeTok{nudge\_x =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{nudge\_y =} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\AttributeTok{point.padding =} \FloatTok{0.1}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"bottom"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{guides}\NormalTok{(}\AttributeTok{fill =} \FunctionTok{guide\_legend}\NormalTok{(}\AttributeTok{title =} \StringTok{""}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Dimension 1"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Dimension 2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\AttributeTok{file =} \StringTok{"./rdata/pred\_pos\_clusters.RData"}\NormalTok{)}
\NormalTok{pred\_pos\_hc\_list }\OtherTok{\textless{}{-}} \FunctionTok{get\_subdendrograms}\NormalTok{(}\FunctionTok{as.dendrogram}\NormalTok{(pred\_pos\_hc), }\DecValTok{2}\NormalTok{)}
\NormalTok{pred\_pos\_hc\_list\_2 }\OtherTok{\textless{}{-}} \FunctionTok{get\_subdendrograms}\NormalTok{(}\FunctionTok{as.dendrogram}\NormalTok{(pred\_pos\_hc\_list[[}\DecValTok{1}\NormalTok{]]), }\DecValTok{2}\NormalTok{)}
\NormalTok{clusters }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{nleaves}\NormalTok{(pred\_pos\_hc\_list\_2[[}\DecValTok{1}\NormalTok{]])),}
  \FunctionTok{rep}\NormalTok{(}\DecValTok{2}\NormalTok{, }\FunctionTok{nleaves}\NormalTok{(pred\_pos\_hc\_list\_2[[}\DecValTok{2}\NormalTok{]]))}
\NormalTok{)}
\FunctionTok{names}\NormalTok{(clusters) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{labels}\NormalTok{(pred\_pos\_hc\_list\_2[[}\DecValTok{1}\NormalTok{]]), }\FunctionTok{labels}\NormalTok{(pred\_pos\_hc\_list\_2[[}\DecValTok{2}\NormalTok{]]))}
\FunctionTok{save}\NormalTok{(pred\_pos\_hc, pred\_pos\_hc\_list, pred\_pos\_hc\_list\_2,}
  \AttributeTok{file =} \StringTok{"./rdata/pred\_pos\_clusters.RData"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\AttributeTok{file =} \StringTok{"./rdata/pred\_pos\_clusters.RData"}\NormalTok{)}
\NormalTok{clusters }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{nleaves}\NormalTok{(pred\_pos\_hc\_list\_2[[}\DecValTok{1}\NormalTok{]])),}
  \FunctionTok{rep}\NormalTok{(}\DecValTok{2}\NormalTok{, }\FunctionTok{nleaves}\NormalTok{(pred\_pos\_hc\_list\_2[[}\DecValTok{2}\NormalTok{]]))}
\NormalTok{)}
\FunctionTok{names}\NormalTok{(clusters) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{labels}\NormalTok{(pred\_pos\_hc\_list\_2[[}\DecValTok{1}\NormalTok{]]), }\FunctionTok{labels}\NormalTok{(pred\_pos\_hc\_list\_2[[}\DecValTok{2}\NormalTok{]]))}
\FunctionTok{calculate\_association}\NormalTok{(clusters)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $M
##         species
## clusters   pf   pv
##        1  147  519
##        2 1548 1399
## 
## $xsq_pval
## [1] "6.5 * 10^-46"
## 
## $cramerV
## [1] "0.24" "0.21" "0.27"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_5\_pfpv\_purf\_oob\_predictions.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\FunctionTok{load}\NormalTok{(}\StringTok{"./rdata/pfpv\_prox\_mds\_umap.RData"}\NormalTok{)}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{label }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{antigen\_label}
\NormalTok{umap\_df\_ }\OtherTok{\textless{}{-}}\NormalTok{ umap\_df[}\SpecialCharTok{!}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters), ]}
\NormalTok{umap\_df }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ], umap\_df[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters), ])}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Known antigen"}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0209000.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0835600.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0623800.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0728900.1{-}p1"}\NormalTok{)] }\OtherTok{\textless{}{-}} \StringTok{"Reference antigen"}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters)[clusters }\SpecialCharTok{==} \DecValTok{1}\NormalTok{]] }\OtherTok{\textless{}{-}} \StringTok{"Group 1"}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters)[clusters }\SpecialCharTok{==} \DecValTok{2}\NormalTok{]] }\OtherTok{\textless{}{-}} \StringTok{"Group 2"}
\NormalTok{umap\_df\_text }\OtherTok{\textless{}{-}}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ]}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"PfCSP"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"RH5"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"MSP5"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0209000.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"P230"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PVP01\_0835600.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"PvCSP"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PVP01\_0623800.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"DBP"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PVP01\_0728900.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"MSP1"}

\NormalTok{umap\_p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data =}\NormalTok{ umap\_df\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2), }\AttributeTok{color =} \StringTok{"grey90"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data =}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, ], }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2, }\AttributeTok{fill =}\NormalTok{ group), }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"Group 1"}\NormalTok{, }\StringTok{"Group 2"}\NormalTok{), }\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#A552FD"}\NormalTok{, }\StringTok{"\#53F4EF"}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Predicted antigen (Group 1)"}\NormalTok{, }\StringTok{"Predicted antigen (Group 2)"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ], }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2), }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{,}
    \AttributeTok{fill =} \StringTok{"\#FFFF33"}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ umap\_df\_text, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2, }\AttributeTok{label =}\NormalTok{ label\_text), }\AttributeTok{size =} \FloatTok{3.5}\NormalTok{,}
    \AttributeTok{nudge\_x =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{nudge\_y =} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\AttributeTok{point.padding =} \FloatTok{0.1}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"bottom"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{guides}\NormalTok{(}\AttributeTok{fill =} \FunctionTok{guide\_legend}\NormalTok{(}\AttributeTok{title =} \StringTok{""}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Dimension 1"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Dimension 2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\AttributeTok{file =} \StringTok{"./rdata/pred\_pos\_clusters.RData"}\NormalTok{)}
\NormalTok{pred\_pos\_hc\_list\_3 }\OtherTok{\textless{}{-}} \FunctionTok{get\_subdendrograms}\NormalTok{(}\FunctionTok{as.dendrogram}\NormalTok{(pred\_pos\_hc\_list\_2[[}\DecValTok{2}\NormalTok{]]), }\DecValTok{2}\NormalTok{)}
\NormalTok{clusters }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{nleaves}\NormalTok{(pred\_pos\_hc\_list\_3[[}\DecValTok{1}\NormalTok{]])),}
  \FunctionTok{rep}\NormalTok{(}\DecValTok{2}\NormalTok{, }\FunctionTok{nleaves}\NormalTok{(pred\_pos\_hc\_list\_3[[}\DecValTok{2}\NormalTok{]]))}
\NormalTok{)}
\FunctionTok{names}\NormalTok{(clusters) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{labels}\NormalTok{(pred\_pos\_hc\_list\_3[[}\DecValTok{1}\NormalTok{]]), }\FunctionTok{labels}\NormalTok{(pred\_pos\_hc\_list\_3[[}\DecValTok{2}\NormalTok{]]))}
\FunctionTok{save}\NormalTok{(pred\_pos\_hc, pred\_pos\_hc\_list, pred\_pos\_hc\_list\_2, pred\_pos\_hc\_list\_3,}
  \AttributeTok{file =} \StringTok{"./rdata/pred\_pos\_clusters.RData"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\AttributeTok{file =} \StringTok{"./rdata/pred\_pos\_clusters.RData"}\NormalTok{)}
\NormalTok{clusters }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{nleaves}\NormalTok{(pred\_pos\_hc\_list\_3[[}\DecValTok{1}\NormalTok{]])),}
  \FunctionTok{rep}\NormalTok{(}\DecValTok{2}\NormalTok{, }\FunctionTok{nleaves}\NormalTok{(pred\_pos\_hc\_list\_3[[}\DecValTok{2}\NormalTok{]]))}
\NormalTok{)}
\FunctionTok{names}\NormalTok{(clusters) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{labels}\NormalTok{(pred\_pos\_hc\_list\_3[[}\DecValTok{1}\NormalTok{]]), }\FunctionTok{labels}\NormalTok{(pred\_pos\_hc\_list\_3[[}\DecValTok{2}\NormalTok{]]))}
\FunctionTok{calculate\_association}\NormalTok{(clusters)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $M
##         species
## clusters   pf   pv
##        1 1505   40
##        2   43 1359
## 
## $xsq_pval
## [1] "0"
## 
## $cramerV
## [1] "0.94" "0.93" "0.95"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_5\_pfpv\_purf\_oob\_predictions.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\FunctionTok{load}\NormalTok{(}\StringTok{"./rdata/pfpv\_prox\_mds\_umap.RData"}\NormalTok{)}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{label }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{antigen\_label}
\NormalTok{umap\_df\_ }\OtherTok{\textless{}{-}}\NormalTok{ umap\_df[}\SpecialCharTok{!}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters), ]}
\NormalTok{umap\_df }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ], umap\_df[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters), ])}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Known antigen"}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0209000.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0835600.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0623800.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0728900.1{-}p1"}\NormalTok{)] }\OtherTok{\textless{}{-}} \StringTok{"Reference antigen"}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters)[clusters }\SpecialCharTok{==} \DecValTok{1}\NormalTok{]] }\OtherTok{\textless{}{-}} \StringTok{"Group 1"}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters)[clusters }\SpecialCharTok{==} \DecValTok{2}\NormalTok{]] }\OtherTok{\textless{}{-}} \StringTok{"Group 2"}
\NormalTok{umap\_df\_text }\OtherTok{\textless{}{-}}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ]}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"PfCSP"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"RH5"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"MSP5"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0209000.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"P230"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PVP01\_0835600.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"PvCSP"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PVP01\_0623800.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"DBP"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PVP01\_0728900.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"MSP1"}

\NormalTok{umap\_p3 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data =}\NormalTok{ umap\_df\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2), }\AttributeTok{color =} \StringTok{"grey90"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data =}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, ], }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2, }\AttributeTok{fill =}\NormalTok{ group), }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"Group 1"}\NormalTok{, }\StringTok{"Group 2"}\NormalTok{), }\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#F49553"}\NormalTok{, }\StringTok{"\#53F4EF"}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Predicted antigen (Group 1)"}\NormalTok{, }\StringTok{"Predicted antigen (Group 2)"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ], }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2), }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{,}
    \AttributeTok{fill =} \StringTok{"\#FFFF33"}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ umap\_df\_text, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2, }\AttributeTok{label =}\NormalTok{ label\_text), }\AttributeTok{size =} \FloatTok{3.5}\NormalTok{,}
    \AttributeTok{nudge\_x =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{nudge\_y =} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\AttributeTok{point.padding =} \FloatTok{0.1}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"bottom"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{guides}\NormalTok{(}\AttributeTok{fill =} \FunctionTok{guide\_legend}\NormalTok{(}\AttributeTok{title =} \StringTok{""}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Dimension 1"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Dimension 2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\AttributeTok{file =} \StringTok{"./rdata/pred\_pos\_clusters.RData"}\NormalTok{)}
\NormalTok{pred\_pos\_hc\_list\_4 }\OtherTok{\textless{}{-}} \FunctionTok{get\_subdendrograms}\NormalTok{(}\FunctionTok{as.dendrogram}\NormalTok{(pred\_pos\_hc\_list\_3[[}\DecValTok{1}\NormalTok{]]), }\DecValTok{2}\NormalTok{)}
\NormalTok{clusters }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{nleaves}\NormalTok{(pred\_pos\_hc\_list\_4[[}\DecValTok{1}\NormalTok{]])),}
  \FunctionTok{rep}\NormalTok{(}\DecValTok{2}\NormalTok{, }\FunctionTok{nleaves}\NormalTok{(pred\_pos\_hc\_list\_4[[}\DecValTok{2}\NormalTok{]]))}
\NormalTok{)}
\FunctionTok{names}\NormalTok{(clusters) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{labels}\NormalTok{(pred\_pos\_hc\_list\_4[[}\DecValTok{1}\NormalTok{]]), }\FunctionTok{labels}\NormalTok{(pred\_pos\_hc\_list\_4[[}\DecValTok{2}\NormalTok{]]))}
\FunctionTok{save}\NormalTok{(pred\_pos\_hc, pred\_pos\_hc\_list, pred\_pos\_hc\_list\_2, pred\_pos\_hc\_list\_3, pred\_pos\_hc\_list\_4,}
  \AttributeTok{file =} \StringTok{"./rdata/pred\_pos\_clusters.RData"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\AttributeTok{file =} \StringTok{"./rdata/pred\_pos\_clusters.RData"}\NormalTok{)}
\NormalTok{clusters }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{nleaves}\NormalTok{(pred\_pos\_hc\_list\_4[[}\DecValTok{1}\NormalTok{]])),}
  \FunctionTok{rep}\NormalTok{(}\DecValTok{2}\NormalTok{, }\FunctionTok{nleaves}\NormalTok{(pred\_pos\_hc\_list\_4[[}\DecValTok{2}\NormalTok{]]))}
\NormalTok{)}
\FunctionTok{names}\NormalTok{(clusters) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{labels}\NormalTok{(pred\_pos\_hc\_list\_4[[}\DecValTok{1}\NormalTok{]]), }\FunctionTok{labels}\NormalTok{(pred\_pos\_hc\_list\_4[[}\DecValTok{2}\NormalTok{]]))}
\FunctionTok{calculate\_association}\NormalTok{(clusters)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $M
##         species
## clusters  pf  pv
##        1 563  18
##        2 942  22
## 
## $xsq_pval
## [1] "3.28 * 10^-01"
## 
## $cramerV
## [1] "0.02" "0.00" "0.08"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_5\_pfpv\_purf\_oob\_predictions.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\FunctionTok{load}\NormalTok{(}\StringTok{"./rdata/pfpv\_prox\_mds\_umap.RData"}\NormalTok{)}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{label }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{antigen\_label}
\NormalTok{umap\_df\_ }\OtherTok{\textless{}{-}}\NormalTok{ umap\_df[}\SpecialCharTok{!}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters), ]}
\NormalTok{umap\_df }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ], umap\_df[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters), ])}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Known antigen"}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0209000.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0835600.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0623800.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0728900.1{-}p1"}\NormalTok{)] }\OtherTok{\textless{}{-}} \StringTok{"Reference antigen"}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters)[clusters }\SpecialCharTok{==} \DecValTok{1}\NormalTok{]] }\OtherTok{\textless{}{-}} \StringTok{"Group 1"}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters)[clusters }\SpecialCharTok{==} \DecValTok{2}\NormalTok{]] }\OtherTok{\textless{}{-}} \StringTok{"Group 2"}
\NormalTok{umap\_df\_text }\OtherTok{\textless{}{-}}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ]}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"PfCSP"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"RH5"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"MSP5"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0209000.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"P230"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PVP01\_0835600.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"PvCSP"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PVP01\_0623800.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"DBP"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PVP01\_0728900.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"MSP1"}

\NormalTok{umap\_p4 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data =}\NormalTok{ umap\_df\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2), }\AttributeTok{color =} \StringTok{"grey90"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data =}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, ], }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2, }\AttributeTok{fill =}\NormalTok{ group), }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"Group 1"}\NormalTok{, }\StringTok{"Group 2"}\NormalTok{), }\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#F49553"}\NormalTok{, }\StringTok{"\#D953F4"}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Predicted antigen (Group 1)"}\NormalTok{, }\StringTok{"Predicted antigen (Group 2)"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ], }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2), }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{,}
    \AttributeTok{fill =} \StringTok{"\#FFFF33"}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ umap\_df\_text, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2, }\AttributeTok{label =}\NormalTok{ label\_text), }\AttributeTok{size =} \FloatTok{3.5}\NormalTok{,}
    \AttributeTok{nudge\_x =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{nudge\_y =} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\AttributeTok{point.padding =} \FloatTok{0.1}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"bottom"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{guides}\NormalTok{(}\AttributeTok{fill =} \FunctionTok{guide\_legend}\NormalTok{(}\AttributeTok{title =} \StringTok{""}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Dimension 1"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Dimension 2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{umap\_p\_combined }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(umap\_p1, umap\_p2, umap\_p3, umap\_p4,}
  \AttributeTok{nrow =} \DecValTok{2}\NormalTok{,}
  \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{, }\StringTok{"d"}\NormalTok{)}
\NormalTok{)}
\NormalTok{umap\_p\_combined}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{png}\NormalTok{(}\AttributeTok{file =} \StringTok{"./figures/Supplementary Fig 8.png"}\NormalTok{, }\AttributeTok{width =} \DecValTok{6000}\NormalTok{, }\AttributeTok{height =} \DecValTok{6200}\NormalTok{, }\AttributeTok{res =} \DecValTok{600}\NormalTok{)}
\FunctionTok{print}\NormalTok{(umap\_p\_combined)}
\FunctionTok{dev.off}\NormalTok{()}

\FunctionTok{pdf}\NormalTok{(}\AttributeTok{file =} \StringTok{"../supplementary\_figures/Supplementary Fig 8.pdf"}\NormalTok{, }\AttributeTok{width =} \DecValTok{12}\NormalTok{, }\AttributeTok{height =} \FloatTok{12.4}\NormalTok{)}
\FunctionTok{print}\NormalTok{(umap\_p\_combined)}
\FunctionTok{dev.off}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 8} \end{center}

\hypertarget{comparison-of-amino-acid-frequencies-between-species}{%
\section{Comparison of amino acid frequencies between species}\label{comparison-of-amino-acid-frequencies-between-species}}

\hypertarget{analysis-6}{%
\subsection{Analysis}\label{analysis-6}}

\textbf{Python: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(reticulate)}
\FunctionTok{use\_condaenv}\NormalTok{(}\StringTok{"/Users/renee/Library/r{-}miniconda/envs/purf/bin/python"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{from}\NormalTok{ Bio }\ImportTok{import}\NormalTok{ SeqIO}
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ds }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./data/supplementary\_data\_5\_pfpv\_purf\_oob\_predictions.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{pv\_records }\OperatorTok{=} \BuiltInTok{list}\NormalTok{(SeqIO.parse(}\StringTok{\textquotesingle{}./other\_data/combined\_PlasmoDB{-}45\_PvivaxP01\_AnnotatedProteins\_no\_pseudo\_genes\_special\_sequences\_modified.fasta\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}fasta\textquotesingle{}}\NormalTok{))}
\NormalTok{pf\_records }\OperatorTok{=} \BuiltInTok{list}\NormalTok{(SeqIO.parse(}\StringTok{\textquotesingle{}./other\_data/combined\_PlasmoDB{-}43\_Pfalciparum3D7\_AnnotatedProteins\_no\_pseudo\_genes\_special\_sequences\_modified.fasta\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}fasta\textquotesingle{}}\NormalTok{))}

\NormalTok{pv\_pos }\OperatorTok{=}\NormalTok{ ds[(ds[}\StringTok{\textquotesingle{}OOB score filtered\textquotesingle{}}\NormalTok{] }\OperatorTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{) }\OperatorTok{\&}\NormalTok{ (ds[}\StringTok{\textquotesingle{}species\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \StringTok{\textquotesingle{}pv\textquotesingle{}}\NormalTok{)].index}
\NormalTok{pf\_pos }\OperatorTok{=}\NormalTok{ ds[(ds[}\StringTok{\textquotesingle{}OOB score filtered\textquotesingle{}}\NormalTok{] }\OperatorTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{) }\OperatorTok{\&}\NormalTok{ (ds[}\StringTok{\textquotesingle{}species\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \StringTok{\textquotesingle{}pf\textquotesingle{}}\NormalTok{)].index}
\NormalTok{pv\_neg }\OperatorTok{=}\NormalTok{ ds[(ds[}\StringTok{\textquotesingle{}OOB score filtered\textquotesingle{}}\NormalTok{] }\OperatorTok{\textless{}} \FloatTok{0.5}\NormalTok{) }\OperatorTok{\&}\NormalTok{ (ds[}\StringTok{\textquotesingle{}species\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \StringTok{\textquotesingle{}pv\textquotesingle{}}\NormalTok{)].index}
\NormalTok{pf\_neg }\OperatorTok{=}\NormalTok{ ds[(ds[}\StringTok{\textquotesingle{}OOB score filtered\textquotesingle{}}\NormalTok{] }\OperatorTok{\textless{}} \FloatTok{0.5}\NormalTok{) }\OperatorTok{\&}\NormalTok{ (ds[}\StringTok{\textquotesingle{}species\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \StringTok{\textquotesingle{}pf\textquotesingle{}}\NormalTok{)].index}

\NormalTok{pv\_pos\_records }\OperatorTok{=}\NormalTok{ [record }\ControlFlowTok{for}\NormalTok{ record }\KeywordTok{in}\NormalTok{ pv\_records }\ControlFlowTok{if}\NormalTok{ record.}\BuiltInTok{id} \KeywordTok{in}\NormalTok{ pv\_pos]}
\NormalTok{pf\_pos\_records }\OperatorTok{=}\NormalTok{ [record }\ControlFlowTok{for}\NormalTok{ record }\KeywordTok{in}\NormalTok{ pf\_records }\ControlFlowTok{if}\NormalTok{ record.}\BuiltInTok{id} \KeywordTok{in}\NormalTok{ pf\_pos]}
\NormalTok{pv\_neg\_records }\OperatorTok{=}\NormalTok{ [record }\ControlFlowTok{for}\NormalTok{ record }\KeywordTok{in}\NormalTok{ pv\_records }\ControlFlowTok{if}\NormalTok{ record.}\BuiltInTok{id} \KeywordTok{in}\NormalTok{ pv\_neg]}
\NormalTok{pf\_neg\_records }\OperatorTok{=}\NormalTok{ [record }\ControlFlowTok{for}\NormalTok{ record }\KeywordTok{in}\NormalTok{ pf\_records }\ControlFlowTok{if}\NormalTok{ record.}\BuiltInTok{id} \KeywordTok{in}\NormalTok{ pf\_neg]}

\NormalTok{aa\_freq }\OperatorTok{=}\NormalTok{ \{\}}
\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \StringTok{\textquotesingle{}ACDEFGHIKLMNPQRSTVWY\textquotesingle{}}\NormalTok{:}
\NormalTok{    aa\_freq[i] }\OperatorTok{=}\NormalTok{ [}\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{]}
    
\ControlFlowTok{for}\NormalTok{ record }\KeywordTok{in}\NormalTok{ pv\_records:}
    \ControlFlowTok{for}\NormalTok{ char }\KeywordTok{in}\NormalTok{ record.seq:}
\NormalTok{        aa\_freq[char][}\DecValTok{0}\NormalTok{] }\OperatorTok{+=} \DecValTok{1}

\ControlFlowTok{for}\NormalTok{ record }\KeywordTok{in}\NormalTok{ pf\_records:}
    \ControlFlowTok{for}\NormalTok{ char }\KeywordTok{in}\NormalTok{ record.seq:}
\NormalTok{        aa\_freq[char][}\DecValTok{1}\NormalTok{] }\OperatorTok{+=} \DecValTok{1}

\ControlFlowTok{for}\NormalTok{ record }\KeywordTok{in}\NormalTok{ pv\_pos\_records:}
    \ControlFlowTok{for}\NormalTok{ char }\KeywordTok{in}\NormalTok{ record.seq:}
\NormalTok{        aa\_freq[char][}\DecValTok{2}\NormalTok{] }\OperatorTok{+=} \DecValTok{1}

\ControlFlowTok{for}\NormalTok{ record }\KeywordTok{in}\NormalTok{ pf\_pos\_records:}
    \ControlFlowTok{for}\NormalTok{ char }\KeywordTok{in}\NormalTok{ record.seq:}
\NormalTok{        aa\_freq[char][}\DecValTok{3}\NormalTok{] }\OperatorTok{+=} \DecValTok{1}

\ControlFlowTok{for}\NormalTok{ record }\KeywordTok{in}\NormalTok{ pv\_neg\_records:}
    \ControlFlowTok{for}\NormalTok{ char }\KeywordTok{in}\NormalTok{ record.seq:}
\NormalTok{        aa\_freq[char][}\DecValTok{4}\NormalTok{] }\OperatorTok{+=} \DecValTok{1}

\ControlFlowTok{for}\NormalTok{ record }\KeywordTok{in}\NormalTok{ pf\_neg\_records:}
    \ControlFlowTok{for}\NormalTok{ char }\KeywordTok{in}\NormalTok{ record.seq:}
\NormalTok{        aa\_freq[char][}\DecValTok{5}\NormalTok{] }\OperatorTok{+=} \DecValTok{1}

\NormalTok{res }\OperatorTok{=}\NormalTok{ pd.DataFrame.from\_dict(aa\_freq)}
\NormalTok{res.index }\OperatorTok{=}\NormalTok{ [}\StringTok{\textquotesingle{}pv\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}pf\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}pv\_pos\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}pf\_pos\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}pv\_neg\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}pf\_neg\textquotesingle{}}\NormalTok{]}
\NormalTok{res.to\_csv(}\StringTok{\textquotesingle{}./other\_data/pfpv\_aa\_freq.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(rcompanion)}
\FunctionTok{library}\NormalTok{(rlist)}
\FunctionTok{library}\NormalTok{(DT)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{scientific }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \FunctionTok{ifelse}\NormalTok{(x }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, }\StringTok{"0"}\NormalTok{, }\FunctionTok{gsub}\NormalTok{(}\StringTok{"e"}\NormalTok{, }\StringTok{" * 10\^{}"}\NormalTok{, }\FunctionTok{scientific\_format}\NormalTok{(}\AttributeTok{digits =} \DecValTok{3}\NormalTok{)(x)))}
\NormalTok{\}}

\NormalTok{ds }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pfpv\_aa\_freq.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{chisq\_pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\NormalTok{cramer\_res }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
\CommentTok{\# Comparison between Pv and Pf}
\NormalTok{M }\OtherTok{\textless{}{-}} \FunctionTok{as.table}\NormalTok{(}\FunctionTok{as.matrix}\NormalTok{(ds[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{, ]))}
\NormalTok{Xsq }\OtherTok{\textless{}{-}} \FunctionTok{chisq.test}\NormalTok{(M, }\AttributeTok{correct =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{cramerV }\OtherTok{\textless{}{-}} \FunctionTok{cramerV}\NormalTok{(M, }\AttributeTok{ci =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{R =} \DecValTok{100}\NormalTok{)}
\NormalTok{chisq\_pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(chisq\_pval, Xsq}\SpecialCharTok{$}\NormalTok{p.value)}
\NormalTok{cramer\_res }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(cramer\_res, }\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, cramerV))}
\CommentTok{\# Comparison between Pv and Pf positives}
\NormalTok{M }\OtherTok{\textless{}{-}} \FunctionTok{as.table}\NormalTok{(}\FunctionTok{as.matrix}\NormalTok{(ds[}\DecValTok{3}\SpecialCharTok{:}\DecValTok{4}\NormalTok{, ]))}
\NormalTok{Xsq }\OtherTok{\textless{}{-}} \FunctionTok{chisq.test}\NormalTok{(M, }\AttributeTok{correct =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{cramerV }\OtherTok{\textless{}{-}} \FunctionTok{cramerV}\NormalTok{(M, }\AttributeTok{ci =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{R =} \DecValTok{100}\NormalTok{)}
\NormalTok{chisq\_pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(chisq\_pval, Xsq}\SpecialCharTok{$}\NormalTok{p.value)}
\NormalTok{cramer\_res }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(cramer\_res, }\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, cramerV))}
\CommentTok{\# Comparison between Pv and Pf negatives}
\NormalTok{M }\OtherTok{\textless{}{-}} \FunctionTok{as.table}\NormalTok{(}\FunctionTok{as.matrix}\NormalTok{(ds[}\DecValTok{5}\SpecialCharTok{:}\DecValTok{6}\NormalTok{, ]))}
\NormalTok{Xsq }\OtherTok{\textless{}{-}} \FunctionTok{chisq.test}\NormalTok{(M, }\AttributeTok{correct =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{cramerV }\OtherTok{\textless{}{-}} \FunctionTok{cramerV}\NormalTok{(M, }\AttributeTok{ci =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{R =} \DecValTok{100}\NormalTok{)}
\NormalTok{chisq\_pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(chisq\_pval, Xsq}\SpecialCharTok{$}\NormalTok{p.value)}
\NormalTok{cramer\_res }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(cramer\_res, }\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, cramerV))}
\CommentTok{\# Save results}
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(}\FunctionTok{cbind}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Pv vs. Pf"}\NormalTok{, }\StringTok{"Pv pos vs. Pf pos"}\NormalTok{, }\StringTok{"Pv neg vs. Pf neg"}\NormalTok{),}
\NormalTok{  chisq\_pval, }\FunctionTok{do.call}\NormalTok{(rbind, cramer\_res)}
\NormalTok{))}
\FunctionTok{colnames}\NormalTok{(df) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"PURF model"}\NormalTok{, }\StringTok{"Chi{-}squared test p{-}value"}\NormalTok{, }\StringTok{"Cramer\textquotesingle{}s V"}\NormalTok{, }\StringTok{"Lower CI"}\NormalTok{, }\StringTok{"Upper CI"}\NormalTok{)}
\NormalTok{df}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Chi{-}squared test p{-}value}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{as.numeric}\NormalTok{(df}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Chi{-}squared test p{-}value}\StringTok{\textasciigrave{}}\NormalTok{), scientific)}
\FunctionTok{save}\NormalTok{(df, }\AttributeTok{file =} \StringTok{"./rdata/pfpv\_aa\_freq\_comparisons.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\StringTok{"./rdata/pfpv\_aa\_freq\_comparisons.RData"}\NormalTok{)}
\NormalTok{df }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{datatable}\NormalTok{(}\AttributeTok{rownames =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{05_model_interpretation_files/figure-latex/unnamed-chunk-37-1.pdf}

\hypertarget{variable-importance}{%
\section{Variable importance}\label{variable-importance}}

\hypertarget{analysis-7}{%
\subsection{Analysis}\label{analysis-7}}

\textbf{In Python: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(reticulate)}
\FunctionTok{use\_condaenv}\NormalTok{(}\StringTok{"/Users/renee/Library/r{-}miniconda/envs/purf/bin/python"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ pickle}
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}
\ImportTok{import}\NormalTok{ numpy }\ImportTok{as}\NormalTok{ np}
\ImportTok{from}\NormalTok{ sklearn.utils }\ImportTok{import}\NormalTok{ shuffle}
\ImportTok{import}\NormalTok{ pickle}
\ImportTok{from}\NormalTok{ sklearn.impute }\ImportTok{import}\NormalTok{ SimpleImputer}
\ImportTok{from}\NormalTok{ sklearn.preprocessing }\ImportTok{import}\NormalTok{ MinMaxScaler}
\ImportTok{from}\NormalTok{ scipy.spatial }\ImportTok{import}\NormalTok{ distance}
\ImportTok{import}\NormalTok{ multiprocessing}
\ImportTok{from}\NormalTok{ joblib }\ImportTok{import}\NormalTok{ Parallel, delayed}
\NormalTok{num\_cores }\OperatorTok{=}\NormalTok{ multiprocessing.cpu\_count()}
\ImportTok{from}\NormalTok{ sklearn.ensemble.\_forest }\ImportTok{import}\NormalTok{ \_generate\_unsampled\_indices}
\ImportTok{import}\NormalTok{ session\_info}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ calculate\_raw\_var\_imp\_(idx, tree, X, y, weight, groups}\OperatorTok{=}\VariableTok{None}\NormalTok{):}
\NormalTok{    rng }\OperatorTok{=}\NormalTok{ np.random.RandomState(idx)}
\NormalTok{    oob\_indices }\OperatorTok{=}\NormalTok{ \_generate\_unsampled\_indices(tree.random\_state, y.shape[}\DecValTok{0}\NormalTok{], y.shape[}\DecValTok{0}\NormalTok{])}
\NormalTok{    oob\_pos }\OperatorTok{=}\NormalTok{ np.intersect1d(oob\_indices, np.where(y }\OperatorTok{==} \DecValTok{1}\NormalTok{)[}\DecValTok{0}\NormalTok{])}
\NormalTok{    noutall }\OperatorTok{=} \BuiltInTok{len}\NormalTok{(oob\_pos)}
\NormalTok{    pred }\OperatorTok{=}\NormalTok{ tree.predict\_proba(X.iloc[oob\_pos,:])[:, }\DecValTok{1}\NormalTok{]}
\NormalTok{    nrightall }\OperatorTok{=} \BuiltInTok{sum}\NormalTok{(pred }\OperatorTok{==}\NormalTok{ y[oob\_pos])}
\NormalTok{    imprt, impsd }\OperatorTok{=}\NormalTok{ [], []}
    \ControlFlowTok{if}\NormalTok{ groups }\KeywordTok{is} \VariableTok{None}\NormalTok{:}
        \ControlFlowTok{for}\NormalTok{ var }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(X.shape[}\DecValTok{1}\NormalTok{]):}
\NormalTok{            X\_temp }\OperatorTok{=}\NormalTok{ X.copy()}
\NormalTok{            X\_temp.iloc[:, var] }\OperatorTok{=}\NormalTok{ rng.permutation(X\_temp.iloc[:, var])}
\NormalTok{            pred }\OperatorTok{=}\NormalTok{ tree.predict\_proba(X\_temp.iloc[oob\_pos,:])[:, }\DecValTok{1}\NormalTok{]}
\NormalTok{            nrightimpall }\OperatorTok{=} \BuiltInTok{sum}\NormalTok{(pred }\OperatorTok{==}\NormalTok{ y[oob\_pos])}
\NormalTok{            delta }\OperatorTok{=}\NormalTok{ (nrightall }\OperatorTok{{-}}\NormalTok{ nrightimpall) }\OperatorTok{/}\NormalTok{ noutall }\OperatorTok{*}\NormalTok{ weight}
\NormalTok{            imprt.append(delta)}
\NormalTok{            impsd.append(delta }\OperatorTok{*}\NormalTok{ delta)}
    \ControlFlowTok{else}\NormalTok{:}
        \ControlFlowTok{for}\NormalTok{ grp }\KeywordTok{in}\NormalTok{ np.unique(groups):}
\NormalTok{            X\_temp }\OperatorTok{=}\NormalTok{ X.copy()}
\NormalTok{            X\_temp.iloc[:, groups }\OperatorTok{==}\NormalTok{ grp] }\OperatorTok{=}\NormalTok{ rng.permutation(X\_temp.iloc[:, groups }\OperatorTok{==}\NormalTok{ grp])}
\NormalTok{            pred }\OperatorTok{=}\NormalTok{ tree.predict\_proba(X\_temp.iloc[oob\_pos,:])[:, }\DecValTok{1}\NormalTok{]}
\NormalTok{            nrightimpall }\OperatorTok{=} \BuiltInTok{sum}\NormalTok{(pred }\OperatorTok{==}\NormalTok{ y[oob\_pos])}
\NormalTok{            delta }\OperatorTok{=}\NormalTok{ (nrightall }\OperatorTok{{-}}\NormalTok{ nrightimpall) }\OperatorTok{/}\NormalTok{ noutall }\OperatorTok{*}\NormalTok{ weight}
\NormalTok{            imprt.append(delta)}
\NormalTok{            impsd.append(delta }\OperatorTok{*}\NormalTok{ delta)}
    \ControlFlowTok{return}\NormalTok{ (imprt, impsd)}
  
\KeywordTok{def}\NormalTok{ calculate\_var\_imp(model, features, outcome, num\_cores, weights}\OperatorTok{=}\VariableTok{None}\NormalTok{, groups}\OperatorTok{=}\VariableTok{None}\NormalTok{):}
\NormalTok{    trees }\OperatorTok{=}\NormalTok{ model.estimators\_}
\NormalTok{    idx\_list }\OperatorTok{=}\NormalTok{ [i }\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(trees))]}
    \ControlFlowTok{if}\NormalTok{ weights }\KeywordTok{is} \VariableTok{None}\NormalTok{:}
\NormalTok{        weights }\OperatorTok{=}\NormalTok{ np.ones(}\BuiltInTok{len}\NormalTok{(trees))}
\NormalTok{    res }\OperatorTok{=}\NormalTok{ Parallel(n\_jobs}\OperatorTok{=}\NormalTok{num\_cores)(}
\NormalTok{      delayed(calculate\_raw\_var\_imp\_)(idx, trees[idx], features, outcome, weights[idx], groups) }\ControlFlowTok{for}\NormalTok{ idx }\KeywordTok{in}\NormalTok{ idx\_list)}
\NormalTok{    imprt, impsd }\OperatorTok{=}\NormalTok{ [], []}
    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(idx\_list)):}
\NormalTok{        imprt.append(res[i][}\DecValTok{0}\NormalTok{])}
\NormalTok{        impsd.append(res[i][}\DecValTok{1}\NormalTok{])}
\NormalTok{    imprt }\OperatorTok{=}\NormalTok{ np.array(imprt).}\BuiltInTok{sum}\NormalTok{(axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{    impsd }\OperatorTok{=}\NormalTok{ np.array(impsd).}\BuiltInTok{sum}\NormalTok{(axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{    imprt }\OperatorTok{/=} \BuiltInTok{sum}\NormalTok{(weights)}
\NormalTok{    impsd }\OperatorTok{=}\NormalTok{ np.sqrt(((impsd }\OperatorTok{/} \BuiltInTok{sum}\NormalTok{(weights)) }\OperatorTok{{-}}\NormalTok{ imprt }\OperatorTok{*}\NormalTok{ imprt) }\OperatorTok{/} \BuiltInTok{sum}\NormalTok{(weights))}
\NormalTok{    mda }\OperatorTok{=}\NormalTok{ []}
    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(imprt)):}
        \ControlFlowTok{if}\NormalTok{ impsd[i] }\OperatorTok{!=} \DecValTok{0}\NormalTok{:}
\NormalTok{            mda.append(imprt[i] }\OperatorTok{/}\NormalTok{ impsd[i])}
        \ControlFlowTok{else}\NormalTok{:}
\NormalTok{            mda.append(imprt[i])}
    \ControlFlowTok{if}\NormalTok{ groups }\KeywordTok{is} \VariableTok{None}\NormalTok{:}
\NormalTok{        var\_imp }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}variable\textquotesingle{}}\NormalTok{: features.columns, }\StringTok{\textquotesingle{}meanDecreaseAccuracy\textquotesingle{}}\NormalTok{: mda\})}
    \ControlFlowTok{else}\NormalTok{:}
\NormalTok{        var\_imp }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}variable\textquotesingle{}}\NormalTok{: np.unique(groups), }\StringTok{\textquotesingle{}meanDecreaseAccuracy\textquotesingle{}}\NormalTok{: mda\})}
    \ControlFlowTok{return}\NormalTok{ var\_imp}
\end{Highlighting}
\end{Shaded}

\hypertarget{pv-data-set-4}{%
\subsubsection{Pv data set}\label{pv-data-set-4}}

\textbf{In Python: }

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./other\_data/pv\_ml\_input.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{features }\OperatorTok{=}\NormalTok{ data.iloc[:, }\DecValTok{1}\NormalTok{:]}
\NormalTok{outcome }\OperatorTok{=}\NormalTok{ np.array(data.antigen\_label)}

\NormalTok{features, outcome }\OperatorTok{=}\NormalTok{ shuffle(features, outcome, random\_state}\OperatorTok{=}\DecValTok{0}\NormalTok{)}

\CommentTok{\# Imputation}
\NormalTok{imputer }\OperatorTok{=}\NormalTok{ SimpleImputer(strategy}\OperatorTok{=}\StringTok{\textquotesingle{}median\textquotesingle{}}\NormalTok{)}
\NormalTok{X }\OperatorTok{=}\NormalTok{ imputer.fit\_transform(features)}
\NormalTok{X }\OperatorTok{=}\NormalTok{ pd.DataFrame(X, index}\OperatorTok{=}\NormalTok{features.index, columns}\OperatorTok{=}\NormalTok{features.columns)}
\NormalTok{y }\OperatorTok{=}\NormalTok{ outcome}
\NormalTok{features }\OperatorTok{=}\NormalTok{ X}
\BuiltInTok{print}\NormalTok{(}\StringTok{\textquotesingle{}There are }\SpecialCharTok{\%d}\StringTok{ positives out of }\SpecialCharTok{\%d}\StringTok{ samples before feature space weighting.\textquotesingle{}} \OperatorTok{\%}\NormalTok{ (}\BuiltInTok{sum}\NormalTok{(y), }\BuiltInTok{len}\NormalTok{(y)))}

\CommentTok{\# Feature space weighting}
\NormalTok{lab\_pos }\OperatorTok{=}\NormalTok{ X.loc[y}\OperatorTok{==}\DecValTok{1}\NormalTok{,:]}
\NormalTok{median }\OperatorTok{=}\NormalTok{ np.median(lab\_pos, axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}

\CommentTok{\# Feature space weighting}
\NormalTok{lab\_pos }\OperatorTok{=}\NormalTok{ X.loc[y}\OperatorTok{==}\DecValTok{1}\NormalTok{,:]}
\NormalTok{median }\OperatorTok{=}\NormalTok{ np.median(lab\_pos, axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{scaler }\OperatorTok{=}\NormalTok{ MinMaxScaler(feature\_range}\OperatorTok{=}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{10}\NormalTok{))}
\NormalTok{dist }\OperatorTok{=} \BuiltInTok{list}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(lab\_pos.shape[}\DecValTok{0}\NormalTok{]):}
\NormalTok{    dist.append(distance.euclidean(lab\_pos.iloc[i, :], median))}
    
\NormalTok{dist }\OperatorTok{=}\NormalTok{ np.asarray(dist).reshape(}\OperatorTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{counts }\OperatorTok{=}\NormalTok{ np.}\BuiltInTok{round}\NormalTok{(scaler.fit\_transform(dist))}
\NormalTok{counts }\OperatorTok{=}\NormalTok{ np.array(counts, dtype}\OperatorTok{=}\NormalTok{np.int64)[:, }\DecValTok{0}\NormalTok{]}
\NormalTok{X\_temp }\OperatorTok{=}\NormalTok{ X.iloc[y}\OperatorTok{==}\DecValTok{1}\NormalTok{, :]}
\NormalTok{X }\OperatorTok{=}\NormalTok{ X.iloc[y}\OperatorTok{==}\DecValTok{0}\NormalTok{, :]}
\NormalTok{y }\OperatorTok{=}\NormalTok{ np.asarray([}\DecValTok{0}\NormalTok{] }\OperatorTok{*}\NormalTok{ X.shape[}\DecValTok{0}\NormalTok{] }\OperatorTok{+}\NormalTok{ [}\DecValTok{1}\NormalTok{] }\OperatorTok{*}\NormalTok{ (}\BuiltInTok{sum}\NormalTok{(counts)))}
\NormalTok{appended\_data }\OperatorTok{=}\NormalTok{ [X]}
\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(counts)):}
\NormalTok{    appended\_data.append(pd.concat([X\_temp.iloc[[i]]] }\OperatorTok{*}\NormalTok{ counts[i]))}
    
\NormalTok{X }\OperatorTok{=}\NormalTok{ pd.concat(appended\_data)}
\BuiltInTok{print}\NormalTok{(}\StringTok{\textquotesingle{}There are }\SpecialCharTok{\%d}\StringTok{ positives out of }\SpecialCharTok{\%d}\StringTok{ samples after feature space weighting.\textquotesingle{}} \OperatorTok{\%}\NormalTok{ (}\BuiltInTok{sum}\NormalTok{(y), }\BuiltInTok{len}\NormalTok{(y)))}
\NormalTok{features }\OperatorTok{=}\NormalTok{ X}
\NormalTok{outcome }\OperatorTok{=}\NormalTok{ y}
\NormalTok{X.to\_csv(}\StringTok{\textquotesingle{}./other\_data/pv\_ml\_input\_processed\_weighted.csv\textquotesingle{}}\NormalTok{)}

\NormalTok{purf\_model }\OperatorTok{=}\NormalTok{ pickle.load(}\BuiltInTok{open}\NormalTok{(}\StringTok{\textquotesingle{}./pickle\_data/pv\_0.5\_purf\_tree\_filtering.pkl\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}rb\textquotesingle{}}\NormalTok{))}
\NormalTok{purf }\OperatorTok{=}\NormalTok{ purf\_model[}\StringTok{\textquotesingle{}model\textquotesingle{}}\NormalTok{]}
\NormalTok{weights }\OperatorTok{=}\NormalTok{ purf\_model[}\StringTok{\textquotesingle{}weights\textquotesingle{}}\NormalTok{]}

\NormalTok{metadata }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./data/supplementary\_data\_1\_protein\_variable\_metadata.csv\textquotesingle{}}\NormalTok{)}
\NormalTok{groups }\OperatorTok{=}\NormalTok{ metadata.loc[np.isin(metadata[}\StringTok{\textquotesingle{}column name\textquotesingle{}}\NormalTok{], features.columns), }\StringTok{\textquotesingle{}category\textquotesingle{}}\NormalTok{].array}

\NormalTok{var\_imp }\OperatorTok{=}\NormalTok{ calculate\_var\_imp(purf, features, outcome, }\DecValTok{8}\NormalTok{, weights)}
\NormalTok{grp\_var\_imp }\OperatorTok{=}\NormalTok{ calculate\_var\_imp(purf, features, outcome, }\DecValTok{8}\NormalTok{, weights, groups)}
\NormalTok{var\_imp.to\_csv(}\StringTok{\textquotesingle{}./other\_data/pv\_known\_antigen\_variable\_importance.csv\textquotesingle{}}\NormalTok{, index}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\NormalTok{grp\_var\_imp.to\_csv(}\StringTok{\textquotesingle{}./other\_data/pv\_known\_antigen\_group\_variable\_importance.csv\textquotesingle{}}\NormalTok{, index}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{prediction }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_3\_pv\_purf\_oob\_predictions.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{known\_antigens }\OtherTok{\textless{}{-}}\NormalTok{ prediction[prediction}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ]}\SpecialCharTok{$}\NormalTok{protein\_id}
\NormalTok{other\_proteins }\OtherTok{\textless{}{-}}\NormalTok{ prediction[prediction}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0} \SpecialCharTok{\&}\NormalTok{ prediction}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textless{}} \FloatTok{0.5}\NormalTok{, ]}\SpecialCharTok{$}\NormalTok{protein\_id}

\FunctionTok{set.seed}\NormalTok{(}\DecValTok{22}\NormalTok{)}
\NormalTok{random\_proteins }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(other\_proteins, }\AttributeTok{size =} \FunctionTok{length}\NormalTok{(known\_antigens), }\AttributeTok{replace =} \ConstantTok{FALSE}\NormalTok{)}

\CommentTok{\# Load imputed data}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pv\_ml\_input\_processed\_weighted.csv"}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data[}\SpecialCharTok{!}\FunctionTok{duplicated}\NormalTok{(data), ]}
\NormalTok{compared\_group }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{protein\_id, }\ControlFlowTok{function}\NormalTok{(x) }\ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\%in\%}\NormalTok{ known\_antigens) }\DecValTok{1} \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\%in\%}\NormalTok{ random\_proteins) }\DecValTok{0} \ControlFlowTok{else} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data[, }\DecValTok{2}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(data)]}

\CommentTok{\# Min{-}max normalization}
\NormalTok{min\_max }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  (x }\SpecialCharTok{{-}} \FunctionTok{min}\NormalTok{(x)) }\SpecialCharTok{/}\NormalTok{ (}\FunctionTok{max}\NormalTok{(x) }\SpecialCharTok{{-}} \FunctionTok{min}\NormalTok{(x))}
\NormalTok{\}}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(data, min\_max))}

\FunctionTok{save}\NormalTok{(compared\_group, data, }\AttributeTok{file =} \StringTok{"./rdata/pv\_known\_antigen\_wilcox\_data.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\AttributeTok{file =} \StringTok{"./rdata/pv\_known\_antigen\_wilcox\_data.RData"}\NormalTok{)}
\NormalTok{pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(data)) \{}
\NormalTok{  pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(pval, }\FunctionTok{wilcox.test}\NormalTok{(data[compared\_group }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, i], data[compared\_group }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, i])}\SpecialCharTok{$}\NormalTok{p.value)}
\NormalTok{\}}
\NormalTok{adj\_pval }\OtherTok{\textless{}{-}} \FunctionTok{p.adjust}\NormalTok{(pval, }\AttributeTok{method =} \StringTok{"BH"}\NormalTok{, }\AttributeTok{n =} \FunctionTok{length}\NormalTok{(pval))}
\NormalTok{wilcox\_res }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{variable =} \FunctionTok{colnames}\NormalTok{(data), }\AttributeTok{adj\_pval =}\NormalTok{ adj\_pval)}
\FunctionTok{write.csv}\NormalTok{(wilcox\_res, }\StringTok{"./other\_data/pv\_known\_antigen\_wilcox\_res.csv"}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{pv-pf-combined-data-set-5}{%
\subsubsection{Pv + Pf combined data set}\label{pv-pf-combined-data-set-5}}

\textbf{In Python: }

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./data/supplementary\_data\_4\_pfpv\_ml\_input.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{features }\OperatorTok{=}\NormalTok{ data.iloc[:, }\DecValTok{1}\NormalTok{:]}
\NormalTok{outcome }\OperatorTok{=}\NormalTok{ np.array(data.antigen\_label)}

\NormalTok{features, outcome }\OperatorTok{=}\NormalTok{ shuffle(features, outcome, random\_state}\OperatorTok{=}\DecValTok{0}\NormalTok{)}

\CommentTok{\# Imputation}
\NormalTok{imputer }\OperatorTok{=}\NormalTok{ SimpleImputer(strategy}\OperatorTok{=}\StringTok{\textquotesingle{}median\textquotesingle{}}\NormalTok{)}
\NormalTok{X }\OperatorTok{=}\NormalTok{ imputer.fit\_transform(features)}
\NormalTok{X }\OperatorTok{=}\NormalTok{ pd.DataFrame(X, index}\OperatorTok{=}\NormalTok{features.index, columns}\OperatorTok{=}\NormalTok{features.columns)}
\NormalTok{y }\OperatorTok{=}\NormalTok{ outcome}
\NormalTok{features }\OperatorTok{=}\NormalTok{ X}
\BuiltInTok{print}\NormalTok{(}\StringTok{\textquotesingle{}There are }\SpecialCharTok{\%d}\StringTok{ positives out of }\SpecialCharTok{\%d}\StringTok{ samples before feature space weighting.\textquotesingle{}} \OperatorTok{\%}\NormalTok{ (}\BuiltInTok{sum}\NormalTok{(y), }\BuiltInTok{len}\NormalTok{(y)))}

\CommentTok{\# Feature space weighting}
\NormalTok{lab\_pos }\OperatorTok{=}\NormalTok{ X.loc[y}\OperatorTok{==}\DecValTok{1}\NormalTok{,:]}
\NormalTok{median }\OperatorTok{=}\NormalTok{ np.median(lab\_pos, axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}

\CommentTok{\# Feature space weighting}
\NormalTok{lab\_pos }\OperatorTok{=}\NormalTok{ X.loc[y}\OperatorTok{==}\DecValTok{1}\NormalTok{,:]}
\NormalTok{median }\OperatorTok{=}\NormalTok{ np.median(lab\_pos, axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{scaler }\OperatorTok{=}\NormalTok{ MinMaxScaler(feature\_range}\OperatorTok{=}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{10}\NormalTok{))}
\NormalTok{dist }\OperatorTok{=} \BuiltInTok{list}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(lab\_pos.shape[}\DecValTok{0}\NormalTok{]):}
\NormalTok{    dist.append(distance.euclidean(lab\_pos.iloc[i, :], median))}
    
\NormalTok{dist }\OperatorTok{=}\NormalTok{ np.asarray(dist).reshape(}\OperatorTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{counts }\OperatorTok{=}\NormalTok{ np.}\BuiltInTok{round}\NormalTok{(scaler.fit\_transform(dist))}
\NormalTok{counts }\OperatorTok{=}\NormalTok{ np.array(counts, dtype}\OperatorTok{=}\NormalTok{np.int64)[:, }\DecValTok{0}\NormalTok{]}
\NormalTok{X\_temp }\OperatorTok{=}\NormalTok{ X.iloc[y}\OperatorTok{==}\DecValTok{1}\NormalTok{, :]}
\NormalTok{X }\OperatorTok{=}\NormalTok{ X.iloc[y}\OperatorTok{==}\DecValTok{0}\NormalTok{, :]}
\NormalTok{y }\OperatorTok{=}\NormalTok{ np.asarray([}\DecValTok{0}\NormalTok{] }\OperatorTok{*}\NormalTok{ X.shape[}\DecValTok{0}\NormalTok{] }\OperatorTok{+}\NormalTok{ [}\DecValTok{1}\NormalTok{] }\OperatorTok{*}\NormalTok{ (}\BuiltInTok{sum}\NormalTok{(counts)))}
\NormalTok{appended\_data }\OperatorTok{=}\NormalTok{ [X]}
\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(counts)):}
\NormalTok{    appended\_data.append(pd.concat([X\_temp.iloc[[i]]] }\OperatorTok{*}\NormalTok{ counts[i]))}
    
\NormalTok{X }\OperatorTok{=}\NormalTok{ pd.concat(appended\_data)}
\BuiltInTok{print}\NormalTok{(}\StringTok{\textquotesingle{}There are }\SpecialCharTok{\%d}\StringTok{ positives out of }\SpecialCharTok{\%d}\StringTok{ samples after feature space weighting.\textquotesingle{}} \OperatorTok{\%}\NormalTok{ (}\BuiltInTok{sum}\NormalTok{(y), }\BuiltInTok{len}\NormalTok{(y)))}
\NormalTok{features }\OperatorTok{=}\NormalTok{ X}
\NormalTok{outcome }\OperatorTok{=}\NormalTok{ y}
\NormalTok{X.to\_csv(}\StringTok{\textquotesingle{}./other\_data/pfpv\_ml\_input\_processed\_weighted.csv\textquotesingle{}}\NormalTok{)}

\NormalTok{purf\_model }\OperatorTok{=}\NormalTok{ pickle.load(}\BuiltInTok{open}\NormalTok{(}\StringTok{\textquotesingle{}./pickle\_data/pfpv\_0.5\_purf\_tree\_filtering.pkl\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}rb\textquotesingle{}}\NormalTok{))}
\NormalTok{purf }\OperatorTok{=}\NormalTok{ purf\_model[}\StringTok{\textquotesingle{}model\textquotesingle{}}\NormalTok{]}
\NormalTok{weights }\OperatorTok{=}\NormalTok{ purf\_model[}\StringTok{\textquotesingle{}weights\textquotesingle{}}\NormalTok{]}

\NormalTok{metadata }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./data/supplementary\_data\_1\_protein\_variable\_metadata.csv\textquotesingle{}}\NormalTok{)}
\NormalTok{groups }\OperatorTok{=}\NormalTok{ metadata.loc[np.isin(metadata[}\StringTok{\textquotesingle{}column name\textquotesingle{}}\NormalTok{], features.columns), }\StringTok{\textquotesingle{}category\textquotesingle{}}\NormalTok{].array}

\NormalTok{var\_imp }\OperatorTok{=}\NormalTok{ calculate\_var\_imp(purf, features, outcome, }\DecValTok{8}\NormalTok{, weights)}
\NormalTok{grp\_var\_imp }\OperatorTok{=}\NormalTok{ calculate\_var\_imp(purf, features, outcome, }\DecValTok{8}\NormalTok{, weights, groups)}
\NormalTok{var\_imp.to\_csv(}\StringTok{\textquotesingle{}./other\_data/pfpv\_known\_antigen\_variable\_importance.csv\textquotesingle{}}\NormalTok{, index}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\NormalTok{grp\_var\_imp.to\_csv(}\StringTok{\textquotesingle{}./other\_data/pfpv\_known\_antigen\_group\_variable\_importance.csv\textquotesingle{}}\NormalTok{, index}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{prediction }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_5\_pfpv\_purf\_oob\_predictions.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{known\_antigens }\OtherTok{\textless{}{-}}\NormalTok{ prediction[prediction}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ]}\SpecialCharTok{$}\NormalTok{protein\_id}
\NormalTok{other\_proteins }\OtherTok{\textless{}{-}}\NormalTok{ prediction[prediction}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0} \SpecialCharTok{\&}\NormalTok{ prediction}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textless{}} \FloatTok{0.5}\NormalTok{, ]}\SpecialCharTok{$}\NormalTok{protein\_id}

\FunctionTok{set.seed}\NormalTok{(}\DecValTok{22}\NormalTok{)}
\NormalTok{random\_proteins }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(other\_proteins, }\AttributeTok{size =} \FunctionTok{length}\NormalTok{(known\_antigens), }\AttributeTok{replace =} \ConstantTok{FALSE}\NormalTok{)}

\CommentTok{\# Load imputed data}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pfpv\_ml\_input\_processed\_weighted.csv"}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data[}\SpecialCharTok{!}\FunctionTok{duplicated}\NormalTok{(data), ]}
\NormalTok{compared\_group }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{protein\_id, }\ControlFlowTok{function}\NormalTok{(x) }\ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\%in\%}\NormalTok{ known\_antigens) }\DecValTok{1} \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\%in\%}\NormalTok{ random\_proteins) }\DecValTok{0} \ControlFlowTok{else} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data[, }\DecValTok{2}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(data)]}

\CommentTok{\# Min{-}max normalization}
\NormalTok{min\_max }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  (x }\SpecialCharTok{{-}} \FunctionTok{min}\NormalTok{(x)) }\SpecialCharTok{/}\NormalTok{ (}\FunctionTok{max}\NormalTok{(x) }\SpecialCharTok{{-}} \FunctionTok{min}\NormalTok{(x))}
\NormalTok{\}}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(data, min\_max))}

\FunctionTok{save}\NormalTok{(compared\_group, data, }\AttributeTok{file =} \StringTok{"./rdata/pfpv\_known\_antigen\_wilcox\_data.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\AttributeTok{file =} \StringTok{"./rdata/pfpv\_known\_antigen\_wilcox\_data.RData"}\NormalTok{)}
\NormalTok{pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(data)) \{}
\NormalTok{  pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(pval, }\FunctionTok{wilcox.test}\NormalTok{(data[compared\_group }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, i], data[compared\_group }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, i])}\SpecialCharTok{$}\NormalTok{p.value)}
\NormalTok{\}}
\NormalTok{adj\_pval }\OtherTok{\textless{}{-}} \FunctionTok{p.adjust}\NormalTok{(pval, }\AttributeTok{method =} \StringTok{"BH"}\NormalTok{, }\AttributeTok{n =} \FunctionTok{length}\NormalTok{(pval))}
\NormalTok{wilcox\_res }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{variable =} \FunctionTok{colnames}\NormalTok{(data), }\AttributeTok{adj\_pval =}\NormalTok{ adj\_pval)}
\FunctionTok{write.csv}\NormalTok{(wilcox\_res, }\StringTok{"./other\_data/pfpv\_known\_antigen\_wilcox\_res.csv"}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{plotting-4}{%
\subsection{Plotting}\label{plotting-4}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(reshape2)}
\FunctionTok{library}\NormalTok{(cowplot)}
\FunctionTok{library}\NormalTok{(stringr)}

\NormalTok{colorset }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"genomic"} \OtherTok{=} \StringTok{"\#0C1C63"}\NormalTok{, }\StringTok{"immunological"} \OtherTok{=} \StringTok{"\#408002"}\NormalTok{, }\StringTok{"proteomic"} \OtherTok{=} \StringTok{"\#0F80FF"}\NormalTok{, }\StringTok{"structural"} \OtherTok{=} \StringTok{"\#FEAE34"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{pv-data-set-5}{%
\subsubsection{Pv data set}\label{pv-data-set-5}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Variable importance}
\NormalTok{var\_imp }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pv\_known\_antigen\_variable\_importance.csv"}\NormalTok{)}
\NormalTok{var\_imp }\OtherTok{\textless{}{-}}\NormalTok{ var\_imp[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{var\_imp}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy), ]}
\NormalTok{var\_imp }\OtherTok{\textless{}{-}}\NormalTok{ var\_imp[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, ]}

\NormalTok{metadata }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_1\_protein\_variable\_metadata.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{metadata }\OtherTok{\textless{}{-}}\NormalTok{ metadata[}\FunctionTok{c}\NormalTok{(}\StringTok{"category"}\NormalTok{, }\StringTok{"column name"}\NormalTok{)]}
\NormalTok{metadata }\OtherTok{\textless{}{-}}\NormalTok{ metadata[metadata}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{column name}\StringTok{\textasciigrave{}} \SpecialCharTok{\%in\%}\NormalTok{ var\_imp}\SpecialCharTok{$}\NormalTok{variable, ]}

\NormalTok{var\_imp }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ var\_imp, }\AttributeTok{y =}\NormalTok{ metadata, }\AttributeTok{by.x =} \StringTok{"variable"}\NormalTok{, }\AttributeTok{by.y =} \StringTok{"column name"}\NormalTok{)}
\NormalTok{var\_imp}\SpecialCharTok{$}\NormalTok{category }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(var\_imp}\SpecialCharTok{$}\NormalTok{category, }\AttributeTok{levels =} \FunctionTok{names}\NormalTok{(colorset))}
\NormalTok{var\_imp}\SpecialCharTok{$}\NormalTok{color }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(var\_imp}\SpecialCharTok{$}\NormalTok{category, }\ControlFlowTok{function}\NormalTok{(x) colorset[x])}

\NormalTok{var\_imp}\SpecialCharTok{$}\NormalTok{variable\_ }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"GPI{-}anchor specificity score"}\NormalTok{,}
  \StringTok{"Total length of the low}\SpecialCharTok{\textbackslash{}n}\StringTok{ complexity regions"}\NormalTok{,}
  \StringTok{"Maximum score of Chou and}\SpecialCharTok{\textbackslash{}n}\StringTok{ Fasman beta turn"}\NormalTok{,}
  \StringTok{"Maximum score of Kolaskar and}\SpecialCharTok{\textbackslash{}n}\StringTok{ Tongaonkar antigenicity"}\NormalTok{,}
  \StringTok{"Maximum score of B{-}cell}\SpecialCharTok{\textbackslash{}n}\StringTok{ epitopes (BepiPred{-}1.0)"}\NormalTok{,}
  \StringTok{"Maximum score of IFN{-}gamma}\SpecialCharTok{\textbackslash{}n}\StringTok{ inducing epitopes"}\NormalTok{,}
  \StringTok{"Minimum score of B{-}cell}\SpecialCharTok{\textbackslash{}n}\StringTok{ epitopes (BepiPred{-}1.0)"}\NormalTok{,}
  \StringTok{"Number of non{-}synonymous SNPs"}\NormalTok{,}
  \StringTok{"Number of IFN{-}gamma inducing}\SpecialCharTok{\textbackslash{}n}\StringTok{ epitopes"}\NormalTok{,}
  \StringTok{"Secretory signal peptide}\SpecialCharTok{\textbackslash{}n}\StringTok{ probability"}
\NormalTok{)}

\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(var\_imp, }\FunctionTok{aes}\NormalTok{(}
  \AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(variable\_, meanDecreaseAccuracy), }\AttributeTok{y =}\NormalTok{ meanDecreaseAccuracy,}
  \AttributeTok{fill =}\NormalTok{ category}
\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{3}\NormalTok{, }\AttributeTok{pch =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.8}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ colorset, }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Genomic"}\NormalTok{, }\StringTok{"Immunological"}\NormalTok{, }\StringTok{"Proteomic"}\NormalTok{, }\StringTok{"Structural"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\FunctionTok{min}\NormalTok{(var\_imp}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy), }\FunctionTok{max}\NormalTok{(var\_imp}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy) }\SpecialCharTok{+} \DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.major.y =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{color =} \StringTok{"grey80"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dotted"}\NormalTok{),}
    \AttributeTok{strip.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.border =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{size =} \DecValTok{20}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{10}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.8}\NormalTok{, }\FloatTok{0.2}\NormalTok{),}
    \AttributeTok{legend.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.2}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Mean decrease in accuracy"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Group variable importance}
\NormalTok{grp\_var\_imp }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pv\_known\_antigen\_group\_variable\_importance.csv"}\NormalTok{)}

\NormalTok{grp\_var\_imp\_ }\OtherTok{\textless{}{-}}\NormalTok{ grp\_var\_imp}
\NormalTok{firstup }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \FunctionTok{substr}\NormalTok{(x, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{) }\OtherTok{\textless{}{-}} \FunctionTok{toupper}\NormalTok{(}\FunctionTok{substr}\NormalTok{(x, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{))}
  \FunctionTok{return}\NormalTok{(x)}
\NormalTok{\}}
\NormalTok{grp\_var\_imp\_}\SpecialCharTok{$}\NormalTok{variable }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(grp\_var\_imp\_}\SpecialCharTok{$}\NormalTok{variable, }\ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(x, }\StringTok{"[\_}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.]"}\NormalTok{, }\StringTok{" "}\NormalTok{)}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{firstup}\NormalTok{(x)}
  \FunctionTok{return}\NormalTok{(x)}
\NormalTok{\})}

\NormalTok{grp\_var\_imp\_}\SpecialCharTok{$}\NormalTok{category }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{tolower}\NormalTok{(grp\_var\_imp\_}\SpecialCharTok{$}\NormalTok{variable))}

\NormalTok{p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(grp\_var\_imp\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(variable, meanDecreaseAccuracy), }\AttributeTok{y =}\NormalTok{ meanDecreaseAccuracy, }\AttributeTok{fill =}\NormalTok{ category)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{3}\NormalTok{, }\AttributeTok{pch =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.8}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ colorset, }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Genomic"}\NormalTok{, }\StringTok{"Immunological"}\NormalTok{, }\StringTok{"Proteomic"}\NormalTok{, }\StringTok{"Structural"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\FunctionTok{min}\NormalTok{(grp\_var\_imp}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy), }\FunctionTok{max}\NormalTok{(grp\_var\_imp}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy) }\SpecialCharTok{+} \DecValTok{5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.major.y =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{color =} \StringTok{"grey80"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dotted"}\NormalTok{),}
    \AttributeTok{strip.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.border =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size =} \DecValTok{10}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{size =} \DecValTok{20}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{30}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{90}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Mean decrease in accuracy"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Wilcoxon text}
\FunctionTok{load}\NormalTok{(}\AttributeTok{file =} \StringTok{"./rdata/pv\_known\_antigen\_wilcox\_data.RData"}\NormalTok{)}
\NormalTok{wilcox\_res }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pv\_known\_antigen\_wilcox\_res.csv"}\NormalTok{)}
\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}}\NormalTok{ data}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group }\OtherTok{\textless{}{-}}\NormalTok{ compared\_group}
\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}}\NormalTok{ wilcox\_data[wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group }\SpecialCharTok{!=} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, ]}
\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}} \FunctionTok{melt}\NormalTok{(wilcox\_data, }\AttributeTok{id =} \FunctionTok{c}\NormalTok{(}\StringTok{"compared\_group"}\NormalTok{))}
\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ wilcox\_data, }\AttributeTok{y =} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ var\_imp, }\AttributeTok{y =}\NormalTok{ wilcox\_res), }\AttributeTok{by =} \StringTok{"variable"}\NormalTok{, }\AttributeTok{all.y =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{tile\_pos }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(wilcox\_data))}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group)}

\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{variable }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(wilcox\_data}\SpecialCharTok{$}\NormalTok{variable, }\ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(x, }\StringTok{"[\_}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.]"}\NormalTok{, }\StringTok{" "}\NormalTok{)}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{firstup}\NormalTok{(x)}
  \FunctionTok{return}\NormalTok{(x)}
\NormalTok{\})}

\NormalTok{adj\_pval\_tmp }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(wilcox\_data)) \{}
\NormalTok{  x }\OtherTok{\textless{}{-}}\NormalTok{ wilcox\_data}\SpecialCharTok{$}\NormalTok{adj\_pval[i]}
\NormalTok{  a }\OtherTok{\textless{}{-}} \FunctionTok{strsplit}\NormalTok{(}\FunctionTok{format}\NormalTok{(x, }\AttributeTok{scientific =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{digits =} \DecValTok{3}\NormalTok{), }\StringTok{"e"}\NormalTok{)[[}\DecValTok{1}\NormalTok{]]}
\NormalTok{  res }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, }\FunctionTok{as.numeric}\NormalTok{(a[}\DecValTok{1}\NormalTok{])), }\StringTok{" \%*\% 10\^{}"}\NormalTok{, }\FunctionTok{as.integer}\NormalTok{(a[}\DecValTok{2}\NormalTok{]))}
\NormalTok{  adj\_pval\_tmp }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(adj\_pval\_tmp, res)}
\NormalTok{\}}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{adj\_pval }\OtherTok{\textless{}{-}}\NormalTok{ adj\_pval\_tmp}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p3 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(wilcox\_data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(variable, meanDecreaseAccuracy), }\AttributeTok{y =}\NormalTok{ value, }\AttributeTok{fill =}\NormalTok{ compared\_group)) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{(}\AttributeTok{outlier.color =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{lwd =} \FloatTok{0.3}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}
    \AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.5}\NormalTok{,}
    \AttributeTok{position =} \FunctionTok{position\_jitterdodge}\NormalTok{()}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ adj\_pval),}
    \AttributeTok{y =} \FloatTok{1.1}\NormalTok{, }\AttributeTok{size =} \DecValTok{3}\NormalTok{, }\AttributeTok{fontface =} \StringTok{"plain"}\NormalTok{, }\AttributeTok{family =} \StringTok{"sans"}\NormalTok{,}
    \AttributeTok{hjust =} \DecValTok{0}\NormalTok{, }\AttributeTok{parse =} \ConstantTok{TRUE}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{9} \SpecialCharTok{+} \FloatTok{0.5}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey80"}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"solid"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{(}\AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{), }\AttributeTok{clip =} \StringTok{"off"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"1"}\NormalTok{, }\StringTok{"0"}\NormalTok{), }\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#FF007F"}\NormalTok{, }\StringTok{"\#0080FF"}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Known antigens"}\NormalTok{, }\StringTok{"Random predicted non{-}antigens"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{strip.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.border =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{linewidth =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{90}\NormalTok{, }\DecValTok{0}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{20}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.ticks.y =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Normalized variable value"}\NormalTok{)}

\NormalTok{legend }\OtherTok{\textless{}{-}} \FunctionTok{get\_legend}\NormalTok{(p3 }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.key =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.direction =} \StringTok{"horizontal"}\NormalTok{,}
    \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.35}\NormalTok{, }\FloatTok{0.9}\NormalTok{)}
\NormalTok{  ))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p\_combined }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(}\FunctionTok{plot\_grid}\NormalTok{(p1, p3, }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{""}\NormalTok{), }\AttributeTok{rel\_widths =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.57}\NormalTok{, }\FloatTok{0.43}\NormalTok{)),}
  \FunctionTok{plot\_grid}\NormalTok{(p2, }\ConstantTok{NULL}\NormalTok{, legend,}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"b"}\NormalTok{, }\StringTok{""}\NormalTok{, }\StringTok{""}\NormalTok{, }\StringTok{""}\NormalTok{),}
    \AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_widths =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.57}\NormalTok{, }\FloatTok{0.01}\NormalTok{, }\FloatTok{0.42}\NormalTok{)}
\NormalTok{  ),}
  \AttributeTok{ncol =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_heights =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.65}\NormalTok{, }\FloatTok{0.35}\NormalTok{)}
\NormalTok{)}
\NormalTok{p\_combined}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 9} \end{center}

\hypertarget{pv-pf-combined-data-set-6}{%
\subsubsection{Pv + Pf combined data set}\label{pv-pf-combined-data-set-6}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Variable importance}
\NormalTok{var\_imp }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pfpv\_known\_antigen\_variable\_importance.csv"}\NormalTok{)}
\NormalTok{var\_imp }\OtherTok{\textless{}{-}}\NormalTok{ var\_imp[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{var\_imp}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy), ]}
\NormalTok{var\_imp }\OtherTok{\textless{}{-}}\NormalTok{ var\_imp[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, ]}

\NormalTok{metadata }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_1\_protein\_variable\_metadata.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{metadata }\OtherTok{\textless{}{-}}\NormalTok{ metadata[}\FunctionTok{c}\NormalTok{(}\StringTok{"category"}\NormalTok{, }\StringTok{"column name"}\NormalTok{)]}
\NormalTok{metadata }\OtherTok{\textless{}{-}}\NormalTok{ metadata[metadata}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{column name}\StringTok{\textasciigrave{}} \SpecialCharTok{\%in\%}\NormalTok{ var\_imp}\SpecialCharTok{$}\NormalTok{variable, ]}

\NormalTok{var\_imp }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ var\_imp, }\AttributeTok{y =}\NormalTok{ metadata, }\AttributeTok{by.x =} \StringTok{"variable"}\NormalTok{, }\AttributeTok{by.y =} \StringTok{"column name"}\NormalTok{)}
\NormalTok{var\_imp}\SpecialCharTok{$}\NormalTok{category }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(var\_imp}\SpecialCharTok{$}\NormalTok{category, }\AttributeTok{levels =} \FunctionTok{names}\NormalTok{(colorset))}
\NormalTok{var\_imp}\SpecialCharTok{$}\NormalTok{color }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(var\_imp}\SpecialCharTok{$}\NormalTok{category, }\ControlFlowTok{function}\NormalTok{(x) colorset[x])}

\NormalTok{var\_imp}\SpecialCharTok{$}\NormalTok{variable\_ }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"Percentage of aspartic acid}\SpecialCharTok{\textbackslash{}n}\StringTok{ minus percentage of glutamic acid"}\NormalTok{,}
  \StringTok{"GPI{-}anchor specificity score"}\NormalTok{,}
  \StringTok{"Total length of the low}\SpecialCharTok{\textbackslash{}n}\StringTok{ complexity regions"}\NormalTok{,}
  \StringTok{"Maximum score of Parker}\SpecialCharTok{\textbackslash{}n}\StringTok{ hydrophilicity"}\NormalTok{,}
  \StringTok{"Number of non{-}synonymous SNPs"}\NormalTok{,}
  \StringTok{"Percentage of amino acids with}\SpecialCharTok{\textbackslash{}n}\StringTok{ normalized van der Waals volume}\SpecialCharTok{\textbackslash{}n}\StringTok{ between 4.038.08"}\NormalTok{,}
  \StringTok{"Number of IFN{-}gamma inducing}\SpecialCharTok{\textbackslash{}n}\StringTok{ epitopes"}\NormalTok{,}
  \StringTok{"Percentage of amino acids with}\SpecialCharTok{\textbackslash{}n}\StringTok{ polarizability between 0.2190.409"}\NormalTok{,}
  \StringTok{"Small amino acid percentage"}\NormalTok{,}
  \StringTok{"Secretory signal peptide}\SpecialCharTok{\textbackslash{}n}\StringTok{ probability"}
\NormalTok{)}

\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(var\_imp, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(variable\_, meanDecreaseAccuracy), }\AttributeTok{y =}\NormalTok{ meanDecreaseAccuracy, }\AttributeTok{fill =}\NormalTok{ category)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{3}\NormalTok{, }\AttributeTok{pch =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.8}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ colorset, }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Genomic"}\NormalTok{, }\StringTok{"Immunological"}\NormalTok{, }\StringTok{"Proteomic"}\NormalTok{, }\StringTok{"Structural"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\FunctionTok{min}\NormalTok{(var\_imp}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy), }\FunctionTok{max}\NormalTok{(var\_imp}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy) }\SpecialCharTok{+} \DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.major.y =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{color =} \StringTok{"grey80"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dotted"}\NormalTok{),}
    \AttributeTok{strip.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.border =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{size =} \DecValTok{20}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{10}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.8}\NormalTok{, }\FloatTok{0.2}\NormalTok{),}
    \AttributeTok{legend.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.2}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Mean decrease in accuracy"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Group variable importance}
\NormalTok{grp\_var\_imp }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pfpv\_known\_antigen\_group\_variable\_importance.csv"}\NormalTok{)}

\NormalTok{grp\_var\_imp\_ }\OtherTok{\textless{}{-}}\NormalTok{ grp\_var\_imp}
\NormalTok{firstup }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \FunctionTok{substr}\NormalTok{(x, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{) }\OtherTok{\textless{}{-}} \FunctionTok{toupper}\NormalTok{(}\FunctionTok{substr}\NormalTok{(x, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{))}
  \FunctionTok{return}\NormalTok{(x)}
\NormalTok{\}}
\NormalTok{grp\_var\_imp\_}\SpecialCharTok{$}\NormalTok{variable }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(grp\_var\_imp\_}\SpecialCharTok{$}\NormalTok{variable, }\ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(x, }\StringTok{"[\_}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.]"}\NormalTok{, }\StringTok{" "}\NormalTok{)}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{firstup}\NormalTok{(x)}
  \FunctionTok{return}\NormalTok{(x)}
\NormalTok{\})}

\NormalTok{grp\_var\_imp\_}\SpecialCharTok{$}\NormalTok{category }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{tolower}\NormalTok{(grp\_var\_imp\_}\SpecialCharTok{$}\NormalTok{variable))}

\NormalTok{p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(grp\_var\_imp\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(variable, meanDecreaseAccuracy), }\AttributeTok{y =}\NormalTok{ meanDecreaseAccuracy, }\AttributeTok{fill =}\NormalTok{ category)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{3}\NormalTok{, }\AttributeTok{pch =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.8}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ colorset, }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Genomic"}\NormalTok{, }\StringTok{"Immunological"}\NormalTok{, }\StringTok{"Proteomic"}\NormalTok{, }\StringTok{"Structural"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\FunctionTok{min}\NormalTok{(grp\_var\_imp}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy), }\FunctionTok{max}\NormalTok{(grp\_var\_imp}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy) }\SpecialCharTok{+} \DecValTok{5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.major.y =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{color =} \StringTok{"grey80"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dotted"}\NormalTok{),}
    \AttributeTok{strip.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.border =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size =} \DecValTok{10}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{size =} \DecValTok{20}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{30}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{90}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Mean decrease in accuracy"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Wilcoxon text}
\FunctionTok{load}\NormalTok{(}\AttributeTok{file =} \StringTok{"./rdata/pfpv\_known\_antigen\_wilcox\_data.RData"}\NormalTok{)}
\NormalTok{wilcox\_res }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pfpv\_known\_antigen\_wilcox\_res.csv"}\NormalTok{)}
\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}}\NormalTok{ data}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group }\OtherTok{\textless{}{-}}\NormalTok{ compared\_group}
\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}}\NormalTok{ wilcox\_data[wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group }\SpecialCharTok{!=} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, ]}
\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}} \FunctionTok{melt}\NormalTok{(wilcox\_data, }\AttributeTok{id =} \FunctionTok{c}\NormalTok{(}\StringTok{"compared\_group"}\NormalTok{))}
\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ wilcox\_data, }\AttributeTok{y =} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ var\_imp, }\AttributeTok{y =}\NormalTok{ wilcox\_res), }\AttributeTok{by =} \StringTok{"variable"}\NormalTok{, }\AttributeTok{all.y =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{tile\_pos }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(wilcox\_data))}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group)}

\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{variable }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(wilcox\_data}\SpecialCharTok{$}\NormalTok{variable, }\ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(x, }\StringTok{"[\_}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.]"}\NormalTok{, }\StringTok{" "}\NormalTok{)}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{firstup}\NormalTok{(x)}
  \FunctionTok{return}\NormalTok{(x)}
\NormalTok{\})}

\NormalTok{adj\_pval\_tmp }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(wilcox\_data)) \{}
\NormalTok{  x }\OtherTok{\textless{}{-}}\NormalTok{ wilcox\_data}\SpecialCharTok{$}\NormalTok{adj\_pval[i]}
\NormalTok{  a }\OtherTok{\textless{}{-}} \FunctionTok{strsplit}\NormalTok{(}\FunctionTok{format}\NormalTok{(x, }\AttributeTok{scientific =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{digits =} \DecValTok{3}\NormalTok{), }\StringTok{"e"}\NormalTok{)[[}\DecValTok{1}\NormalTok{]]}
\NormalTok{  res }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%0.2f"}\NormalTok{, }\FunctionTok{as.numeric}\NormalTok{(a[}\DecValTok{1}\NormalTok{])), }\StringTok{" \%*\% 10\^{}"}\NormalTok{, }\FunctionTok{as.integer}\NormalTok{(a[}\DecValTok{2}\NormalTok{]))}
\NormalTok{  adj\_pval\_tmp }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(adj\_pval\_tmp, res)}
\NormalTok{\}}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{adj\_pval }\OtherTok{\textless{}{-}}\NormalTok{ adj\_pval\_tmp}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p3 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(wilcox\_data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(variable, meanDecreaseAccuracy), }\AttributeTok{y =}\NormalTok{ value, }\AttributeTok{fill =}\NormalTok{ compared\_group)) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{(}\AttributeTok{outlier.color =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{lwd =} \FloatTok{0.3}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}
    \AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.5}\NormalTok{,}
    \AttributeTok{position =} \FunctionTok{position\_jitterdodge}\NormalTok{()}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ adj\_pval),}
    \AttributeTok{y =} \FloatTok{1.1}\NormalTok{, }\AttributeTok{size =} \DecValTok{3}\NormalTok{, }\AttributeTok{fontface =} \StringTok{"plain"}\NormalTok{, }\AttributeTok{family =} \StringTok{"sans"}\NormalTok{,}
    \AttributeTok{hjust =} \DecValTok{0}\NormalTok{, }\AttributeTok{parse =} \ConstantTok{TRUE}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{9} \SpecialCharTok{+} \FloatTok{0.5}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey80"}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"solid"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{(}\AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{), }\AttributeTok{clip =} \StringTok{"off"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"1"}\NormalTok{, }\StringTok{"0"}\NormalTok{), }\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#FF007F"}\NormalTok{, }\StringTok{"\#0080FF"}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Known antigens"}\NormalTok{, }\StringTok{"Random predicted non{-}antigens"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{strip.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.border =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{linewidth =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{90}\NormalTok{, }\DecValTok{0}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{20}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.ticks.y =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Normalized variable value"}\NormalTok{)}

\NormalTok{legend }\OtherTok{\textless{}{-}} \FunctionTok{get\_legend}\NormalTok{(p3 }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.key =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.direction =} \StringTok{"horizontal"}\NormalTok{,}
    \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.35}\NormalTok{, }\FloatTok{0.9}\NormalTok{)}
\NormalTok{  ))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p\_combined }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(}\FunctionTok{plot\_grid}\NormalTok{(p1, p3, }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{""}\NormalTok{), }\AttributeTok{rel\_widths =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.57}\NormalTok{, }\FloatTok{0.43}\NormalTok{)),}
  \FunctionTok{plot\_grid}\NormalTok{(p2, }\ConstantTok{NULL}\NormalTok{, legend,}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"b"}\NormalTok{, }\StringTok{""}\NormalTok{, }\StringTok{""}\NormalTok{, }\StringTok{""}\NormalTok{),}
    \AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_widths =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.57}\NormalTok{, }\FloatTok{0.01}\NormalTok{, }\FloatTok{0.42}\NormalTok{)}
\NormalTok{  ),}
  \AttributeTok{ncol =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_heights =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.65}\NormalTok{, }\FloatTok{0.35}\NormalTok{)}
\NormalTok{)}
\NormalTok{p\_combined}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Fig 4} \end{center}

\hypertarget{comparison-of-top-10-important-variables}{%
\subsection{Comparison of top 10 important variables}\label{comparison-of-top-10-important-variables}}

\hypertarget{venn-diagram}{%
\subsubsection{Venn diagram}\label{venn-diagram}}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 10} \end{center}

\hypertarget{top-10-variables-from-combined-model}{%
\subsubsection{Top 10 variables from combined model}\label{top-10-variables-from-combined-model}}

\textbf{In R}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggrepel)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pfpv\_top\_10\_imp\_vars.csv"}\NormalTok{)}
\NormalTok{data}\SpecialCharTok{$}\NormalTok{variable }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"Secretory signal peptide}\SpecialCharTok{\textbackslash{}n}\StringTok{ probability"}\NormalTok{,}
  \StringTok{"Percentage of amino acids with}\SpecialCharTok{\textbackslash{}n}\StringTok{ normalized van der Waals volume}\SpecialCharTok{\textbackslash{}n}\StringTok{ between 4.038.08"}\NormalTok{,}
  \StringTok{"Percentage of amino acids with}\SpecialCharTok{\textbackslash{}n}\StringTok{ polarizability between 0.2190.409"}\NormalTok{,}
  \StringTok{"GPI{-}anchor specificity score"}\NormalTok{,}
  \StringTok{"Number of non{-}synonymous SNPs"}\NormalTok{,}
  \StringTok{"Total length of the low}\SpecialCharTok{\textbackslash{}n}\StringTok{ complexity regions"}\NormalTok{,}
  \StringTok{"Percentage of aspartic acid}\SpecialCharTok{\textbackslash{}n}\StringTok{ minus percentage of glutamic acid"}\NormalTok{,}
  \StringTok{"Small amino acid percentage"}\NormalTok{,}
  \StringTok{"Number of IFN{-}gamma inducing}\SpecialCharTok{\textbackslash{}n}\StringTok{ epitopes"}\NormalTok{,}
  \StringTok{"Maximum score of Parker}\SpecialCharTok{\textbackslash{}n}\StringTok{ hydrophilicity"}
\NormalTok{)}

\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ pf\_single\_model, }\AttributeTok{y =}\NormalTok{ pfpv\_combined\_model, }\AttributeTok{label =}\NormalTok{ variable)) }\SpecialCharTok{+}
  \FunctionTok{geom\_abline}\NormalTok{(}\AttributeTok{intercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{slope =} \DecValTok{1}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.3}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}
    \AttributeTok{size =} \FloatTok{2.5}\NormalTok{, }\AttributeTok{point.padding =} \DecValTok{0}\NormalTok{, }\AttributeTok{min.segment.length =} \DecValTok{0}\NormalTok{,}
    \AttributeTok{max.time =} \DecValTok{1}\NormalTok{, }\AttributeTok{max.iter =} \FloatTok{1e5}\NormalTok{, }\AttributeTok{seed =} \DecValTok{42}\NormalTok{, }\AttributeTok{box.padding =} \FloatTok{0.3}\NormalTok{,}
    \AttributeTok{segment.color =} \StringTok{"grey30"}\NormalTok{, }\AttributeTok{segment.size =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{lineheight =} \DecValTok{1}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{strip.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.border =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{linewidth =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.ticks.x =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Combined model"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlim}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{110}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{110}\NormalTok{)}

\NormalTok{p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ pv\_single\_model, }\AttributeTok{y =}\NormalTok{ pfpv\_combined\_model, }\AttributeTok{label =}\NormalTok{ variable)) }\SpecialCharTok{+}
  \FunctionTok{geom\_abline}\NormalTok{(}\AttributeTok{intercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{slope =} \DecValTok{1}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.3}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}
    \AttributeTok{size =} \FloatTok{2.5}\NormalTok{, }\AttributeTok{point.padding =} \DecValTok{0}\NormalTok{, }\AttributeTok{min.segment.length =} \DecValTok{0}\NormalTok{,}
    \AttributeTok{max.time =} \DecValTok{1}\NormalTok{, }\AttributeTok{max.iter =} \FloatTok{1e5}\NormalTok{, }\AttributeTok{seed =} \DecValTok{42}\NormalTok{, }\AttributeTok{box.padding =} \FloatTok{0.3}\NormalTok{,}
    \AttributeTok{segment.color =} \StringTok{"grey30"}\NormalTok{, }\AttributeTok{segment.size =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{lineheight =} \DecValTok{1}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{strip.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.border =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{linewidth =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.ticks.y =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\FunctionTok{expression}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\FunctionTok{italic}\NormalTok{(}\StringTok{"P. vivax"}\NormalTok{), }\StringTok{" model"}\NormalTok{))) }\SpecialCharTok{+}
  \FunctionTok{xlim}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{110}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{110}\NormalTok{)}

\NormalTok{p3 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ pf\_single\_model, }\AttributeTok{y =}\NormalTok{ pv\_single\_model, }\AttributeTok{label =}\NormalTok{ variable)) }\SpecialCharTok{+}
  \FunctionTok{geom\_abline}\NormalTok{(}\AttributeTok{intercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{slope =} \DecValTok{1}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.3}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}
    \AttributeTok{size =} \FloatTok{2.5}\NormalTok{, }\AttributeTok{point.padding =} \DecValTok{0}\NormalTok{, }\AttributeTok{min.segment.length =} \DecValTok{0}\NormalTok{,}
    \AttributeTok{max.time =} \DecValTok{1}\NormalTok{, }\AttributeTok{max.iter =} \FloatTok{1e5}\NormalTok{, }\AttributeTok{seed =} \DecValTok{42}\NormalTok{, }\AttributeTok{box.padding =} \FloatTok{0.3}\NormalTok{,}
    \AttributeTok{segment.color =} \StringTok{"grey30"}\NormalTok{, }\AttributeTok{segment.size =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{lineheight =} \DecValTok{1}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{strip.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.border =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{linewidth =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\FunctionTok{expression}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\FunctionTok{italic}\NormalTok{(}\StringTok{"P. falciparum"}\NormalTok{), }\StringTok{" model"}\NormalTok{))) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\FunctionTok{expression}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\FunctionTok{italic}\NormalTok{(}\StringTok{"P. vivax"}\NormalTok{), }\StringTok{" model"}\NormalTok{))) }\SpecialCharTok{+}
  \FunctionTok{xlim}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{110}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{110}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p\_combined }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(}\FunctionTok{plot\_grid}\NormalTok{(p1, p3, }\AttributeTok{ncol =} \DecValTok{1}\NormalTok{),}
  \FunctionTok{plot\_grid}\NormalTok{(p2, }\ConstantTok{NULL}\NormalTok{, }\AttributeTok{ncol =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_heights =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.53}\NormalTok{, }\FloatTok{0.47}\NormalTok{)),}
  \AttributeTok{ncol =} \DecValTok{2}
\NormalTok{)}
\NormalTok{p\_combined}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 11} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sessionInfo}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## R version 4.2.3 (2023-03-15)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur ... 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] stringr_1.5.0     reshape2_1.4.4    rlist_0.4.6.2     rcompanion_2.4.30
##  [5] scales_1.2.1      dendextend_1.17.2 cluster_2.1.4     NbClust_3.0.1    
##  [9] factoextra_1.0.7  DT_0.27           cowplot_1.1.1     ggrepel_0.9.3    
## [13] ggplot2_3.4.2     umap_0.2.10.0     reticulate_1.28  
## 
## loaded via a namespace (and not attached):
##  [1] matrixStats_0.63.0 webshot_0.5.4      httr_1.4.6         rprojroot_2.0.3   
##  [5] R.cache_0.16.0     bslib_0.4.2        tools_4.2.3        utf8_1.2.3        
##  [9] R6_2.5.1           nortest_1.0-4      colorspace_2.1-0   withr_2.5.0       
## [13] processx_3.8.1     tidyselect_1.2.0   gridExtra_2.3      Exact_3.2         
## [17] compiler_4.2.3     cli_3.6.1          expm_0.999-7       sandwich_3.0-2    
## [21] sass_0.4.6         bookdown_0.34      lmtest_0.9-40      mvtnorm_1.1-3     
## [25] callr_3.7.3        proxy_0.4-27       askpass_1.1        multcompView_0.1-9
## [29] digest_0.6.31      rmarkdown_2.21     R.utils_2.12.2     pkgconfig_2.0.3   
## [33] htmltools_0.5.5    styler_1.9.1       highr_0.10         fastmap_1.1.1     
## [37] htmlwidgets_1.6.2  rlang_1.1.1        readxl_1.4.2       rstudioapi_0.14   
## [41] jquerylib_0.1.4    generics_0.1.3     zoo_1.8-12         jsonlite_1.8.4    
## [45] crosstalk_1.2.0    dplyr_1.1.2        R.oo_1.25.0        magrittr_2.0.3    
## [49] modeltools_0.2-23  Matrix_1.5-4       Rcpp_1.0.10        DescTools_0.99.48 
## [53] munsell_0.5.0      fansi_1.0.4        viridis_0.6.3      lifecycle_1.0.3   
## [57] R.methodsS3_1.8.2  stringi_1.7.12     multcomp_1.4-23    yaml_2.3.7        
## [61] MASS_7.3-60        rootSolve_1.8.2.3  plyr_1.8.8         grid_4.2.3        
## [65] parallel_4.2.3     lmom_2.9           lattice_0.21-8     splines_4.2.3     
## [69] ps_1.7.5           knitr_1.42         pillar_1.9.0       boot_1.3-28.1     
## [73] gld_2.6.6          codetools_0.2-19   stats4_4.2.3       glue_1.6.2        
## [77] evaluate_0.21      data.table_1.14.8  png_0.1-8          vctrs_0.6.2       
## [81] cellranger_1.1.0   gtable_0.3.3       openssl_2.0.6      purrr_1.0.1       
## [85] cachem_1.0.8       xfun_0.39          coin_1.4-2         libcoin_1.0-9     
## [89] e1071_1.7-13       RSpectra_0.16-1    class_7.3-22       survival_3.5-5    
## [93] viridisLite_0.4.2  tibble_3.2.1       ellipsis_0.3.2     TH.data_1.1-2     
## [97] here_1.0.1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{session\_info.show()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -----
## Bio                 1.78
## joblib              1.1.1
## numpy               1.19.0
## pandas              1.3.2
## purf                NA
## scipy               1.8.0
## session_info        1.0.0
## sklearn             0.24.2
## -----
## Python 3.8.2 (default, Mar 26 2020, 10:45:18) [Clang 4.0.1 (tags/RELEASE_401/final)]
## macOS-10.16-x86_64-i386-64bit
## -----
## Session information updated at 2023-05-18 12:31
\end{verbatim}

\hypertarget{06_top_candidate_comparisons}{%
\chapter{Top candidate comparisons}\label{06_top_candidate_comparisons}}

\hypertarget{clustering-analysis}{%
\section{Clustering analysis}\label{clustering-analysis}}

\hypertarget{analysis-8}{%
\subsection{Analysis}\label{analysis-8}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(DT)}
\FunctionTok{library}\NormalTok{(factoextra)}
\FunctionTok{library}\NormalTok{(NbClust)}
\FunctionTok{library}\NormalTok{(cluster)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(cowplot)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pfpv\_data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_5\_pfpv\_purf\_oob\_predictions.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{pfpv\_data }\OtherTok{\textless{}{-}}\NormalTok{ pfpv\_data[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{pfpv\_data}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}}\NormalTok{), ]}
\NormalTok{pfpv\_threshold }\OtherTok{\textless{}{-}}\NormalTok{ pfpv\_data[pfpv\_data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ]}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}}\NormalTok{[}\FunctionTok{sum}\NormalTok{(pfpv\_data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) }\SpecialCharTok{/} \DecValTok{2}\NormalTok{]}
\NormalTok{top\_pf\_pfpv }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(pfpv\_data[pfpv\_data}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pf"} \SpecialCharTok{\&}\NormalTok{ pfpv\_data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0} \SpecialCharTok{\&}\NormalTok{ pfpv\_data}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=}\NormalTok{ pfpv\_threshold, ])}
\NormalTok{top\_pv\_pfpv }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(pfpv\_data[pfpv\_data}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"pv"} \SpecialCharTok{\&}\NormalTok{ pfpv\_data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0} \SpecialCharTok{\&}\NormalTok{ pfpv\_data}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=}\NormalTok{ pfpv\_threshold, ])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pfpv\_prox }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"\textasciitilde{}/Downloads/pfpv\_proximity\_values.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{pfpv\_dist }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ pfpv\_prox}
\FunctionTok{rownames}\NormalTok{(pfpv\_dist) }\OtherTok{\textless{}{-}} \FunctionTok{colnames}\NormalTok{(pfpv\_dist)}
\NormalTok{pfpv\_dist }\OtherTok{\textless{}{-}}\NormalTok{ pfpv\_dist[}
  \FunctionTok{rownames}\NormalTok{(pfpv\_dist) }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(top\_pf\_pfpv, top\_pv\_pfpv),}
  \FunctionTok{colnames}\NormalTok{(pfpv\_dist) }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(top\_pf\_pfpv, top\_pv\_pfpv)}
\NormalTok{]}
\FunctionTok{rm}\NormalTok{(pfpv\_prox)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Gap statistic}
\NormalTok{gap\_stat }\OtherTok{\textless{}{-}} \FunctionTok{clusGap}\NormalTok{(pfpv\_dist, }\AttributeTok{K.max =} \DecValTok{10}\NormalTok{, hcut, }\AttributeTok{B =} \DecValTok{100}\NormalTok{, }\AttributeTok{hc\_method =} \StringTok{"ward.D2"}\NormalTok{)}
\NormalTok{p0\_1 }\OtherTok{\textless{}{-}} \FunctionTok{fviz\_gap\_stat}\NormalTok{(gap\_stat, }\AttributeTok{maxSE =} \FunctionTok{list}\NormalTok{(}\AttributeTok{method =} \StringTok{"Tibs2001SEmax"}\NormalTok{, }\AttributeTok{SE.factor =} \DecValTok{2}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Gap statistic method"}\NormalTok{)}

\CommentTok{\# Silhouette method}
\NormalTok{p0\_2 }\OtherTok{\textless{}{-}} \FunctionTok{fviz\_nbclust}\NormalTok{(pfpv\_dist, }\AttributeTok{k.max =} \DecValTok{10}\NormalTok{, hcut, }\AttributeTok{hc\_method =} \StringTok{"ward.D2"}\NormalTok{, }\AttributeTok{method =} \StringTok{"silhouette"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Silhouette method"}\NormalTok{)}

\CommentTok{\# Elbow method}
\NormalTok{p0\_3 }\OtherTok{\textless{}{-}} \FunctionTok{fviz\_nbclust}\NormalTok{(pfpv\_dist, }\AttributeTok{k.max =} \DecValTok{10}\NormalTok{, hcut, }\AttributeTok{hc\_method =} \StringTok{"ward.D2"}\NormalTok{, }\AttributeTok{method =} \StringTok{"wss"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \DecValTok{3}\NormalTok{, }\AttributeTok{linetype =} \DecValTok{2}\NormalTok{, }\AttributeTok{color =} \StringTok{"steelblue"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Elbow method"}\NormalTok{)}

\FunctionTok{save}\NormalTok{(p0\_1, p0\_2, p0\_3, }\AttributeTok{file =} \StringTok{"./rdata/top\_candidate\_optimal\_num\_clusters.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(umap)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(ggrepel)}
\FunctionTok{library}\NormalTok{(cowplot)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{top\_pfpv\_hc }\OtherTok{\textless{}{-}} \FunctionTok{hclust}\NormalTok{(}\FunctionTok{as.dist}\NormalTok{(pfpv\_dist), }\AttributeTok{method =} \StringTok{"ward.D2"}\NormalTok{)}
\NormalTok{top\_pfpv\_2\_clusters }\OtherTok{\textless{}{-}} \FunctionTok{cutree}\NormalTok{(top\_pfpv\_hc, }\AttributeTok{k =} \DecValTok{2}\NormalTok{)}
\NormalTok{top\_pfpv\_3\_clusters }\OtherTok{\textless{}{-}} \FunctionTok{cutree}\NormalTok{(top\_pfpv\_hc, }\AttributeTok{k =} \DecValTok{3}\NormalTok{)}
\NormalTok{top\_pfpv\_2\_clusters[top\_pfpv\_2\_clusters }\SpecialCharTok{==} \DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{4}
\NormalTok{top\_pfpv\_2\_clusters[top\_pfpv\_2\_clusters }\SpecialCharTok{==} \DecValTok{2}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{3}
\NormalTok{top\_pfpv\_2\_clusters }\OtherTok{\textless{}{-}}\NormalTok{ top\_pfpv\_2\_clusters }\SpecialCharTok{{-}} \DecValTok{2}
\NormalTok{top\_pfpv\_3\_clusters[top\_pfpv\_3\_clusters }\SpecialCharTok{==} \DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{5}
\NormalTok{top\_pfpv\_3\_clusters[top\_pfpv\_3\_clusters }\SpecialCharTok{==} \DecValTok{2}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{6}
\NormalTok{top\_pfpv\_3\_clusters[top\_pfpv\_3\_clusters }\SpecialCharTok{==} \DecValTok{3}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{4}
\NormalTok{top\_pfpv\_3\_clusters }\OtherTok{\textless{}{-}}\NormalTok{ top\_pfpv\_3\_clusters }\SpecialCharTok{{-}} \DecValTok{3}
\FunctionTok{save}\NormalTok{(top\_pfpv\_2\_clusters, top\_pfpv\_3\_clusters,}
  \AttributeTok{file =} \StringTok{"./rdata/top\_candidate\_clusters.RData"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{clusters }\OtherTok{\textless{}{-}}\NormalTok{ top\_pfpv\_2\_clusters}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_5\_pfpv\_purf\_oob\_predictions.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\FunctionTok{load}\NormalTok{(}\StringTok{"./rdata/pfpv\_prox\_mds\_umap.RData"}\NormalTok{)}
\NormalTok{umap\_df\_ }\OtherTok{\textless{}{-}}\NormalTok{ umap\_df}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{label }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{antigen\_label}
\NormalTok{umap\_df }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ], umap\_df[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters), ])}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Known antigen"}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0209000.1{-}p1"}\NormalTok{)] }\OtherTok{\textless{}{-}} \StringTok{"Reference antigen"}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters)[clusters }\SpecialCharTok{==} \DecValTok{1}\NormalTok{]] }\OtherTok{\textless{}{-}} \StringTok{"Group 1"}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters)[clusters }\SpecialCharTok{==} \DecValTok{2}\NormalTok{]] }\OtherTok{\textless{}{-}} \StringTok{"Group 2"}
\NormalTok{umap\_df\_text }\OtherTok{\textless{}{-}}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ]}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"PfCSP"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"RH5"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"MSP5"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0209000.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"P230"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PVP01\_0835600.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"PvCSP"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PVP01\_0623800.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"DBP"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PVP01\_0728900.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"MSP1"}

\NormalTok{umap\_p1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data =}\NormalTok{ umap\_df\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2), }\AttributeTok{color =} \StringTok{"grey90"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ], }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2), }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{,}
    \AttributeTok{fill =} \StringTok{"\#FFFF33"}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data =}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, ], }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2, }\AttributeTok{fill =}\NormalTok{ group), }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ umap\_df\_text, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2, }\AttributeTok{label =}\NormalTok{ label\_text), }\AttributeTok{size =} \FloatTok{3.5}\NormalTok{,}
    \AttributeTok{nudge\_x =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{nudge\_y =} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\AttributeTok{point.padding =} \FloatTok{0.1}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"Group 1"}\NormalTok{, }\StringTok{"Group 2"}\NormalTok{), }\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#03a1fc"}\NormalTok{, }\StringTok{"\#984EA3"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"bottom"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{guides}\NormalTok{(}\AttributeTok{fill =} \FunctionTok{guide\_legend}\NormalTok{(}\AttributeTok{title =} \StringTok{""}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Dimension 1"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Dimension 2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{clusters }\OtherTok{\textless{}{-}}\NormalTok{ top\_pfpv\_3\_clusters}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_5\_pfpv\_purf\_oob\_predictions.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\FunctionTok{load}\NormalTok{(}\StringTok{"./rdata/pfpv\_prox\_mds\_umap.RData"}\NormalTok{)}
\NormalTok{umap\_df\_ }\OtherTok{\textless{}{-}}\NormalTok{ umap\_df}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{label }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{antigen\_label}
\NormalTok{umap\_df }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ], umap\_df[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters), ])}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Known antigen"}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0209000.1{-}p1"}\NormalTok{)] }\OtherTok{\textless{}{-}} \StringTok{"Reference antigen"}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters)[clusters }\SpecialCharTok{==} \DecValTok{1}\NormalTok{]] }\OtherTok{\textless{}{-}} \StringTok{"Group 1"}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters)[clusters }\SpecialCharTok{==} \DecValTok{2}\NormalTok{]] }\OtherTok{\textless{}{-}} \StringTok{"Group 2"}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{group[}\FunctionTok{rownames}\NormalTok{(umap\_df) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters)[clusters }\SpecialCharTok{==} \DecValTok{3}\NormalTok{]] }\OtherTok{\textless{}{-}} \StringTok{"Group 3"}
\NormalTok{umap\_df\_text }\OtherTok{\textless{}{-}}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ]}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"PfCSP"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"RH5"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"MSP5"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PF3D7\_0209000.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"P230"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PVP01\_0835600.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"PvCSP"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PVP01\_0623800.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"DBP"}
\NormalTok{umap\_df\_text}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_text) }\SpecialCharTok{==} \StringTok{"PVP01\_0728900.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"MSP1"}

\NormalTok{umap\_p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data =}\NormalTok{ umap\_df\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2), }\AttributeTok{color =} \StringTok{"grey90"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ], }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2), }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{,}
    \AttributeTok{fill =} \StringTok{"\#FFFF33"}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data =}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, ], }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2, }\AttributeTok{fill =}\NormalTok{ group), }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ umap\_df\_text, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ X1, }\AttributeTok{y =}\NormalTok{ X2, }\AttributeTok{label =}\NormalTok{ label\_text), }\AttributeTok{size =} \FloatTok{3.5}\NormalTok{,}
    \AttributeTok{nudge\_x =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{nudge\_y =} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\AttributeTok{point.padding =} \FloatTok{0.1}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"Group 1"}\NormalTok{, }\StringTok{"Group 2"}\NormalTok{, }\StringTok{"Group 3"}\NormalTok{),}
    \AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#03a1fc"}\NormalTok{, }\StringTok{"\#984EA3"}\NormalTok{, }\StringTok{"\#FF7F00"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"bottom"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{guides}\NormalTok{(}\AttributeTok{fill =} \FunctionTok{guide\_legend}\NormalTok{(}\AttributeTok{title =} \StringTok{""}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Dimension 1"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Dimension 2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{umap\_p\_combined }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(umap\_p1, umap\_p2, }\AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{))}
\NormalTok{umap\_p\_combined}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 12} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\AttributeTok{file =} \StringTok{"./rdata/top\_candidate\_clusters.RData"}\NormalTok{)}
\NormalTok{species }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\StringTok{"pf"}\NormalTok{, }\DecValTok{145}\NormalTok{), }\FunctionTok{rep}\NormalTok{(}\StringTok{"pv"}\NormalTok{, }\DecValTok{45}\NormalTok{))}
\FunctionTok{cat}\NormalTok{(}\StringTok{"Two clusters}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Two clusters
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(top\_pfpv\_2\_clusters, species)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                    species
## top_pfpv_2_clusters  pf  pv
##                   1   0  35
##                   2 145  10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"Three clusters}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Three clusters
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(top\_pfpv\_3\_clusters, species)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                    species
## top_pfpv_3_clusters  pf  pv
##                   1   0  35
##                   2 107   9
##                   3  38   1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{protein\_id\_1 }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(top\_pfpv\_3\_clusters)[top\_pfpv\_3\_clusters }\SpecialCharTok{==} \DecValTok{1}\NormalTok{]}
\NormalTok{protein\_id\_2 }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(top\_pfpv\_3\_clusters)[top\_pfpv\_3\_clusters }\SpecialCharTok{==} \DecValTok{2}\NormalTok{]}
\NormalTok{protein\_id\_3 }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(top\_pfpv\_3\_clusters)[top\_pfpv\_3\_clusters }\SpecialCharTok{==} \DecValTok{3}\NormalTok{]}
\FunctionTok{save}\NormalTok{(protein\_id\_1, protein\_id\_2, protein\_id\_3, }\AttributeTok{file =} \StringTok{"./rdata/clustering\_groups.RData"}\NormalTok{)}

\NormalTok{gene\_accession\_1 }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(protein\_id\_1, }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.[1{-}9]{-}p1"}\NormalTok{, }\StringTok{""}\NormalTok{)}
\NormalTok{gene\_accession\_2 }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(protein\_id\_2, }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.[1{-}9]{-}p1"}\NormalTok{, }\StringTok{""}\NormalTok{)}
\NormalTok{gene\_accession\_3 }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(protein\_id\_3, }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.[1{-}9]{-}p1"}\NormalTok{, }\StringTok{""}\NormalTok{)}

\FunctionTok{write.table}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(}\StringTok{"acc"} \OtherTok{=}\NormalTok{ gene\_accession\_1),}
  \AttributeTok{sep =} \StringTok{", "}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{col.names =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{file =} \StringTok{"./other\_data/top\_candidates\_gene\_accession\_1.csv"}
\NormalTok{)}
\FunctionTok{write.table}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(}\StringTok{"acc"} \OtherTok{=}\NormalTok{ gene\_accession\_2),}
  \AttributeTok{sep =} \StringTok{", "}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{col.names =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{file =} \StringTok{"./other\_data/top\_candidates\_gene\_accession\_2.csv"}
\NormalTok{)}
\FunctionTok{write.table}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(}\StringTok{"acc"} \OtherTok{=}\NormalTok{ gene\_accession\_3),}
  \AttributeTok{sep =} \StringTok{", "}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{col.names =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{file =} \StringTok{"./other\_data/top\_candidates\_gene\_accession\_3.csv"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{gene-ontology-analysis}{%
\section{Gene ontology analysis}\label{gene-ontology-analysis}}

\hypertarget{analysis-9}{%
\subsection{Analysis}\label{analysis-9}}

\textbf{In Bash: }

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{python}\NormalTok{ ./other\_data/goea.py }\AttributeTok{{-}s} \StringTok{"./other\_data/top\_candidates\_gene\_accession\_1.csv"} \DataTypeTok{\textbackslash{}}
                            \AttributeTok{{-}p} \StringTok{"./other\_data/PlasmoDB{-}62\_pfpv\_GO.gaf"} \DataTypeTok{\textbackslash{}}
                            \AttributeTok{{-}n} \StringTok{"./other\_data/go{-}basic.obo"} \DataTypeTok{\textbackslash{}}
                            \AttributeTok{{-}o} \StringTok{"./other\_data/goea\_result\_1.xlsx"}
                            
\ExtensionTok{python}\NormalTok{ ./other\_data/goea.py }\AttributeTok{{-}s} \StringTok{"./other\_data/top\_candidates\_gene\_accession\_2.csv"} \DataTypeTok{\textbackslash{}}
                            \AttributeTok{{-}p} \StringTok{"./other\_data/PlasmoDB{-}62\_pfpv\_GO.gaf"} \DataTypeTok{\textbackslash{}}
                            \AttributeTok{{-}n} \StringTok{"./other\_data/go{-}basic.obo"} \DataTypeTok{\textbackslash{}}
                            \AttributeTok{{-}o} \StringTok{"./other\_data/goea\_result\_2.xlsx"}
                            
\ExtensionTok{python}\NormalTok{ ./other\_data/goea.py }\AttributeTok{{-}s} \StringTok{"./other\_data/top\_candidates\_gene\_accession\_3.csv"} \DataTypeTok{\textbackslash{}}
                            \AttributeTok{{-}p} \StringTok{"./other\_data/PlasmoDB{-}62\_pfpv\_GO.gaf"} \DataTypeTok{\textbackslash{}}
                            \AttributeTok{{-}n} \StringTok{"./other\_data/go{-}basic.obo"} \DataTypeTok{\textbackslash{}}
                            \AttributeTok{{-}o} \StringTok{"./other\_data/goea\_result\_3.xlsx"}
\end{Highlighting}
\end{Shaded}

\hypertarget{plotting-5}{%
\subsection{Plotting}\label{plotting-5}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(gridExtra)}
\FunctionTok{library}\NormalTok{(shadowtext)}
\FunctionTok{library}\NormalTok{(ggforce)}
\FunctionTok{library}\NormalTok{(reshape)}
\FunctionTok{library}\NormalTok{(cowplot)}
\FunctionTok{library}\NormalTok{(scales)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{process\_goea\_res }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(file\_name) \{}
\NormalTok{  data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(file\_name, }\AttributeTok{header =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{fill =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{quote =} \StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}"}\StringTok{\textquotesingle{}}\NormalTok{, }\AttributeTok{stringsAsFactors =} \ConstantTok{FALSE}\NormalTok{)}
  \CommentTok{\# calculate percentage from the ratio column}
\NormalTok{  data}\SpecialCharTok{$}\NormalTok{num\_genes }\OtherTok{\textless{}{-}} \FunctionTok{apply}\NormalTok{(data, }\DecValTok{1}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{as.integer}\NormalTok{(}\FunctionTok{unlist}\NormalTok{(}\FunctionTok{strsplit}\NormalTok{(x[}\StringTok{"ratio\_in\_study"}\NormalTok{], }\StringTok{"/"}\NormalTok{))[}\DecValTok{1}\NormalTok{]))}
  \CommentTok{\# select for enrichment (e) data rows}
\NormalTok{  data }\OtherTok{\textless{}{-}}\NormalTok{ data[data}\SpecialCharTok{$}\NormalTok{enrichment }\SpecialCharTok{==} \StringTok{"e"}\NormalTok{, ]}

  \CommentTok{\# select for biological process (BP) data rows}
\NormalTok{  res\_bp }\OtherTok{\textless{}{-}}\NormalTok{ data[data}\SpecialCharTok{$}\NormalTok{NS }\SpecialCharTok{==} \StringTok{"BP"}\NormalTok{, ]}
\NormalTok{  res\_bp}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{{-}Log10FDR}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\FunctionTok{log10}\NormalTok{(res\_bp}\SpecialCharTok{$}\NormalTok{p\_fdr\_bh)}
\NormalTok{  res\_bp }\OtherTok{\textless{}{-}}\NormalTok{ res\_bp[}\FunctionTok{order}\NormalTok{(res\_bp}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{{-}Log10FDR}\StringTok{\textasciigrave{}}\NormalTok{), ]}
\NormalTok{  res\_bp}\SpecialCharTok{$}\NormalTok{group }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\StringTok{"Biological process"}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(res\_bp))}

  \CommentTok{\# select for cellular component (CC) data rows}
\NormalTok{  res\_cc }\OtherTok{\textless{}{-}}\NormalTok{ data[data}\SpecialCharTok{$}\NormalTok{NS }\SpecialCharTok{==} \StringTok{"CC"}\NormalTok{, ]}
\NormalTok{  res\_cc}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{{-}Log10FDR}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\FunctionTok{log10}\NormalTok{(res\_cc}\SpecialCharTok{$}\NormalTok{p\_fdr\_bh)}
\NormalTok{  res\_cc }\OtherTok{\textless{}{-}}\NormalTok{ res\_cc[}\FunctionTok{order}\NormalTok{(res\_cc}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{{-}Log10FDR}\StringTok{\textasciigrave{}}\NormalTok{), ]}
\NormalTok{  res\_cc}\SpecialCharTok{$}\NormalTok{group }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\StringTok{"Cellular component"}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(res\_cc))}

  \CommentTok{\# select for molecular function (MF) data rows}
\NormalTok{  res\_mf }\OtherTok{\textless{}{-}}\NormalTok{ data[data}\SpecialCharTok{$}\NormalTok{NS }\SpecialCharTok{==} \StringTok{"MF"}\NormalTok{, ]}
\NormalTok{  res\_mf}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{{-}Log10FDR}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\FunctionTok{log10}\NormalTok{(res\_mf}\SpecialCharTok{$}\NormalTok{p\_fdr\_bh)}
\NormalTok{  res\_mf }\OtherTok{\textless{}{-}}\NormalTok{ res\_mf[}\FunctionTok{order}\NormalTok{(res\_mf}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{{-}Log10FDR}\StringTok{\textasciigrave{}}\NormalTok{), ]}
\NormalTok{  res\_mf}\SpecialCharTok{$}\NormalTok{group }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\StringTok{"Molecular function"}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(res\_mf))}

\NormalTok{  ds }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(rbind, }\FunctionTok{list}\NormalTok{(res\_mf, res\_cc, res\_bp))}
\NormalTok{  ds}\SpecialCharTok{$}\NormalTok{name }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{name, }\AttributeTok{levels =}\NormalTok{ ds}\SpecialCharTok{$}\NormalTok{name)}
\NormalTok{  ds}\SpecialCharTok{$}\NormalTok{group }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{group, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Biological process"}\NormalTok{, }\StringTok{"Cellular component"}\NormalTok{, }\StringTok{"Molecular function"}\NormalTok{))}

  \FunctionTok{return}\NormalTok{(ds)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ds\_1 }\OtherTok{\textless{}{-}} \FunctionTok{process\_goea\_res}\NormalTok{(}\StringTok{"./other\_data/goea\_result\_1.csv"}\NormalTok{)}
\NormalTok{ds\_2 }\OtherTok{\textless{}{-}} \FunctionTok{process\_goea\_res}\NormalTok{(}\StringTok{"./other\_data/goea\_result\_2.csv"}\NormalTok{)}
\NormalTok{ds\_3 }\OtherTok{\textless{}{-}} \FunctionTok{process\_goea\_res}\NormalTok{(}\StringTok{"./other\_data/goea\_result\_3.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(ds\_1, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ name, }\AttributeTok{y =} \StringTok{\textasciigrave{}}\AttributeTok{{-}Log10FDR}\StringTok{\textasciigrave{}}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.05}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{5}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{fill =} \StringTok{"grey20"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.0f"}\NormalTok{, num\_genes)), }\AttributeTok{nudge\_y =} \DecValTok{0}\NormalTok{, }\AttributeTok{size =} \FloatTok{2.5}\NormalTok{, }\AttributeTok{color =} \StringTok{"white"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_discrete}\NormalTok{(}\AttributeTok{labels =} \FunctionTok{label\_wrap}\NormalTok{(}\DecValTok{50}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{  ggforce}\SpecialCharTok{::}\FunctionTok{facet\_col}\NormalTok{(}\AttributeTok{facets =} \FunctionTok{vars}\NormalTok{(group), }\AttributeTok{scales =} \StringTok{"free\_y"}\NormalTok{, }\AttributeTok{space =} \StringTok{"free"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.spacing =} \FunctionTok{unit}\NormalTok{(}\DecValTok{0}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{strip.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.border =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{85}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, )}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\FunctionTok{expression}\NormalTok{(}\StringTok{"{-}Log"}\NormalTok{[}\DecValTok{10}\NormalTok{] }\SpecialCharTok{*} \StringTok{"FDR"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Group 1 (35 candidates)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(ds\_2, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ name, }\AttributeTok{y =} \StringTok{\textasciigrave{}}\AttributeTok{{-}Log10FDR}\StringTok{\textasciigrave{}}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.05}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{5}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{fill =} \StringTok{"grey20"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.0f"}\NormalTok{, num\_genes)), }\AttributeTok{nudge\_y =} \DecValTok{0}\NormalTok{, }\AttributeTok{size =} \FloatTok{2.5}\NormalTok{, }\AttributeTok{color =} \StringTok{"white"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_discrete}\NormalTok{(}\AttributeTok{labels =} \FunctionTok{label\_wrap}\NormalTok{(}\DecValTok{50}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{  ggforce}\SpecialCharTok{::}\FunctionTok{facet\_col}\NormalTok{(}\AttributeTok{facets =} \FunctionTok{vars}\NormalTok{(group), }\AttributeTok{scales =} \StringTok{"free\_y"}\NormalTok{, }\AttributeTok{space =} \StringTok{"free"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.spacing =} \FunctionTok{unit}\NormalTok{(}\DecValTok{0}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{strip.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.border =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, )}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\FunctionTok{expression}\NormalTok{(}\StringTok{"{-}Log"}\NormalTok{[}\DecValTok{10}\NormalTok{] }\SpecialCharTok{*} \StringTok{"FDR"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Group 2 (116 candidates)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p3 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(ds\_3, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ name, }\AttributeTok{y =} \StringTok{\textasciigrave{}}\AttributeTok{{-}Log10FDR}\StringTok{\textasciigrave{}}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.05}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{5}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{fill =} \StringTok{"grey20"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.0f"}\NormalTok{, num\_genes)), }\AttributeTok{nudge\_y =} \DecValTok{0}\NormalTok{, }\AttributeTok{size =} \FloatTok{2.5}\NormalTok{, }\AttributeTok{color =} \StringTok{"white"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_discrete}\NormalTok{(}\AttributeTok{labels =} \FunctionTok{label\_wrap}\NormalTok{(}\DecValTok{50}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{  ggforce}\SpecialCharTok{::}\FunctionTok{facet\_col}\NormalTok{(}\AttributeTok{facets =} \FunctionTok{vars}\NormalTok{(group), }\AttributeTok{scales =} \StringTok{"free\_y"}\NormalTok{, }\AttributeTok{space =} \StringTok{"free"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.spacing =} \FunctionTok{unit}\NormalTok{(}\DecValTok{0}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{strip.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.border =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{0}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, )}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\FunctionTok{expression}\NormalTok{(}\StringTok{"{-}Log"}\NormalTok{[}\DecValTok{10}\NormalTok{] }\SpecialCharTok{*} \StringTok{"FDR"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Group 3 (39 candidates)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{Final plot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p\_combined }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(p1, p2, p3, }\AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_widths =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.3}\NormalTok{, }\FloatTok{0.3}\NormalTok{, }\FloatTok{0.3}\NormalTok{), }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{))}
\NormalTok{p\_combined}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 13} \end{center}

\hypertarget{candidate-antigen-characterization}{%
\section{Candidate antigen characterization}\label{candidate-antigen-characterization}}

\hypertarget{processing-table}{%
\subsection{Processing table}\label{processing-table}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tibble)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{prediction }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_5\_pfpv\_purf\_oob\_predictions.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{prediction }\OtherTok{\textless{}{-}}\NormalTok{ prediction[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{prediction}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}}\NormalTok{), ]}
\NormalTok{threshold }\OtherTok{\textless{}{-}}\NormalTok{ prediction[prediction}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ]}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}}\NormalTok{[}\FunctionTok{sum}\NormalTok{(prediction}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) }\SpecialCharTok{/} \DecValTok{2}\NormalTok{]}
\NormalTok{labeled\_pos }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(prediction)[prediction}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{]}
\NormalTok{top\_pfpv }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(prediction[prediction}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0} \SpecialCharTok{\&}\NormalTok{ prediction}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score filtered}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=}\NormalTok{ threshold, ])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pfpv\_prox }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"\textasciitilde{}/Downloads/pfpv\_proximity\_values.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{pfpv\_dist }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ pfpv\_prox}
\FunctionTok{rm}\NormalTok{(pfpv\_prox)}
\FunctionTok{rownames}\NormalTok{(pfpv\_dist) }\OtherTok{\textless{}{-}} \FunctionTok{colnames}\NormalTok{(pfpv\_dist)}
\NormalTok{pfpv\_dist }\OtherTok{\textless{}{-}}\NormalTok{ pfpv\_dist[, labeled\_pos]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ds }\OtherTok{\textless{}{-}}\NormalTok{ prediction[}\FunctionTok{c}\NormalTok{(labeled\_pos, top\_pfpv), }\StringTok{"OOB score filtered"}\NormalTok{, drop }\OtherTok{=} \ConstantTok{FALSE}\NormalTok{]}
\NormalTok{ds }\OtherTok{\textless{}{-}} \FunctionTok{rownames\_to\_column}\NormalTok{(ds, }\StringTok{"Protein ID"}\NormalTok{)}
\FunctionTok{colnames}\NormalTok{(ds)[}\DecValTok{2}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Score"}

\CommentTok{\# Add clustering groups}
\FunctionTok{load}\NormalTok{(}\AttributeTok{file =} \StringTok{"./rdata/clustering\_groups.RData"}\NormalTok{)}
\NormalTok{ds}\SpecialCharTok{$}\NormalTok{Group }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{ds}\SpecialCharTok{$}\NormalTok{Group[ds}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Protein ID}\StringTok{\textasciigrave{}} \SpecialCharTok{\%in\%}\NormalTok{ protein\_id\_1] }\OtherTok{\textless{}{-}} \StringTok{"Group 1"}
\NormalTok{ds}\SpecialCharTok{$}\NormalTok{Group[ds}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Protein ID}\StringTok{\textasciigrave{}} \SpecialCharTok{\%in\%}\NormalTok{ protein\_id\_2] }\OtherTok{\textless{}{-}} \StringTok{"Group 2"}
\NormalTok{ds}\SpecialCharTok{$}\NormalTok{Group[ds}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Protein ID}\StringTok{\textasciigrave{}} \SpecialCharTok{\%in\%}\NormalTok{ protein\_id\_3] }\OtherTok{\textless{}{-}} \StringTok{"Group 3"}
\NormalTok{ds}\SpecialCharTok{$}\NormalTok{Group[ds}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Protein ID}\StringTok{\textasciigrave{}} \SpecialCharTok{\%in\%}\NormalTok{ labeled\_pos] }\OtherTok{\textless{}{-}} \StringTok{"Known antigen"}
\NormalTok{ds}\SpecialCharTok{$}\NormalTok{Group[ds}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Protein ID}\StringTok{\textasciigrave{}} \SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}
  \StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{,}
  \StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0209000.1{-}p1"}\NormalTok{,}
  \StringTok{"PVP01\_0835600.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0623800.1{-}p1"}\NormalTok{,}
  \StringTok{"PVP01\_0728900.1{-}p1"}
\NormalTok{)] }\OtherTok{\textless{}{-}} \StringTok{"Reference antigen"}

\CommentTok{\# Add gene products}
\NormalTok{gene\_products }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(}
  \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf3d7\_gene\_products\_v62.csv"}\NormalTok{),}
  \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pvp01\_gene\_products\_v62.csv"}\NormalTok{)}
\NormalTok{)}
\FunctionTok{colnames}\NormalTok{(gene\_products) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Protein ID"}\NormalTok{, }\StringTok{"Gene product"}\NormalTok{)}
\NormalTok{ds }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ds, }\AttributeTok{y =}\NormalTok{ gene\_products, }\AttributeTok{by =} \StringTok{"Protein ID"}\NormalTok{, }\AttributeTok{all.x =} \ConstantTok{TRUE}\NormalTok{)}

\CommentTok{\# Add closest reference antigen and the distance}
\NormalTok{pfpv\_ad\_ctrl\_res }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pfpv\_ad\_ctrl\_res.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{ds}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Closest known antigen}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{ds}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Known antigen source}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}} \StringTok{"Intersect"}
\NormalTok{ds}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Closest distance}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\DecValTok{1}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(ds)) \{}
\NormalTok{  prot }\OtherTok{\textless{}{-}}\NormalTok{ ds}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Protein ID}\StringTok{\textasciigrave{}}\NormalTok{[i]}
\NormalTok{  tmp }\OtherTok{\textless{}{-}}\NormalTok{ pfpv\_dist[prot, ]}
\NormalTok{  ds[i, }\StringTok{"Closest known antigen"}\NormalTok{] }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(tmp)[}\FunctionTok{which.min}\NormalTok{(tmp)]}
\NormalTok{  ds[i, }\StringTok{"Closest known antigen"}\NormalTok{] }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}
\NormalTok{    ds[i, }\StringTok{"Closest known antigen"}\NormalTok{], }\StringTok{" ("}\NormalTok{,}
\NormalTok{    gene\_products[}
\NormalTok{      gene\_products}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Protein ID}\StringTok{\textasciigrave{}} \SpecialCharTok{==}\NormalTok{ ds[i, }\StringTok{"Closest known antigen"}\NormalTok{],}
      \StringTok{"Gene product"}
\NormalTok{    ], }\StringTok{")"}
\NormalTok{  )}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{names}\NormalTok{(tmp)[}\FunctionTok{which.min}\NormalTok{(tmp)] }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}
    \StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{,}
    \StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0209000.1{-}p1"}\NormalTok{,}
    \StringTok{"PVP01\_0835600.1{-}p1"}\NormalTok{, }\StringTok{"PVP01\_0623800.1{-}p1"}\NormalTok{,}
    \StringTok{"PVP01\_0728900.1{-}p1"}
\NormalTok{  )) \{}
\NormalTok{    ds[i, }\StringTok{"Known antigen source"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Reference"}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    ds[i, }\StringTok{"Known antigen source"}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ pfpv\_ad\_ctrl\_res[}\FunctionTok{names}\NormalTok{(tmp)[}\FunctionTok{which.min}\NormalTok{(tmp)], }\StringTok{"source"}\NormalTok{]}
\NormalTok{  \}}
\NormalTok{  ds[i, }\StringTok{"Closest distance"}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ tmp[}\FunctionTok{which.min}\NormalTok{(tmp)]}
\NormalTok{\}}

\CommentTok{\# Sort based on scores}
\NormalTok{ds }\OtherTok{\textless{}{-}}\NormalTok{ ds[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{ds}\SpecialCharTok{$}\NormalTok{Score), ]}
\FunctionTok{write.csv}\NormalTok{(ds, }\AttributeTok{file =} \StringTok{"./data/supplementary\_data\_6\_antigen\_characterization.csv"}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sessionInfo}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## R version 4.2.3 (2023-03-15)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur ... 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] tibble_3.2.1     scales_1.2.1     reshape_0.8.9    ggforce_0.4.1   
##  [5] shadowtext_0.1.2 gridExtra_2.3    ggrepel_0.9.3    umap_0.2.10.0   
##  [9] cowplot_1.1.1    cluster_2.1.4    NbClust_3.0.1    factoextra_1.0.7
## [13] ggplot2_3.4.2    DT_0.27         
## 
## loaded via a namespace (and not attached):
##  [1] reticulate_1.28   styler_1.9.1      tidyselect_1.2.0  xfun_0.39        
##  [5] purrr_1.0.1       lattice_0.21-8    colorspace_2.1-0  vctrs_0.6.2      
##  [9] generics_0.1.3    htmltools_0.5.5   yaml_2.3.7        utf8_1.2.3       
## [13] rlang_1.1.1       R.oo_1.25.0       pillar_1.9.0      glue_1.6.2       
## [17] withr_2.5.0       R.utils_2.12.2    tweenr_2.0.2      plyr_1.8.8       
## [21] R.cache_0.16.0    lifecycle_1.0.3   munsell_0.5.0     gtable_0.3.3     
## [25] R.methodsS3_1.8.2 htmlwidgets_1.6.2 codetools_0.2-19  evaluate_0.21    
## [29] knitr_1.42        fastmap_1.1.1     fansi_1.0.4       Rcpp_1.0.10      
## [33] openssl_2.0.6     jsonlite_1.8.4    farver_2.1.1      RSpectra_0.16-1  
## [37] askpass_1.1       png_0.1-8         digest_0.6.31     bookdown_0.34    
## [41] dplyr_1.1.2       polyclip_1.10-4   grid_4.2.3        cli_3.6.1        
## [45] tools_4.2.3       magrittr_2.0.3    pkgconfig_2.0.3   MASS_7.3-60      
## [49] Matrix_1.5-4      rmarkdown_2.21    rstudioapi_0.14   R6_2.5.1         
## [53] compiler_4.2.3
\end{verbatim}

\hypertarget{07_summary_of_candidates}{%
\chapter{Summary of candidates}\label{07_summary_of_candidates}}

The table provides a summary of the top antigen candidates and the 90 known \emph{P. vivax} and \emph{P. falciparum} antigens, including the 7 reference antigens. The table contains columns for protein IDs, probability scores, antigen/candidate groups, gene products, closest known antigens, the source of the closest known antigen, and the distance to the closest antigens. Grey bars in the table show probability scores or closest euclidean distances, with values ranging from 0 to 1.

To access additional information in the rightmost columns, scroll horizontally. For column filtering, click on the white boxes below the headers and type in threshold criteria (e.g., ``PVP01'' to select \emph{P. vivax} proteins). You can also arrange values in ascending or descending order by selecting the arrows adjacent to the headers.

\includegraphics{07_summary_of_candidates_files/figure-latex/unnamed-chunk-5-1.pdf}

\end{document}
